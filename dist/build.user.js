// ==UserScript==
// @name         SimComps - tools
// @namespace    http://shenhaisu.cc/
// @version      2.20.240201005041
// @description  给国人使用的SimComps脚本
// @author       ShenHaiSu
// @match        http://www.simcompanies.com/*
// @match        https://www.simcompanies.com/*
// @license      MIT
// @grant        none
// @noframes
// ==/UserScript==


(()=>{var t={636:(t,e,i)=>{var n={"./ACCAutomaticInquiry.js":969,"./autoChangeColon.js":965,"./basisCPT.js":467,"./biggerAmcharts.js":982,"./bondTracker.js":10,"./buildingEndMsg.js":268,"./chatBiggerTextarea.js":248,"./chatFilter.js":22,"./chatHelper.js":76,"./chatMPDisplay.js":114,"./clickHarvest.js":900,"./closeAllNotification.js":630,"./customBackgroundImage.js":854,"./customExecutivesIcon.js":561,"./customQuantityButton.js":59,"./easyText.js":342,"./economicCycleDetect.js":417,"./festivalEffectSwitch.js":146,"./globalBlock.js":247,"./mapHideScroll.js":162,"./marketHighReminder.js":199,"./marketPriceTracker.js":977,"./newTabProfile.js":919,"./notesSearch.js":5,"./oneClickRebuild.js":892,"./otherRealmMsg.js":408,"./profileBigAvatar.js":293,"./profileTimeTo24.js":797,"./purchaseByMoney.js":283,"./queryHistoricalContracts.js":530,"./retailDisplayProfit.js":11,"./salesOfficeIncomeDisplay.js":381,"./searchDisplayOnline.js":991,"./searchShowIntroduction.js":926,"./sellProfitDisplay.js":276,"./singleBigChat.js":794,"./unBusyHighLight.js":523,"./warehouseACCmpOffest.js":13,"./warehouseChangeRecords.js":585,"./warehouseItemID.js":396,"./warehousePriceCount.js":799};function a(t){var e=o(t);return i(e)}function o(t){if(!i.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}a.keys=function(){return Object.keys(n)},a.resolve=o,t.exports=a,a.id=636},969:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class ACCAutomaticInquiry extends n{constructor(){super(),this.name="接受合同の询价",this.describe="在接受合同界面可以自动询价,查询当前物品当前q在交易所的价格并计算出相对mp的正负值",this.enable=!0,this.tagList=["询价","合同"]}commonFuncList=[{match:()=>Boolean(location.href.match("headquarters/warehouse/incoming-contracts")),func:this.mainFunc}];indexDBData={workMode:1,exactDigit:0,customSamplePrice:[[],[]],customSwitch:!1};componentData={loadFlag:!1,customSampleA:void 0};frontUI=()=>{if(!Boolean(location.href.match("headquarters/warehouse/incoming-contracts")))return a.alert("请回到待处理入库件页面");this.mainWork_0()};settingUI=async()=>{let t=document.createElement("div"),e='<div class=header>接受合同界面自动询价设置</div><div class=container><div><button class="btn script_opt_submit">保存更改</button></div><table><thead><tr><td>功能<td>设置<tbody><tr><td title="在接受合同的界面自动询价比对的时候显示的mp差值精确度 默认0">精确小数点数<td><input class=form-control step=1 type=number value=######><tr><td title="询价组件工作模式 默认自动询价">询价工作模式<td><select class=form-control><option value=0>自动询价<option value=1>手动询价</select><tr><td>自定义参考设置</td><td><input type="checkbox" ##### class="form-control"></td></tr></table></div>';return e=e.replace("######",this.indexDBData.exactDigit).replace("#####",this.indexDBData.customSwitch?"checked":""),t.id="script_ACCAutoQuery_setting",t.innerHTML=e,t.querySelector("select").value=this.indexDBData.workMode,t.querySelector("button.script_opt_submit").addEventListener("click",(()=>this.settingSubmit())),t};settingSubmit(){let t=Object.values(document.querySelectorAll("div#script_ACCAutoQuery_setting input, div#script_ACCAutoQuery_setting select")).map((t=>"checkbox"==t.type?t.checked:t.value));if(t[0]<0)return a.alert("精度必须是整数且大于等于0");this.indexDBData.exactDigit=parseFloat(t[0]),this.indexDBData.workMode=Math.floor(t[1]),this.indexDBData.customSwitch=t[2],a.indexDB_updateIndexDBData(),a.alert("提交更新")}mainFunc(){switch(this.indexDBData.workMode){case 0:return this.mainWork_0();case 1:return this.mainWork_1()}}async mainWork_0(){if(0!=document.querySelectorAll("b.script_automatic_inquiry_b").length)return;if(0!=document.querySelectorAll("a.script_automatic_inquiry_a").length)return;if(this.componentData.loadFlag)return;this.componentData.loadFlag=!0;let t=Object.values(document.querySelectorAll("a[aria-label='Sign contract']")).map((t=>a.getParentByIndex(t,3))),e=await a.getRealm();for(let i=0;i<t.length;i++){let n=t[i],o=this.queryNodeInfo(n.getAttribute("aria-label"));a.log(o);let s=await a.getMarketPrice(o[0],o[3],e),r=this.getCustomPrice(e,o[0],o[3]);0!=r&&(s=r);let c=0;try{c=parseFloat((100*(o[4]/s-1)).toFixed(this.indexDBData.exactDigit)),c=c>0?`+${c}`:c.toString()}catch{c="ERROR"}a.log(s),s?s=a.numberAddCommas(s):(s="无",c=0);let l=document.createElement("b");l.innerText=` MP:$${s} MP${c}%`,l.className="script_automatic_inquiry_b",n.children[2].appendChild(l),this.indexDBData.customSwitch&&(this.componentData.customSampleA||this.genCustomSampleNode(),n.children[2].appendChild(this.componentData.customSampleA.cloneNode(!0)))}this.componentData.loadFlag=!1}mainWork_1(){if(0==document.querySelectorAll("b.script_automatic_inquiry_b").length&&0==document.querySelectorAll("a.script_automatic_inquiry_a").length)try{if(this.componentData.loadFlag)return;let t=Object.values(document.querySelectorAll("a[aria-label='Sign contract']")).map((t=>a.getParentByIndex(t,3)));for(let e=0;e<t.length;e++){let i=t[e],n=document.createElement("a");n.className="script_automatic_inquiry_a",n.innerText=" 询价",n.addEventListener("click",(t=>this.cliclQueryHandle(t))),i.children[2].appendChild(n),this.indexDBData.customSwitch&&(this.componentData.customSampleA||this.genCustomSampleNode(),i.children[2].appendChild(this.componentData.customSampleA.cloneNode(!0)))}}finally{this.componentData.loadFlag=!1}}async cliclQueryHandle(t){let e=a.getParentByIndex(t.target,2),i=this.queryNodeInfo(e.getAttribute("aria-label")),n=await a.getRealm(),o=await a.getMarketPrice(i[0],i[3],n),s=this.getCustomPrice(n,i[0],i[3]);0!=s&&(o=s);let r=0;try{r=(100*(i[4]/o-1)).toFixed(this.indexDBData.exactDigit),r=r>0?`+${r}`:r.toString()}catch{r=""}t.target.innerText=` MP:$${o} MP${r}`}queryNodeInfo(t){let e=[],i=[];return i=t.match(/(\d+)\squality\s(\d+)\s(.+?)\s/),e.push(a.itemName2Index(i[3])),e=e.concat([i[3],i[1],i[2]]),i=t.match(/\$(\d+.\d+|\d+)/g),e=e.concat([parseFloat(i[0].replace("$","")),parseFloat(i[1].replace("$",""))]),e.push(t.match(/from.+?(.+)/)[1]),e}genCustomSampleNode(){let t=document.createElement("a");t.innerText=" 自定义参考",t.setAttribute("sct_cpt","ACCAutomaticInquiry"),t.setAttribute("sct_id","customSampleNode"),t.style.opacity="0.2",document.addEventListener("click",(t=>{"A"===t.target.tagName&&"ACCAutomaticInquiry"===t.target.getAttribute("sct_cpt")&&"customSampleNode"===t.target.getAttribute("sct_id")&&this.showEditCustom(this.queryNodeInfo(a.getParentByIndex(t.target,2).getAttribute("aria-label")))})),this.componentData.customSampleA=t}async showEditCustom(t){let e=await a.getRealm(),i=document.createElement("div"),n=document.createElement("style"),o='<div sct_cpt=ACCAutomaticInquiry sct_id=editMain><table><tr><td>服务器:<td>#####<tr><td>物品名称:<td>#####<tr><td>品质:<td>#####<tr><td>参考价<td><input class=form-control type=number value=#####><tr><td colspan=2><button class="form-control btn">保存</button></table></div>',s=this.getCustomPrice(e,t[0],t[3]);n.setAttribute("sct_cpt","ACCAutomaticInquiry"),n.setAttribute("sct_id","editCSS"),i.setAttribute("sct_cpt","ACCAutomaticInquiry"),i.setAttribute("sct_id","editMain"),n.textContent='[sct_cpt="ACCAutomaticInquiry"][sct_id="editMain"]{padding:5px;color:var(--fontColor);}[sct_cpt="ACCAutomaticInquiry"][sct_id="editMain"]>table{border-collapse:separate;border-spacing:5px;text-align:center;}[sct_cpt="ACCAutomaticInquiry"][sct_id="editMain"]>table>tbody>tr{height:34px;}[sct_cpt="ACCAutomaticInquiry"][sct_id="editMain"]>table button{height:40px;}',o=o.replace("#####",0==e?"R1 M服务器":"R2 E服务器").replace("#####",t[1]).replace("#####",t[3]).replace("#####",0==s?t[4]:s),i.innerHTML=o,i.addEventListener("click",(i=>"BUTTON"==i.target.tagName?this.customSampleSubmit(i,t,e):null)),a.alert(i,n)}getCustomPrice(t,e,i){let n=this.indexDBData.customSamplePrice[t].findIndex((t=>t.id==e));return-1==n?0:this.indexDBData.customSamplePrice[t][n].price[Number(i)]?this.indexDBData.customSamplePrice[t][n].price[Number(i)]:0}customSampleSubmit(t,e,i){a.log(a.getParentByIndex(t.target,3).querySelector("input").value,e);let n=Number(a.getParentByIndex(t.target,3).querySelector("input").value);if(n<0)return;let o=this.indexDBData.customSamplePrice[i].findIndex((t=>t.id==e[0]));-1==o&&(this.indexDBData.customSamplePrice[i].push({id:e[0],price:new Array(13)}),o=this.indexDBData.customSamplePrice[i].length-1),this.indexDBData.customSamplePrice[i][o].price[e[3]]=n,a.indexDB_updateIndexDBData(),document.querySelector('[sct_id="dialog_close"]').click()}}},965:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class autoChangeColon extends n{constructor(){super(),this.name="中英冒号切换",this.describe="聊天室输入框自动中英冒号切换",this.enable=!0,this.canDisable=!0,this.tagList=["聊天"]}commonFuncList=[{match:()=>Boolean(location.href.match(/messages\/(.+)/)&&"textarea"==document.activeElement.type),func:this.mainFunc}];mainFunc(){let t=document.activeElement.selectionStart;!!document.activeElement.value.match("：")&&(a.setInput(document.activeElement,document.activeElement.value.replace("：",":")),document.activeElement.setSelectionRange(t,t))}}},467:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c,langData:l}=i(658);new class basisCPT extends n{constructor(){super(),this.name="插件基础功能",this.describe="包含了图形界面挂载，设置界面挂载等基础功能，不支持关闭",this.enable=!0,this.canDisable=!1,this.tapCount=1/0,this.tagList=["后台","基础"]}cssText=["div#script_hover_node{width:fit-content;height:fit-content;position:fixed;bottom:-85px;right:10px;background:rgb(0,0,0,0.5);z-index:1050;transition:ease-in 0.25s;padding:5px;border-radius:5px;color:var(--fontColor);}div#script_hover_node:hover{bottom:10px;right:10px;}div#script_hover_node>div{margin-bottom:5px;}div#script_hover_node span{display:block;height:35px;line-height:35px;width:100%;text-align:center;transition:ease-in 0.25s;color:var(--fontColor);border-radius:5px;}div#script_hover_node span:hover{background-color:rgb(255,255,255) !important;color:black !important;}div#script_hover_node button{background-color:rgb(54,54,54);color:var(--fontColor);}div#script_hover_node button:hover{background-color:rgb(114,114,114);font-weight:700;}div#script_hover_node.horizontal{display:flex;width:200px;justify-content:center;bottom:10px;right:-140px;}div#script_hover_node.horizontal:hover{right:10px;}div#script_hover_node.horizontal>div{margin:0 5px;flex:1;}div#script_hover_node.fixedDisplay{bottom:10px;right:10px;}div.script_base_container{min-width:450px;overflow-y:auto;overflow-x:hidden;position:fixed;top:0px;right:-150%;display:block;width:35%;height:100%;background-color:rgb(0,0,0,0.7);padding:10px;z-index:1049;transition:ease-in-out 0.25s;color:var(--fontColor);}div#script_msg_node table,div#script_cpt_node table{border-collapse:separate;border-spacing:10px;}div#script_msg_node table>tbody>tr,div#script_cpt_node table>tbody>tr{vertical-align:top;}div#script_cpt_node table{width:100%}div#script_msg_node table>tbody>tr>td:nth-child(1){width:70px;max-width:70px;text-align:center;}div#script_msg_node table>thead>tr>td{text-align:center;}div#script_cpt_node table>tbody>tr>td:nth-child(2){width:70px;text-align:center;}div#script_cpt_node table>tbody>tr>td>button{transition:ease-in-out 0.1s;max-width:300px;background-color:rgb(114,114,114);}div#script_cpt_node table>tbody>tr>td>button:hover{color:black;background-color:#ffffff;box-shadow:0 0 10px 3px wheat;}#script_cpt_setting_container{max-width:60%;min-width:435px;color:var(--fontColor);display:none;box-shadow:0 0 3px 1px rgb(0,0,0,0.5);border-radius:10px;padding:10px;position:fixed;transform:translateX(-50%) translateY(-50%);top:50%;left:50%;background-color:rgb(0,0,0,0.9);z-index:1051;}#script_setting_head{width:100%;margin-bottom:10px;max-height:26px;line-height:26px;height:26px;}#script_setting_head>div>span{position:relative;font-size:21px;left:-10px;display:block;}#script_setting_head>div:nth-child(2){text-align:end;}#script_setting_head>div>button{background-color:red;right:0;position:relative;text-align:center;height:26px;line-height:16px;}#script_setting_body{padding:5px;width:100%;max-height:400px;overflow-y:auto;overflow-x:hidden;}div.setting-container{color:var(--fontColor);}div.setting-container button,div.setting-container input,div.setting-container select{transition:ease-in-out 0.1s;background-color:rgb(76,76,76);color:var(--fontColor);}div.setting-container div.header{background-color:rgb(0,0,0);text-align:center;font-size:20px;font-weight:700;}div.setting-container div.container{width:100%;display:block;margin-top:10px;margin-bottom:10px;}div.setting-container div.container>table,div.setting-container div.container>div>table{border-collapse:separate;border-spacing:10px;text-align:center;width:100%;height:100%;}div.setting-container button.script_opt_submit{width:80%;height:49px;margin:auto;display:block;font-size:20px;transition:ease-in-out 0.1s;}div.setting-container div>table>thead>tr{height:50px;}div.setting-container button:hover{color:black;background-color:#ffffff;box-shadow:0 0 10px 3px wheat;}div#script_cpt_node>div#scriptCPT_mainBody::after{content:\"\";display:block;height:50px;}div#script_cpt_node table>tbody>tr>td>button.funcExist{background-color:green;}div#script_cpt_node table>tbody>tr>td>button.funcExist:hover{background-color:#ffffff;}div#scriptCPT_mainBody tbody>tr:hover{background-color:rgb(255,255,255,0.1);}#script_cptSearch_input{background:rgb(0,0,0,0.8);color:var(--fontColor);}div#script_cpt_node>div#scriptCPT_tagSerach{padding:10px;margin-top:10px;}div#script_cpt_node>div#scriptCPT_tagSerach>span{display:inline-block;width:max-content;height:fit-content;background-color:#000000;border:2px white solid;padding:2px 10px;border-radius:10px;cursor:pointer;margin:4px 5px;}div#script_cpt_node>div#scriptCPT_tagSerach>span:hover{background-color:#339841 !important;}div#script_cpt_node>div#scriptCPT_tagSerach>span.script_tagSearch_active{background-color:#14541d;}div#scriptCPT_mainBody>table>thead>tr>td:nth-of-type(2){text-align:center;}tbody>tr>td>input[type='checkbox']{height: 20px;}","div#script_hover_node{width:fit-content;height:fit-content;position:fixed;bottom:-95px;right:-20px;background:rgb(0,0,0,0.5);z-index:1050;transition:ease-in 0.25s;padding:5px;border-radius:5px;color:var(--fontColor);}div#script_hover_node:hover{bottom:10px;right:10px;}div#script_hover_node>div{margin-bottom:5px;}div#script_hover_node span{display:block;height:35px;line-height:35px;width:100%;text-align:center;transition:ease-in 0.25s;color:var(--fontColor);border-radius:5px;}div#script_hover_node span:hover{background-color:rgb(255,255,255) !important;color:black !important;}div#script_hover_node button{background-color:rgb(54,54,54);color:var(--fontColor);}div#script_hover_node button:hover{background-color:rgb(114,114,114);font-weight:700;}div#script_hover_node.horizontal{display:flex;width:200px;justify-content:center;bottom:10px;right:-140px;}div#script_hover_node.horizontal:hover{right:10px;}div#script_hover_node.horizontal>div{margin:0 5px;flex:1;}div#script_hover_node.fixedDisplay{bottom:10px;right:10px;}div.script_base_container{width:100%;height:100%;overflow-y:auto;overflow-x:hidden;position:fixed;top:0px;right:-150%;display:block;background-color:rgb(0,0,0,0.7);padding:10px;z-index:1049;transition:ease-in-out 0.25s;color:var(--fontColor);}div#script_msg_node table,div#script_cpt_node table{border-collapse:separate;border-spacing:10px;}div#script_msg_node table>tbody>tr,div#script_cpt_node table>tbody>tr{vertical-align:top;}div#script_msg_node table>tbody>tr>td:nth-child(1){width:70px;max-width:70px;text-align:center;}div#script_cpt_node table{width:100%}div#script_cpt_node table>thead>tr>td{text-align:center;}div#script_cpt_node table>tbody>tr>td:nth-child(2){width:70px;text-align:center;}div#script_cpt_node table>tbody>tr>td>button{transition:ease-in-out 0.1s;max-width:300px;background-color:rgb(114,114,114);}div#script_cpt_node table>tbody>tr>td>button:hover{color:black;background-color:#ffffff;box-shadow:0 0 10px 3px wheat;}#script_cpt_setting_container{width:95%;min-width:300px;color:var(--fontColor);display:none;box-shadow:0 0 3px 1px rgb(0,0,0,0.5);border-radius:10px;padding:5px;position:fixed;transform:translateX(-50%) translateY(-50%);top:50%;left:50%;background-color:rgb(0,0,0,0.9);z-index:1051;}#script_setting_head{width:100%;margin-bottom:10px;max-height:26px;line-height:26px;height:26px;}#script_setting_head>div>span{position:relative;font-size:21px;left:-10px;display:block;}#script_setting_head>div:nth-child(2){text-align:end;}#script_setting_head>div>button{background-color:red;right:0;position:relative;text-align:center;height:26px;line-height:16px;}#script_setting_body{padding:5px;width:100%;max-height:400px;overflow-y:auto;overflow-x:hidden;}div.setting-container{color:var(--fontColor);}div.setting-container button,div.setting-container input,div.setting-container select{transition:ease-in-out 0.1s;background-color:rgb(76,76,76);color:var(--fontColor);}div.setting-container div.header{background-color:rgb(0,0,0);text-align:center;font-size:20px;font-weight:700;}div.setting-container div.container{width:100%;display:block;margin-top:10px;margin-bottom:10px;}div.setting-container div.container>table,div.setting-container div.container>div>table{border-collapse:separate;border-spacing:10px;text-align:center;width:100%;height:100%;}div.setting-container button.script_opt_submit{width:80%;height:49px;margin:auto;display:block;font-size:20px;transition:ease-in-out 0.1s;}div.setting-container div>table>thead>tr{height:50px;}div.setting-container button:hover{color:black;background-color:#ffffff;box-shadow:0 0 10px 3px wheat;}div#script_cpt_node>div#scriptCPT_mainBody::after{content:\"\";display:block;height:50px;}div#script_cpt_node table>tbody>tr>td>button.funcExist{background-color:green;}div#script_cpt_node table>tbody>tr>td>button.funcExist:hover{background-color:#ffffff;}div#scriptCPT_mainBody tbody>tr:hover{background-color:rgb(255,255,255,0.1);}#script_cptSearch_input{background:rgb(0,0,0,0.8);color:var(--fontColor);}div#script_cpt_node>div#scriptCPT_tagSerach{padding:10px;margin-top:10px;}div#script_cpt_node>div#scriptCPT_tagSerach>span{display:inline-block;width:max-content;height:fit-content;background-color:#000000;border:2px white solid;padding:2px 10px;border-radius:10px;cursor:pointer;margin:4px 5px;}div#script_cpt_node>div#scriptCPT_tagSerach>span:hover{background-color:#339841 !important;}div#script_cpt_node>div#scriptCPT_tagSerach>span.script_tagSearch_active{background-color:#14541d;}div#scriptCPT_mainBody>table>thead>tr>td:nth-of-type(2){text-align:center;}tbody>tr>td>input[type='checkbox']{height: 20px;}"];indexDBData={building:[[],[]],userInfo:[[],[]],warehouse:[[],[]],resourcePool:[[],[]],executives:[[],[]],notes:[{in:void 0,out:[]},{in:void 0,out:[]}],SCT_divHorizontal:!1,SCT_divFixedDisplay:!1};componentData={settingNodeList:{},buildingInfo:{},realm:void 0,msgNodeShow:!1,cptSwitchShow:!1,cptSettingContainerNode:void 0,cptSettingBodyNode:void 0,cptSettingShow:!1,avtiveTagList:[],cptSearchText:""};startupFuncList=[this.startUpMountCSS,this.startupUserInfo,this.startupWarehouseInfo,this.startupSideBarMain,this.startupSettingContainer,this.startupExecutives,this.startupForDonation];netFuncList=[{urlMatch:t=>/companies\/me\/$/.test(t),func:this.userInfo},{urlMatch:t=>/me\/buildings\/$/.test(t),func:this.buildingInfo},{urlMatch:t=>/v2\/resources\/$/.test(t),func:this.warehouseInfo},{urlMatch:t=>/market\/(all\/)?\d+\/\d+\//.test(t),func:this.marketData},{urlMatch:t=>/lang5\/zh.json$/.test(t),func:this.langData},{urlMatch:t=>/me\/executives\/$/.test(t),func:this.netExecutives},{urlMatch:t=>/me\/note\/$/.test(t)||/me\/my-note\/$/.test(t)||/me\/note\/(\d+)\/$/.test(t),func:this.netNoteRegist}];settingUI=this.uisetting;CPT_switch_button(t){let e=[];document.querySelectorAll("#scriptSetting_CPT_switch input").forEach((t=>e.push(t.checked)));let i=0;o.forEach((t=>t.enable=e[i++])),a.indexDB_updateFeatureConf(),a.alert("提交设置成功")}async BaseSet_button(t){let e=[];document.querySelectorAll("#setting-container-2 input, #setting-container-2 select").forEach((t=>{"INPUT"==t.tagName&&"checkbox"==t.type?e.push(t.checked):"INPUT"!=t.tagName&&"SELECT"!=t.tagName||e.push(t.value)})),c.debug=e[0],c.net_gap_ms=Math.floor(e[1]),c.fontColor=e[2],c.notificationMode=Math.floor(e[3]),a.log(c),await a.indexDB_updateFeatureConf(),a.alert("已提交更改"),location.reload()}async clearIndexdDB(t){await a.indexDB_deleteAllData(),a.alert("清除插件缓存完毕"),location.reload()}userInfo(t,e,i){i=JSON.parse(i),this.indexDBData.userInfo[i.authCompany.realmId]=i,this.componentData.realm=i.authCompany.realmId,a.log("用户数据获取完毕：",i),a.indexDB_updateIndexDBData()}buildingInfo(t,e,i){i=JSON.parse(i),null!=this.componentData.realm&&(this.indexDBData.building[this.componentData.realm]=i,a.indexDB_updateIndexDBData())}warehouseInfo(t,e,i){i=JSON.parse(i),null!=this.componentData.realm&&(a.log("Current Realm: ",this.componentData.realm),this.indexDBData.warehouse[this.componentData.realm]=i,a.indexDB_updateIndexDBData())}marketData(t,e,i){if(i=JSON.parse(i),null==!this.componentData.realm)return;let n=a.mpFormat(i),o=Math.floor(t.match(/\d+(?=\D*$)/)[0]),s=Math.floor(t.match(/\/(\d+)/)[1]);a.log("Realm",s,"物品名",a.itemIndex2Name(o),"物品ID",o,"价格",n),this.indexDBData.resourcePool[s]||(this.indexDBData.resourcePool[s]=[]),this.indexDBData.resourcePool[s][o]=n,a.indexDB_updateIndexDBData()}langData(t,e,i){i=JSON.parse(i);for(const t in i)(Object.hasOwnProperty.call(i,t)||Object.hasOwnProperty.call(l,t))&&(l[t]=i[t]);delete this.indexDBData.langData,a.indexDB_updateLangData(l)}async netExecutives(t,e,i){let n=JSON.parse(i);this.indexDBData.executives[await a.getRealm()]=n}async netNoteRegist(t,e,i){let n=await a.getRealm();if(/me\/note\/$/.test(t)){let t=JSON.parse(i);a.log(`R${n+1} 给别人的笔记: `,t),this.indexDBData.notes[n].out=t}else if(/me\/my-note\/$/.test(t)){let t=window.decodeURI(i.replace(/(^")|("$)/g,"").replace(/\\u[\dA-F]{4}/gi,(t=>String.fromCharCode(parseInt(t.substr(2),16)))));this.indexDBData.notes[n].in=t,a.log(`R${n+1} 私人笔记: ${t}`)}else if(/me\/note\/(\d+)\/$/.test(t)){let e=JSON.parse(i),a=Number(t.match(/me\/note\/(\d+)\/$/)[1]),o=this.indexDBData.notes[n].out.findIndex((t=>t.about.id==a));this.indexDBData.notes[n].out[o].note=e.note}}startUpMountCSS(){let t=document.createElement("style");t.setAttribute("sct_id","basisCPT_preCSS"),t.textContent=`:root{--fontColor:${c.fontColor}}`,document.head.prepend(t)}async startupUserInfo(){let t=await a.getNetData(a.baseURL.userBase);t&&(this.indexDBData.userInfo[t.authCompany.realmId]=t,this.componentData.realm=t.authCompany.realmId,a.log("用户数据获取完毕：",t))}async startupWarehouseInfo(){let t=await a.getNetData(a.baseURL.warehouse);t&&null!=this.componentData.realm&&(this.indexDBData.warehouse[this.componentData.realm]=t,a.log("仓库数据更新完毕：",t))}async startupSideBarMain(){let t=document.createElement("div");t.innerHTML="<div><span title='SimComp-tools By:道洛LTS_Kim' id='script_bar_text'>SCT</span></div><div><button id='script_msg_switch' class=\"btn form-control\">信息</button></div><div><button id='script_cpt_switch' class=\"btn form-control\">组件</button></div>",t.id="script_hover_node",this.indexDBData.SCT_divHorizontal&&(t.className+=" horizontal"),this.indexDBData.SCT_divFixedDisplay&&(t.className+=" fixedDisplay");let e=document.createElement("div");e.innerHTML="<div id='scriptMsg_innerHead'><h1>消息</h1></div><div id=scriptMsg_main><table><tbody id=scriptMsg_mainBody><tr><td>时间<td>内容</table></div>",e.id="script_msg_node",e.className="script_base_container",a.msgBodyNode=e.querySelector("tbody#scriptMsg_mainBody");let i=this.sideBarSub_componentNode();i.id="script_cpt_node",i.className="script_base_container",t.querySelector("button#script_msg_switch").addEventListener("click",(t=>{clearInterval(a.msgShowFlag.timer),a.msgShowFlag.timer=void 0,a.msgShowFlag.flag=!1,Object.assign(document.querySelector("div#script_hover_node>div>span").style,{backgroundColor:"rgb(0,0,0,0)"}),Object.assign(document.querySelector("div#script_msg_node").style,{right:this.componentData.msgNodeShow?"-150%":"0px"}),this.componentData.msgNodeShow=!this.componentData.msgNodeShow,this.componentData.cptSwitchShow&&(Object.assign(document.querySelector("div#script_cpt_node").style,{right:"-150%"}),this.componentData.cptSwitchShow=!this.componentData.cptSwitchShow)})),t.querySelector("button#script_cpt_switch").addEventListener("click",(t=>{Object.assign(document.querySelector("div#script_cpt_node").style,{right:this.componentData.cptSwitchShow?"-150%":"0px"}),this.componentData.cptSwitchShow=!this.componentData.cptSwitchShow,this.componentData.msgNodeShow&&(Object.assign(document.querySelector("div#script_msg_node").style,{right:"-150%"}),this.componentData.msgNodeShow=!this.componentData.msgNodeShow)})),document.body.appendChild(t),document.body.appendChild(e),document.body.appendChild(i)}sideBarSub_componentNode(){let t=document.createElement("div"),e='<div id="scriptCPT_innerHead"><h1 style="margin-left:10px;">组件</h1><div style="padding:0 10px;"><input type="text" id="script_cptSearch_input" class="form-control" placeholder="搜索组件名..."></div></div>',i=Object.values(o).sort(((t,e)=>e.tapCount-t.tapCount));e+='<div id="scriptCPT_tagSerach">';let n=[];for(let t=0;t<i.length;t++)if(0!=i[t].tagList.length)for(let a=0;a<i[t].tagList.length;a++){let o=i[t].tagList[a];n.includes(o)||(n.push(o),e+=`<span>${o}</span>`)}e+="</div>",e+='<div id="scriptCPT_mainBody"><table><thead><tr><td>前台功能</td><td>设置</td></tr></thead><tbody>';for(let t=0;t<i.length;t++){let n=i[t];if(0==n.enable&&n.canDisable)continue;let a=n.constructor.name,o=n.name;e+=`<tr class="script_cpt_node" id='${a}'><td><button class="btn CPTOptionLeft ${Boolean(n.frontUI)?"funcExist":""}">${o}</button></td><td><button class="btn CPTOptionRight ${Boolean(n.settingUI)?"funcExist":""}">设置</button></td></tr>`}e+="</tbody></table></div>",t.innerHTML=e;let a=t.querySelectorAll("tbody > tr.script_cpt_node");for(let t=0;t<a.length;t++){let e=a[t],i=o[e.id],n=Boolean(i.frontUI)?()=>this.sideBarSub_showFront(i):()=>this.sideBarSub_noFront(),s=Boolean(i.settingUI)?()=>this.sideBarSub_showSetting(i):()=>this.sideBarSub_noSetting();e.querySelector("button.CPTOptionLeft").addEventListener("click",n),e.querySelector("button.CPTOptionRight").addEventListener("click",s)}return t.querySelector("input#script_cptSearch_input").addEventListener("change",(t=>this.sideBarSub_cptNameSearch(t))),t.querySelector("div#scriptCPT_tagSerach").addEventListener("click",(t=>this.sideBarSub_tagSearch(t))),t}sideBarSub_showFront(t){t.tapCount++,t.frontUI.call(t)}async sideBarSub_showSetting(t){if(t.tapCount++,this.componentData.cptSettingShow)return;let e=await t.settingUI.call(t);e.className.includes("col-sm-12 setting-container")||(e.className+=" col-sm-12 setting-container"),this.componentData.cptSettingBodyNode.appendChild(e),Object.assign(document.querySelector("div#script_cpt_setting_container").style,{display:"block"}),this.componentData.cptSettingShow=!0}sideBarSub_noFront(){a.alert("该组件没有前台窗口设计")}sideBarSub_noSetting(){a.alert("该组件没有可以设置的内容")}sideBarSub_cptNameSearch(t){let e=t.target.value;""==e&&(e=/.+/),this.componentData.cptSearchText=e,this.sideBarSub_updateButtonList()}sideBarSub_tagSearch(t){if("SPAN"!=t.target.tagName)return;let e=t.target.innerText,i=this.componentData.avtiveTagList.findIndex((t=>t==e));-1!=i?(this.componentData.avtiveTagList.splice(i,1),t.target.classList.remove("script_tagSearch_active")):(this.componentData.avtiveTagList.push(e),t.target.classList.add("script_tagSearch_active")),this.sideBarSub_updateButtonList()}sideBarSub_updateButtonList(){let t=Object.values(document.querySelectorAll("div#scriptCPT_mainBody tbody>tr"));for(let e=0;e<t.length;e++){let i=!1,n=!1,a=t[e].id;0==this.componentData.avtiveTagList.length&&(i=!0),this.componentData.avtiveTagList.every((t=>o[a].tagList.includes(t)))&&(i=!0),t[e].innerText.match(this.componentData.cptSearchText)&&(n=!0),Object.assign(t[e].style,{display:i&&n?"":"none"})}}async startupSettingContainer(){let t=document.createElement("div");t.innerHTML='<div id=script_setting_head><div class="col-sm-10 col-xs-9"><span>组件设置界面</span></div><div class="col-sm-2 col-xs-2"><button class=btn>关闭</button></div></div><div id=script_setting_body></div>',t.id="script_cpt_setting_container",document.body.appendChild(t),this.componentData.cptSettingContainerNode=t,this.componentData.cptSettingBodyNode=t.querySelector("div#script_setting_body"),t.querySelector("div#script_setting_head button").addEventListener("click",(()=>{this.componentData.cptSettingBodyNode.querySelectorAll("div").forEach((t=>t.remove())),Object.assign(document.querySelector("div#script_cpt_setting_container").style,{display:"none"}),this.componentData.cptSettingShow=!1}))}uisetting(){a.log(c);let t=document.createElement("div");t.id="script_setting_basisCPT",t.className="col-sm-12 setting-container";let e='<div><div class="header">插件基础功能设置</div><div class="container"><div><div><button class="btn script_opt_submit">保存</button></div></div><div><table><thead><tr><td>组件名</td><td>开关</td></tr></thead><tbody>',i=Object.values(o);for(let t=0;t<i.length;t++){let n=i[t],a=n.name;e+=`<tr><td><span title='${n.describe}'>${a}</span></td><td><input class='form-control' type="checkbox" ${n.enable?"checked":""} ${n.canDisable?"":"disabled"}></td></tr>`}e+=`</table></div><div><table><thead><tr><td>功能<td>设置<tbody><tr><td title=打开debug模式会有大量信息输出,可能会影响到性能,如非必要不要打开.>DEBUG模式<td><input class='form-control' type='checkbox' #####><tr><td title="只有插件主动发起的请求会被此项目限制\n官方文档说明低于5分钟就不安全了,用户请酌情设置. \n默认[10000ms]=10s">插件主动网络请求最小间隔<td><input type=number class=form-control value=#####><tr><td title="允许使用hex代码和rgb标号. \n默认 #ffffff">插件通用文字配色<td><input class=form-control value=#####><tr><td title="允许使用hex代码和rgb标号. \n默认 100 ">网页缩放比例<td><input type=number class=form-control value=#####><tr><td title="首要通知模式,默认是 网页内通知">主要通知模式<td><select class=form-control><option value=-1>无<option value=0>网页浏览器原生Notification对象(仅pc浏览器可用)<option value=1>网页内通知<option value=2>安卓通知通道</select><tr><td title="次要通知模式,默认是 无">次要通知模式<td><select class=form-control><option value=-1>无<option value=0>网页浏览器原生Notification对象(仅pc浏览器可用)<option value=1>网页内通知<option value=2>安卓通知通道</select><tr><td title="默认不勾选,勾选后SCT悬浮窗使用横向布局">悬浮窗横向排列</td><td><input type="checkbox" class="form-control" ${this.indexDBData.SCT_divHorizontal?"checked":""} ></td></tr><tr><td title="默认不勾选,勾选后SCT悬浮窗会固定在右下角不受hover影响">悬浮窗固定位置</td><td><input type="checkbox" class="form-control" ${this.indexDBData.SCT_divFixedDisplay?"checked":""} ></td></tr><tr><td title="无确认,删除插件所有缓存.非必要不用点">清除插件缓存</td><td><button class="btn form-control" id="script_reset">清除</button></td></tr><tr><td>插件缓存读写</td><td><button class="btn form-control" id="script_confEdit_enter">进入读写操作</button></td></tr></table></div></div></div>`,e=e.replace("#####",c.debug?"checked":""),e=e.replace("#####",c.net_gap_ms.toString()),e=e.replace("#####",c.fontColor.toString()),e=e.replace("#####",parseFloat(c.zoomRate)),t.innerHTML=e;let n=t.querySelectorAll("td>select");return n[0].value=c.notificationMode[0],n[1].value=c.notificationMode[1],t.querySelector("button#script_reset").addEventListener("click",(async()=>{await a.confirm("确定清理?")&&(a.indexDB_deleteAllData(),location.reload())})),t.querySelector("button#script_confEdit_enter").addEventListener("click",(()=>this.scriptConfEdit_build())),t.querySelector("button.script_opt_submit").addEventListener("click",(()=>this.uisettingSub())),t}uisettingSub(){let t=[],e=0,i=Object.keys(o).length;return document.querySelectorAll("div#script_setting_basisCPT input, div#script_setting_basisCPT select").forEach((e=>{"INPUT"==e.tagName&&"checkbox"==e.type?t.push(e.checked):"INPUT"==e.tagName&&"number"==e.type?t.push(parseFloat(e.value)):"INPUT"==e.tagName?t.push(e.value):"SELECT"==e.tagName&&t.push(parseInt(e.value))})),Math.floor(t[i+1])<=3e3?a.alert("插件主动网络请求最小间隔 不允许设置小于三秒"):a.hexArgbCheck(t[i+2])?t[i+3]>100||t[i+3]<=0?a.alert("网页缩放比例太离谱嗷.\n只允许 (0-100]."):-1==t[i+4]&&-1!=t[i+5]?a.alert("如果仅设置一个通知模式请使用主要通知模式."):t[i+4]==t[i+5]&&-1!=t[i+4]?a.alert("没必要都设置一样的."):(Object.values(o).forEach((i=>i.enable=t[e++])),c.debug=t[i+0],c.net_gap_ms=Math.floor(t[i+1]),c.fontColor=t[i+2],c.zoomRate=t[i+3]+"%",c.notificationMode=[t[i+4],t[i+5]],this.indexDBData.SCT_divHorizontal=t[i+6],this.indexDBData.SCT_divFixedDisplay=t[i+7],a.indexDB_updateFeatureConf(),a.indexDB_updateIndexDBData(),a.alert("已提交更新,即将刷新."),void location.reload()):a.alert("只支持HEX格式颜色和RGB格式颜色.")}async scriptConfEdit_build(){document.querySelector("div#script_cpt_setting_container>#script_setting_head button").click();let t=document.createElement("div"),e=document.createElement("style");e.setAttribute("sct_id","scriptConfEdit_css"),e.textContent="#scriptConfEdit_maim{width:100%;}#scriptConfEdit_maim button{height:100%;}#scriptConfEdit_maim textarea{height:5em;resize:none;width:100%;}#scriptConfEdit_maim table{border-spacing:10px;border-collapse:separate;}",t.id="scriptConfEdit_maim",t.innerHTML=`<div id=scriptConfEdit_maim><table><tr><td>导出文本<td><textarea>${await a.indexDB_genAllData2String()}</textarea><tr><td colspan=2><button class="btn form-control"script_id=download>下载json文件</button><tr><td>导入文本<td><textarea placeholder=在这里输入导入配置的文本></textarea><tr><td colspan=2><button class="btn form-control"script_id=submit>点击导入</button></table></div>`,a.alert(t,e),t.querySelector("button[script_id='download']").addEventListener("click",(t=>{let e=a.getParentByIndex(t.target,2).previousElementSibling.querySelector("textarea").value,i=`sct_userConf_${(new Date).getTime()}.json`;a.downloadTextFile(i,e),e=null})),t.querySelector("button[script_id='submit']").addEventListener("click",(async t=>{try{t.target.disabled=!0;let{feature_conf:e,indexDBData:i,tapCount:n}=JSON.parse(a.getParentByIndex(t.target,2).previousElementSibling.querySelector("textarea").value);await a.indexDB_loadUserConf(e,i,n),location.reload()}catch(t){return a.errorLog(t)}finally{t.target.disabled=!1}}))}async debounceSaveIndexDB(){a.log("触发防抖保存IndexedDB"),await a.indexDB_updateFeatureConf(),await a.indexDB_updateIndexDBData()}startupForDonation(){let t=document.createElement("div"),e=document.createElement("a");e.href="https://afdian.net/a/SCT-Editor",e.innerText="点我前往捐赠",e.setAttribute("target","_blank"),e.style.marginRight="10px";let i=document.createElement("a");i.innerText="捐赠者名单",i.addEventListener("click",(async t=>{let e=await a.getNetData(`https://cdn.jsdelivr.net/gh/ShenHaiSu/SimComp-APIProxy/commonData/donors.json?${await a.generateUUID()}`);e.sort((()=>Math.random()-.5));a.msg_send("","作为SimCompsTools开发者道洛LTS,我非常感谢每一个用户的支持与帮助,更感谢所有支持者的慷慨捐赠.您的慷慨使我能够继续投入时间和精力来提供更好的功能/修复问题和满足更多用户的需求.非常感谢大家!",1),a.msg_send("","捐赠者名单(不区分先后):",1),a.msg_send("",`${e.join(", ")}`,1),a.msg_send("","再次由衷的感谢所有支持者和用户!",1),t.preventDefault()})),t.appendChild(e),t.appendChild(i),a.msg_send("肚肚饿饿",t,1)}async startupExecutives(){let t=await a.getRealm(),e=await a.getNetData(a.baseURL.executives);if(!e)return await a.dely(5e3),this.startupExecutives();this.indexDBData.executives[t]=e,await a.indexDB_updateIndexDBData()}}},982:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class biggerAmcharts extends n{constructor(){super(),this.name="图表放大",this.describe="在总览页面或者财报页面点一下空白处触发检测就会放大图表\n灵感来源：Sim Companies Visual Improvements\nhttps://greasyfork.org/en/scripts/432355-sim-companies-visual-improvements",this.enable=!0,this.tagList=["样式","图表"]}commonFuncList=[{match:()=>Boolean(location.href.match(/headquarters\/(accounting\/|overview\/$)/)),func:this.mainFunc}];mainFunc(){if(location.href.endsWith("headquarters/overview/")){let t=document.querySelector("div.row > div.col-sm-6 > div > div > div");Object.assign(t.style,{height:"600px"});let e=a.getParentByIndex(t,4).lastChild;if(e.className="col-sm-6 text-center",e.querySelectorAll("br").length>1)return;e.lastChild.prepend(document.createElement("br")),e.lastChild.prepend(document.createElement("br")),e.lastChild.prepend(document.createElement("br"))}else{let t=document.querySelector("div.col-md-9 > div > div > div > div > div.amcharts-main-div");t=t.parentElement,Object.assign(t.style,{height:"600px"})}}}},10:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c,langData:l}=i(658);new class bondTracker extends n{constructor(){super(),this.name="债券市场追踪器",this.describe="用于定时查询当前债券市场是否有符合要求的债券可供购买",this.enable=!0,this.tagList=["债券","追踪"]}indexDBData={realmData:[{minAmount:0,minCredit:0,minInterest:.55},{minAmount:0,minCredit:0,minInterest:.55}],autoTrack:!1};componentData={baseURL:"https://www.simcompanies.com/api/bonds/rating/AAA-to-D/",creditRatingList:["AAA","AA+","AA","AA-","A+","A","A-","BBB+","BBB","BBB-","BB+","BB","BB-","B+","B","B-","C","D"],trackerFlag:void 0};startupFuncList=[this.startTracker];frontUI=()=>this.trackerHandle("common");settingUI=async()=>{let t=document.createElement("div"),e='<div class=header>债券市场追踪器设置</div><div class=container><div><button class="btn script_opt_submit">保存更改</button></div><table><thead><tr><td>功能<td>设置<tbody><tr><td>当前服务器<td>######<tr><td title=勾选就打开定时追踪,会在1-2分钟钟随机一个间隔进行周期性检查>定时追踪<td><input class=form-control type=checkbox ######><tr><td title=如题>最低数量<td><input class=form-control type=number value=######><tr><td title=如题>最低评级<td><select class=form-control><option value=0>AAA<option value=1>AA+<option value=2>AA<option value=3>AA-<option value=4>A+<option value=5>A<option value=6>A-<option value=7>BBB+<option value=8>BBB<option value=9>BBB-<option value=10>BB+<option value=11>BB<option value=12>BB-<option value=13>B+<option value=14>B<option value=15>B-<option value=16>C<option value=17>D</select><tr><td title=如题>最低利息<td><input class=form-control type=number value=######></table></div>',i=await a.getRealm();return e=e.replace("######",0==i?"R1 M服":"R2 E服"),e=e.replace("######",this.indexDBData.autoTrack?"checked":""),e=e.replace("######",this.indexDBData.realmData[i].minAmount),e=e.replace("######",this.indexDBData.realmData[i].minInterest),t.innerHTML=e,t.id="script_bondTracker_setting",t.querySelector("select").value=this.indexDBData.realmData[i].minCredit,t.addEventListener("click",(t=>this.settingClickHandle(t))),t};settingClickHandle(t){if(t.target.className.match("script_opt_submit"))return this.settingSubmit()}async settingSubmit(){let t=Object.values(document.querySelectorAll("div#script_bondTracker_setting input, div#script_bondTracker_setting select")).map((t=>"checkbox"==t.type?t.checked:t.value)),e=await a.getRealm();return t[1]=Math.floor(t[1]),t[2]=Math.floor(t[2]),t[3]=parseFloat(t[3]),t[1]<0?a.alert("最低数量不能是负数"):t[3]<0||t[3]>2?a.alert("不会存在超出 0-2 之间的利率"):(this.indexDBData.autoTrack=t[0],this.indexDBData.realmData[e].minAmount=t[1],this.indexDBData.realmData[e].minCredit=t[2],this.indexDBData.realmData[e].minInterest=t[3],this.startTracker(),a.alert("保存并重启更新"))}startTracker(){this.componentData.trackerFlag&&clearInterval(this.componentData.trackerFlag),this.indexDBData.autoTrack&&(this.componentData.trackerFlag=setInterval((()=>this.trackerHandle("slient")),a.getRandomNumber(6e4,12e4,parseInt)))}async trackerHandle(t="common"){let e=await a.getRealm(),i=await a.getNetData(this.componentData.baseURL);if(!i)return;let n=this.indexDBData.realmData[e],o=i.filter((t=>{let e=this.componentData.creditRatingList.findIndex((e=>e==t.seller.rating)),i=-1!=e&&e<=n.minCredit,a=t.amount>=n.minAmount,o=t.interest>=n.minInterest;return i&&a&&o})).map((t=>`${t.seller.company}发售了${t.amount}只利率为${t.interest}的股票,其信用评级为:${t.seller.rating}`));if(0==o.length&&"slient"!=t)return a.msg_send("债券市场追踪器","未找到符合要求的债券.");for(let t=0;t<o.length;t++)a.msg_send("债券市场追踪器",o[t])}}},268:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class buildingEndMsg extends n{constructor(){super(),this.name="建筑生产完工提示",this.describe="建筑生产完成或者升级完成后会有消息提示，防止你泡在ChatRoom全给忘了。",this.enable=!0,this.tagList=["建筑","追踪"]}startupFuncList=[this.mainFunc];indexDBData={time2gap:3e5,msg_title:"建筑项目完工",msg_body:"您有一个新的建筑完工了，可以续派任务咯~"};componentData={intervalFlag:void 0};mainFunc(t,e="start"){if(a.log(e),!this.enable)return;let i=this.componentData;return"clear"==e?(clearInterval(i.intervalFlag),null==i.intervalFlag):"restart"==e?(clearInterval(i.intervalFlag),i.intervalFlag,this.mainFunc("start")):void(i.intervalFlag||(i.intervalFlag=setInterval((()=>this.innerFunc()),this.indexDBData.time2gap),a.log("开始监听建筑信息")))}async innerFunc(){if(!this.enable)return;let t=!1,e=s.basisCPT.realm,i=r.basisCPT.building[e],n=await a.getNetData(a.baseURL.building);if(0==n)return;let o={};for(let t=0;t<i.length;t++)o[i[t].id]=i[t];for(let e=0;e<n.length;e++)if(o[n[e].id]&&o[n[e].id].busy&&!n[e].hasOwnProperty("busy")){t=!0;break}i=n,t&&a.msg_send("建筑生产状态变动","您的建筑中有一部分完成了生产！")}settingUI=()=>{let t=document.createElement("div"),e="<div><div class='header'>建筑项目完工提醒设置</div><div class='container'><div><div><button class=\"btn script_opt_submit\">保存</button></div></div><table><tr style=height:60px><td>功能<td>设置<tr><td title=单个检查的周期，默认5分钟，单位毫秒>检查时间间隔<td><input class='form-control' value=##### type=number><tr><td title=发送信息的标题>信息标题<td><input class='form-control' value=#####><tr><td title=信息内容>信息内容<td><input class='form-control' value=#####></table></div></div>";return e=e.replace("#####",`"${this.indexDBData.time2gap.toString()}"`),e=e.replace("#####",`"${this.indexDBData.msg_title}"`),e=e.replace("#####",`"${this.indexDBData.msg_body}"`),t.innerHTML=e,t.id="setting-container-6",t.className="col-sm-12 setting-container",t.querySelector("button.script_opt_submit").addEventListener("click",(()=>this.settingSubmitHandle())),t};async settingSubmitHandle(){let t=[];if(document.querySelectorAll("#setting-container-6 input").forEach((e=>t.push(e.value))),t[0]<c.net_gap_ms)return a.alert("功能是通过发送网络请求来检查建筑状态的\n请求间隔时间不要小于'通用网络请求最小间隔'。");""==t[1]&&(t[1]="建筑项目完工"),""==t[2]&&(t[2]="您有一个新的建筑完工了，可以续派任务咯~"),this.indexDBData.time2gap=Math.floor(t[0]),this.indexDBData.msg_title=t[1],this.indexDBData.msg_body=t[2],await a.indexDB_updateIndexDBData(),this.mainFunc(void 0,"restart"),a.alert("已提交设置并保存。")}}},248:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class chatBiggerTextarea extends n{constructor(){super(),this.name="聊天室输入框自动放大",this.describe="在输入的时候自动放大",this.enable=!1,this.tagList=["样式","聊天"]}componentData={lastElement:void 0};commonFuncList=[{match:t=>null!=t&&/messages\/(.+)/.test(location.href),func:this.mainFunc}];cssText=['div.input-group>div>div>textarea.script_showBig{height:200px !important;top:-150px !important;}div#script_BiggerTextarea_setAfter:after{content:"";display:block;height:150px;}'];mainFunc(t){let e=window.document.activeElement;try{if("TEXTAREA"===e.tagName){if(e.style.transition="ease-in-out 0.2s",e==this.componentData.lastElement&&e.classList.contains("script_showBig"))return;e==this.componentData.lastElement?this.addBigClass(e,void 0):e.classList.contains("script_showBig")?this.addBigClass(void 0,this.componentData.lastElement):this.addBigClass(e,this.componentData.lastElement)}else this.addBigClass(void 0,this.componentData.lastElement)}finally{"TEXTAREA"===e.tagName&&(this.componentData.lastElement=e)}}addBigClass(t,e){if(t){t.classList.add("script_showBig");let e=a.getParentByIndex(t,6).previousElementSibling.childNodes[0].childNodes[0];e.style.transition="ease-in-out 0.2s",e.id="script_BiggerTextarea_setAfter"}if(e){e.classList.remove("script_showBig");let t=a.getParentByIndex(e,6).previousElementSibling.childNodes[0].childNodes[0];t.style.transition="ease-in-out 0.2s",t.id=""}}}},22:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class chatFilter extends n{constructor(){super(),this.name="聊天信息过滤/高亮",this.describe="在聊天界面,隐藏/高亮符合规则的信息",this.enable=!1,this.tagList=["聊天","过滤"]}indexDBData={checkMode:0,hide_item:["fuck","妈的","媽的","shit"],hightLight_item:[],hide_reg:/^$/,highLight_reg:/^$/};chatMsgFuncList=[this.mainCheck];cssText=["@keyframes script_borderColorChange{0%{border-color:#ff0000;}50%{border-color:#00ff00;}100%{border-color:#ff0000;}}.script_chatFilter_hightLightClass{border:5px solid;animation:script_borderColorChange 2s infinite linear;}.script_chatFilter_hideClass{opacity:0.05;transition:ease-in-out 0.1s;}.script_chatFilter_hideClass:hover{opacity:0.9;}"];settingUI=()=>{let t=document.createElement("div"),e='<div class="header">聊天信息过滤/高亮设置</div><div class="container"><div><button class="btn script_opt_submit">保存更改</button></div>';e+='<table><thead><tr><td>功能<td>设置<tbody><tr><td title="启用一种,另一种模式会直接失效\n[默认]列表匹配 - 匹配上任意一个列表中的内容就会响应 \n正则匹配 - 使用正则的匹配纯文本">匹配模式<td><select class=form-control><option value=0>列表匹配<option value=1>正则匹配</select><tr><td>高亮正则<td><input value="#####" class=form-control><tr><td>过滤正则<td><input value="#####" class=form-control></table>',e=e.replace("#####",`/${this.indexDBData.highLight_reg.source}/${this.indexDBData.highLight_reg.flags}`),e=e.replace("#####",`/${this.indexDBData.hide_reg.source}/${this.indexDBData.hide_reg.flags}`),e+="<table><thead><tr><td>高亮的内容</td><td>删除</td></tr></thead><tbody>";for(let t=0;t<this.indexDBData.hightLight_item.length;t++)e+=`<tr><td><input class="form-control" value="${this.indexDBData.hightLight_item[t]}"></td><td><button class="btn script_chatFilter_delete">删除</button></td></tr>`;e+='</tbody></table><button class="btn" style="width: 100%;" id="script_chatFilter_add">添加</button><table><thead><tr><td>过滤/屏蔽的内容</td><td>删除</td></tr></thead><tbody>';for(let t=0;t<this.indexDBData.hide_item.length;t++)e+=`<tr><td><input class="form-control" value="${this.indexDBData.hide_item[t]}"></td><td><button class="btn script_chatFilter_delete">删除</button></td></tr>`;return e+='</tbody></table><button class="btn" style="width: 100%;" id="script_chatFilter_add">添加</button></div>',t.id="script_chatFiletr_setting",t.innerHTML=e,t.querySelector("select").value=this.indexDBData.checkMode,t.querySelector("select").addEventListener("change",(t=>this.settingModeChange(t))),t.querySelector("select").dispatchEvent(new Event("change")),t.addEventListener("click",(t=>this.settingClick(t))),t};settingModeChange(t){let e=Number(t.target.value);if(0==e){let e=a.getParentByIndex(t.target,2);e.nextElementSibling.style.display="none",e.nextElementSibling.nextElementSibling.style.display="none",e=a.getParentByIndex(t.target,4);let i=e.nextElementSibling;for(;null!=i;)i.style.display="",i=i.nextElementSibling}else if(1==e){let e=a.getParentByIndex(t.target,2);e.nextElementSibling.style.display="",e.nextElementSibling.nextElementSibling.style.display="",e=a.getParentByIndex(t.target,4);let i=e.nextElementSibling;for(;null!=i;)i.style.display="none",i=i.nextElementSibling}}settingClick(t){return"script_chatFilter_add"==t.target.id?this.settingAddNode(t):/script_opt_submit/.test(t.target.className)?this.settingSubmit(t):/script_chatFilter_delete/.test(t.target.className)?this.settingDeleteOne(t):void 0}settingSubmit(t){let e=a.getParentByIndex(t.target,3),i=Object.values(e.querySelectorAll("table")),n=Object.values(i[0].querySelectorAll("input, select")).map((t=>t.value)),o=Object.values(i[1].querySelectorAll("input")).map((t=>t.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))),s=Object.values(i[2].querySelectorAll("input")).map((t=>t.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")));return""==n[1]&&(n[1]="/^$/"),""==n[2]&&(n[2]="/^$/"),a.regStringCheck(n[1])&&a.regStringCheck(n[2])?0!=o.filter((t=>""==t)).length||0!=s.filter((t=>""==t)).length?a.alert("内容不能为空"):(this.indexDBData.checkMode=Number(n[0]),this.indexDBData.highLight_reg=new RegExp(n[1].replace(/^\//,"").replace(/\/[img]*$/,""),n[1].match(/\/([img])*$/)[1]),this.indexDBData.hide_reg=new RegExp(n[2].replace(/^\//,"").replace(/\/[img]*$/,""),n[2].match(/\/([img])*$/)[1]),this.indexDBData.hightLight_item=o,this.indexDBData.hide_item=s,a.indexDB_updateIndexDBData(),void a.alert("已提交更改.")):a.alert("正则表达式语法不正确")}settingAddNode(t){let e=t.target.previousElementSibling.querySelector("tbody"),i=document.createElement("tr");i.innerHTML='<td><input class="form-control"></td><td><button class="btn script_chatFilter_delete">删除</button></td>',e.appendChild(i)}settingDeleteOne(t){a.getParentByIndex(t.target,2).remove()}mainCheck(t,e){let i=t.childNodes[2].childNodes;for(let t=0;t<i.length;t++){let n=i[t];"I"!=n.childNodes[0].tagName&&(/script_chatFilter_hideClass/.test(n.childNodes[0].className)||/script_chatFilter_hightLightClass/.test(n.childNodes[0].className)||(this.checkSubString(e[t],this.indexDBData.hide_item,this.indexDBData.hide_reg)?n.childNodes[0].className+=" script_chatFilter_hideClass":this.checkSubString(e[t],this.indexDBData.hightLight_item,this.indexDBData.highLight_reg)&&(n.childNodes[0].className+=" script_chatFilter_hightLightClass")))}}checkSubString=(t,e,i)=>{switch(this.indexDBData.checkMode){case 0:return this.listModeCheck(t,e);case 1:return this.regModeCheck(t,i)}};listModeCheck=(t,e)=>e.some((e=>-1!=t.indexOf(e)));regModeCheck=(t,e)=>e.test(t)}},76:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class chatHelper extends n{constructor(){super(),this.name="聊天辅助",this.describe="包括聊天室图片解析/聊天室快捷消息/emoji选择器/自定义表情发送等功能",this.enable=!1,this.tagList=["聊天","样式"]}indexDBData={quickMsgAutoSend:!1,quickMsgList:[],emojiFavList:[],customEmoteList:[]};componentData={emoteReg:/https:\/\/[^\s]+\.(jpg|jpeg|png|gif|webp)/g,templateNode:void 0,menuNode:void 0,lastTextarea:void 0,isShow:!1,showTimer:void 0,emojiSelectAllNode:null,emojiSelectFavNode:null};cssText=['div.script_chatHelper_chatEmote_container{display:flex;width:100%;flex-wrap:wrap;}div.script_chatHelper_chatEmote_container img{flex:1 0 calc(20% - 10px);margin:5px;max-width:15%;max-height:15%;}div.script_chatHelper_chatEmote_container img.showBig{position:fixed;top:50%;left:50%;z-index:5000;transform:translate(-50%,-50%);max-width:95%;max-height:95%;}div.script_chatHelper_quickMsg_container{position:absolute;top:0;right:37px;height:55px;width:37px;}div.script_chatHelper_quickMsg_container>a>svg{display:block;width:100%;height:55px;}div[sct_cpt=\'chatHelper\'][sct_id="baseContainer"]{height:200px;width:400px;position:absolute;transform:translate(-100%,-100%);background-color:#0000009f;border-radius:5px;padding:5px;}div[sct_cpt=\'chatHelper\'][sct_id="baseContainer"]>[sct_id="menu"]{width:100%;height:150px;background-color:#ffffff30;overflow-y:auto;}div[sct_cpt=\'chatHelper\']>[sct_id="menu"]>[sct_name="emoji"]{font-size:25px;}div[sct_cpt=\'chatHelper\']>[sct_id="menu"]>[sct_name="emoji"]>[sct_name=\'allEmoji\'],div[sct_cpt=\'chatHelper\']>[sct_id="menu"]>[sct_name="emoji"]>[sct_name=\'favEmoji\']{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:flex-start;align-items:stretch;}div[sct_cpt=\'chatHelper\']>[sct_id="menu"]>[sct_name="emoji"]>[sct_name=\'favEmoji\']{margin-bottom:30px;}div[sct_cpt=\'chatHelper\']>[sct_id="menu"]>[sct_name="emoji"]>[sct_name=\'allEmoji\']>div,div[sct_cpt=\'chatHelper\']>[sct_id="menu"]>[sct_name="emoji"]>[sct_name=\'favEmoji\']>div{flex:1;min-width:40px;text-align:center;}div[sct_cpt=\'chatHelper\']>[sct_id="menu"]>[sct_name="emoji"]>[sct_name=\'allEmoji\']>div:hover,div[sct_cpt=\'chatHelper\']>[sct_id="menu"]>[sct_name="emoji"]>[sct_name=\'favEmoji\']>div:hover{cursor:pointer;}div[sct_cpt=\'chatHelper\'][sct_id="baseContainer"]>[sct_id="tabBar"]{width:100%;height:38px;}div[sct_cpt=\'chatHelper\'][sct_id="baseContainer"]>[sct_id="tabBar"]>[sct_id="tab"]{line-height:40px;font-size:25px;width:40px;height:100%;text-align:center;vertical-align:middle;transition:ease-in-out 0.2s;display:inline-block;}div[sct_cpt=\'chatHelper\'][sct_id="baseContainer"]>[sct_id="tabBar"]>[sct_id="tab"].active{background-color:#ffffff30;}div[sct_cpt=\'chatHelper\'][sct_id="baseContainer"]>[sct_id="tabBar"]>[sct_id="tab"]:hover{background-color:#ffffff70 !important;cursor:pointer;}div[sct_cpt=\'chatHelper\'][sct_id="baseContainer"]>[sct_id="tabBar"]>[sct_id="tab"]>span>svg{width:100%;height:100%;}div[sct_cpt="chatHelper"][sct_id="submenu"][sct_name="customEmote"]>div[sct_name=\'addEmote\']{background-color:#00000050;width:100%;height:0;display:flex;padding:0px;align-items:center;vertical-align:middle;text-align:left;transition:ease-in-out 0.2s;overflow:hidden;}div[sct_cpt="chatHelper"][sct_id="submenu"][sct_name="customEmote"]>div[sct_name=\'addEmote\'].showBig{height:60px;padding:5px;}div[sct_cpt="chatHelper"][sct_id="submenu"][sct_name="customEmote"]>div[sct_name=\'addEmote\']>input{flex:6;height:35px;margin-right:5px;}div[sct_cpt="chatHelper"][sct_id="submenu"][sct_name="customEmote"]>div[sct_name=\'addEmote\']>button{display:inline-block;width:60px;flex:1;color:var(--fontColor);background-color:black;}div[sct_cpt="chatHelper"][sct_id="submenu"][sct_name="customEmote"]>div[sct_name=\'customEmoteAll\']{display:flex;flex-direction:row;align-items:stretch;justify-content:flex-start;flex-wrap:wrap;}div[sct_cpt="chatHelper"][sct_id="submenu"][sct_name="customEmote"]>div[sct_name=\'customEmoteAll\']>div{flex:1;width:20%;max-height:50px;min-width:15%;text-align:center;margin:10px 0;}div[sct_cpt="chatHelper"][sct_id="submenu"][sct_name="customEmote"]>div[sct_name=\'customEmoteAll\']>div:nth-child(1)>span{display:block;width:100%;height:100%;}div[sct_cpt="chatHelper"][sct_id="submenu"][sct_name="customEmote"]>div[sct_name=\'customEmoteAll\']>div>img{max-width:100%;max-height:100%;}div[sct_cpt=\'chatHelper\'][sct_id=\'submenu\'][sct_name="quickMsg"] button,div[sct_cpt=\'chatHelper\'][sct_id=\'submenu\'][sct_name="quickMsg"] input{color:var(--fontColor);background-color:#0000008e;}div[sct_cpt=\'chatHelper\'][sct_id=\'submenu\'][sct_name="quickMsg"]>div[sct_name=\'addQuickMsg\']{margin:10px 5px;padding:5px;display:flex;flex-wrap:nowrap;justify-content:center;color:var(--fontColor);}div[sct_cpt=\'chatHelper\'][sct_id=\'submenu\'][sct_name="quickMsg"]>div[sct_name=\'addQuickMsg\']>input{margin-right:10px;}div[sct_cpt=\'chatHelper\'][sct_id=\'submenu\'][sct_name="quickMsg"]>div[sct_name=\'quickMsgBase\']{padding:5px;}div[sct_cpt=\'chatHelper\'][sct_id=\'submenu\'][sct_name="quickMsg"]>div[sct_name=\'quickMsgBase\'] table{width:100%;border-collapse:separate;border-spacing:10px;}div[sct_cpt=\'chatHelper\'][sct_id=\'submenu\'][sct_name="quickMsg"]>div[sct_name=\'quickMsgBase\'] table>tbody>tr>td:nth-child(1){width:75%;}div[sct_cpt=\'chatHelper\'][sct_id=\'submenu\'][sct_name="quickMsg"]>div[sct_name=\'quickMsgBase\'] table>tbody>tr>td:nth-child(2){width:20%;}'];chatMsgFuncList=[this.chatEmoteCheck];startupFuncList=[this.addChatEmoteClick];commonFuncList=[{match:this.mountCheck,func:this.mountFunc}];addChatEmoteClick(){document.body.addEventListener("click",(t=>{"IMG"===t.target.tagName&&"DIV"===t.target.parentElement.tagName&&/script_chatHelper_chatEmote_container/.test(t.target.parentElement.className)&&t.target.classList.toggle("showBig")}))}chatEmoteCheck(t,e){if(!t.querySelector("div.script_chatHelper_chatEmote_container")&&"DIV"!=t.childNodes[0].tagName)for(let i=0;i<t.childNodes[2].childNodes.length;i++){let n=t.childNodes[2].childNodes[i].childNodes[0];"I"==n.tagName&&(n=t.childNodes[2].childNodes[i].childNodes[1]);let a=e[i].match(this.componentData.emoteReg);if(null===a)continue;let o=document.createElement("div"),s="";for(let t=0;t<a.length;t++)s+=`<img src='${a[t]}' />`;o.className="script_chatHelper_chatEmote_container",o.innerHTML=s,n.appendChild(o)}}mountCheck(t){if(!t||!/messages\/(.+)/.test(location.href))return!1;return document.querySelectorAll("div.input-group textarea").length!=document.querySelectorAll("div.input-group button.script_chatHelper_chatQuickMsg_button").length}mountFunc(){let t=Object.values(document.querySelectorAll("div.input-group textarea")).map((t=>a.getParentByIndex(t,2))).filter((t=>"77px"!=t.style.right));if(!this.componentData.templateNode){let t=document.createElement("div");t.className="script_chatHelper_quickMsg_container",t.innerHTML='<a><svg style=display:block;width:100%;height:55px viewBox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M8 22.5v-5.525q-2.525-.2-4.262-2.05T2 10.5q0-2.725 1.888-4.612T8.5 4h.675L7.6 2.4L9 1l4 4l-4 4l-1.4-1.4L9.175 6H8.5Q6.625 6 5.313 7.313T4 10.5q0 1.875 1.313 3.188T8.5 15H10v2.675L12.675 15H15.5q1.875 0 3.188-1.312T20 10.5q0-1.875-1.312-3.187T15.5 6H15V4h.5q2.725 0 4.613 1.888T22 10.5q0 2.725-1.888 4.613T15.5 17h-2z"fill=currentColor></path></svg></a>',this.componentData.templateNode=t}for(let e=0;e<t.length;e++){t[e].style.right="77px";let i=this.componentData.templateNode.cloneNode(!0);i.addEventListener("click",(t=>this.helperButtonClick(t))),a.getParentByIndex(t[e],1).insertBefore(i,t[e].nextElementSibling)}}helperButtonClick(t){t.preventDefault(),t.stopPropagation(),this.componentData.menuNode||this.buildBaseNode(),this.componentData.showTimer&&clearTimeout(this.componentData.showTimer);let e=1,i=null;for(;!Boolean(i);)i=a.getParentByIndex(t.target,e++).querySelector("textarea");0==a.clientHorV&&Object.assign(this.componentData.menuNode.style,{display:"block",top:t.clientY-10+"px",left:t.clientX-10+"px"}),1==a.clientHorV&&Object.assign(this.componentData.menuNode.style,{display:"block",top:t.clientY-10+"px",right:"10px",width:"360px",zIndex:2e3,transform:"translate(0,-100%)"}),this.componentData.lastTextarea==i&&this.componentData.isShow?(Object.assign(this.componentData.menuNode.style,{display:"none"}),this.componentData.isShow=!1):(this.componentData.lastTextarea=i,this.componentData.isShow=!0,this.componentData.showTimer=setTimeout((()=>this.closeContainer()),1e4))}buildBaseNode(){let t=document.createElement("div");t.setAttribute("sct_cpt","chatHelper"),t.setAttribute("sct_id","baseContainer");t.innerHTML='<div sct_cpt=chatHelper sct_id=menu><div sct_cpt=chatHelper sct_id=submenu sct_name=emoji></div><div sct_cpt=chatHelper sct_id=submenu sct_name=customEmote></div><div sct_cpt=chatHelper sct_id=submenu sct_name=quickMsg></div></div><div sct_cpt=chatHelper sct_id=tabBar><div sct_cpt=chatHelper sct_id=tab sct_name=emoji><span>😊</span></div><div sct_cpt=chatHelper sct_id=tab sct_name=customEmote><span><svg viewBox="0 0 24 24"xmlns=http://www.w3.org/2000/svg><path d="M19.071 13.142L13.414 18.8a2 2 0 0 1-2.828 0l-5.657-5.657A5 5 0 1 1 12 6.072a5 5 0 0 1 7.071 7.07"fill=none stroke=#EF3939 stroke-linecap=round stroke-linejoin=round stroke-width=2.5 /></svg></span></div><div sct_cpt=chatHelper sct_id=tab sct_name=quickMsg><span><svg viewBox="0 0 12 12"xmlns=http://www.w3.org/2000/svg><path d="M4 5.5a.5.5 0 0 1 .5-.5h3a.5.5 0 1 1 0 1h-3a.5.5 0 0 1-.5-.5M4.5 7a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1zM1 6a5 5 0 1 1 2.59 4.382l-1.944.592a.5.5 0 0 1-.624-.624l.592-1.947A4.98 4.98 0 0 1 1 6m5-4a4 4 0 0 0-3.417 6.08a.5.5 0 0 1 .051.406l-.383 1.259l1.257-.383a.5.5 0 0 1 .407.052A4 4 0 1 0 6 2"fill=#58A8CF /></svg></span></div></div>',t.addEventListener("click",(t=>this.mainMenuClick(t))),this.componentData.menuNode=t,document.body.appendChild(t),this.buildEmojiSelectorNode(),this.buildCustomEmoteNode(),this.buildQuickMsgNode(),t.querySelector("div[sct_name='emoji'][sct_id='tab']").firstChild.click()}buildEmojiSelectorNode(){let t=this.componentData.menuNode.querySelector('div[sct_id="submenu"][sct_name="emoji"]');t.innerHTML="",t.style.display="none",t.appendChild(this.buildFavEmojiSelectorAllNode()),t.appendChild(this.buildEmojiSelectorAllNode()),t.addEventListener("click",(e=>{if(e.target.innerText.length>2||0==e.target.innerText.length)return;this.textareaAdd(e.target.innerText);let i=this.indexDBData.emojiFavList.findIndex((t=>t.text==e.target.innerText));-1==i?this.indexDBData.emojiFavList.push({text:e.target.innerText,count:1}):this.indexDBData.emojiFavList[i].count++,this.componentData.menuNode.querySelector('div[sct_name="favEmoji"]')?.remove(),t.prepend(this.buildFavEmojiSelectorAllNode()),a.indexDB_updateIndexDBData()}))}buildCustomEmoteNode(){let t=this.componentData.menuNode.querySelector('div[sct_id="submenu"][sct_name="customEmote"]'),e=document.createElement("div");e.setAttribute("sct_cpt","chatHelper"),e.setAttribute("sct_name","addEmote"),e.innerHTML='<input><button class="btn form-control">添加</button>',t.appendChild(e),t.appendChild(this.buildCustomEmoteAllNode()),t.addEventListener("click",(t=>this.customEmoteClick(t))),t.addEventListener("contextmenu",(t=>this.deleteCustomEmote(t)))}buildQuickMsgNode(){let t=this.componentData.menuNode.querySelector('div[sct_id="submenu"][sct_name="quickMsg"]'),e=document.createElement("div");e.setAttribute("sct_cpt","chatHelper"),e.setAttribute("sct_name","addQuickMsg"),e.innerHTML='<input style=\'text-align: left;\' type="text" placeholder="别名" class=\'form-control\' sct_name="alias" ><input style=\'text-align: left;\' type="text" placeholder="内容" class=\'form-control\' sct_name="content"><button sct_name="submit" class=\'form-control\'>添加</button>',t.appendChild(e),e.addEventListener("click",(t=>this.addQuickMsg(t))),t.appendChild(this.buildQuickMsgAllNode())}buildFavEmojiSelectorAllNode(){let t=document.createElement("div"),e="";this.indexDBData.emojiFavList.sort(((t,e)=>e.count-t.count));for(let t=0;t<this.indexDBData.emojiFavList.length;t++){e+=`<div><span>${this.indexDBData.emojiFavList[t].text}</span></div>`}return t.setAttribute("sct_name","favEmoji"),t.innerHTML=e,t}buildEmojiSelectorAllNode(){if(this.componentData.emojiSelectAllNode)return this.componentData.emojiSelectAllNode;let t=document.createElement("div"),e="";for(let t=127744;t<=129519;t++){e+=`<div><span>${String.fromCodePoint(t)}</span></div>`}return t.innerHTML=e,t.setAttribute("sct_name","allEmoji"),this.componentData.emojiSelectAllNode=t,this.componentData.emojiSelectAllNode}buildCustomEmoteAllNode(){let t=document.createElement("div"),e='<div><span><svg height=50 viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path clip-rule=evenodd d="M7.345 4.017a42.253 42.253 0 0 1 9.31 0c1.713.192 3.095 1.541 3.296 3.26a40.66 40.66 0 0 1 0 9.446c-.201 1.719-1.583 3.068-3.296 3.26a42.245 42.245 0 0 1-9.31 0c-1.713-.192-3.095-1.541-3.296-3.26a40.652 40.652 0 0 1 0-9.445a3.734 3.734 0 0 1 3.295-3.26M12 7.007a.75.75 0 0 1 .75.75v3.493h3.493a.75.75 0 1 1 0 1.5H12.75v3.493a.75.75 0 0 1-1.5 0V12.75H7.757a.75.75 0 0 1 0-1.5h3.493V7.757a.75.75 0 0 1 .75-.75"fill=currentColor fill-rule=evenodd /></svg></span></div>';t.setAttribute("sct_cpt","chatHelper"),t.setAttribute("sct_name","customEmoteAll");for(let t=0;t<this.indexDBData.customEmoteList.length;t++){e+=`<div sct_index='${t}'><img src='${this.indexDBData.customEmoteList[t]}'/></div>`}return t.innerHTML=e,t}buildQuickMsgAllNode(){let t=document.createElement("div"),e="<table><tbody>";t.setAttribute("sct_cpt","chatHelper"),t.setAttribute("sct_name","quickMsgBase");for(let t=0;t<this.indexDBData.quickMsgList.length;t++){e+=`<tr><td><button class='form-control' sct_index='${t}'>${this.indexDBData.quickMsgList[t].alias}</button></td><td><button class='form-control'>删除</button></td></tr>`}return e+="</tbody></table>",t.innerHTML=e,t.addEventListener("click",(t=>this.quickMsgClick(t))),t}mainMenuClick(t){this.componentData.showTimer&&clearTimeout(this.componentData.showTimer),this.componentData.showTimer=setTimeout((()=>this.closeContainer()),1e4);let e=1,i=null;try{for(;e<=3&&!Boolean(i)&&(i=a.getParentByIndex(t.target,e++),!i||"tab"!=i.getAttribute("sct_id"));)i=null}catch{i=null}if(!Boolean(i))return;let n=i.getAttribute("sct_name");document.querySelectorAll("div[sct_cpt='chatHelper'][sct_id='menu']>div").forEach((t=>t.style.display="none")),document.querySelector(`div[sct_cpt='chatHelper'][sct_id='menu']>div[sct_name='${n}']`).style.display="",i.parentElement.querySelectorAll("div[sct_id='tab']").forEach((t=>t.className="")),i.className="active"}customEmoteClick(t){let e=t.target;return/path|svg|span/i.test(e.tagName)?document.querySelector("div[sct_cpt='chatHelper'][sct_name='addEmote']").classList.toggle("showBig"):/button/i.test(e.tagName)?this.addCustomEmote(t):void("IMG"==e.tagName&&e.parentElement.getAttribute("sct_index")?(this.textareaAdd(" "+this.indexDBData.customEmoteList[e.parentElement.getAttribute("sct_index")]+" "),this.closeContainer()):"DIV"==e.tagName&&e.getAttribute("sct_index")&&(this.textareaAdd(" "+this.indexDBData.customEmoteList[e.getAttribute("sct_index")]+" "),this.closeContainer()))}deleteCustomEmote(t){t.preventDefault();let e=t.target,i=-1;"IMG"==e.tagName&&e.parentElement.getAttribute("sct_index")?i=e.parentElement.getAttribute("sct_index"):"DIV"==e.tagName&&e.getAttribute("sct_index")&&(i=e.getAttribute("sct_index")),-1!=i&&null!=i&&(this.indexDBData.customEmoteList.splice(i,1),a.indexDB_updateIndexDBData(),document.querySelector('div[sct_cpt="chatHelper"][sct_name="customEmoteAll"]')?.remove(),this.componentData.menuNode.querySelector('div[sct_id="submenu"][sct_name="customEmote"]').appendChild(this.buildCustomEmoteAllNode()))}addCustomEmote(t){let e=t.target.previousElementSibling.value;return this.componentData.emoteReg.test(e)?this.indexDBData.customEmoteList.some((t=>t==e))?a.alert("这个表情包已有"):(this.indexDBData.customEmoteList.push(e),document.querySelector('div[sct_cpt="chatHelper"][sct_name="customEmoteAll"]')?.remove(),this.componentData.menuNode.querySelector('div[sct_id="submenu"][sct_name="customEmote"]').appendChild(this.buildCustomEmoteAllNode()),a.indexDB_updateIndexDBData(),t.target.previousElementSibling.value="",void t.target.parentElement.classList.toggle("showBig")):a.alert("输入的网址不符合https,或者不符合网络图片后缀名结尾,请修改.")}addQuickMsg(t){if("BUTTON"!=t.target.tagName)return;let e=Object.values(t.target.parentElement.querySelectorAll("input")).map((t=>t.value));return e.some((t=>""==t))?a.alert("不能为空"):this.indexDBData.quickMsgList.some((t=>t.alias==e[0]))?a.alert("别名被占用"):(this.indexDBData.quickMsgList.push({alias:e[0],msg:e[1]}),a.indexDB_updateIndexDBData(),this.freshQuickMsgBuild(),void t.target.parentElement.querySelectorAll("input").forEach((t=>t.value="")))}quickMsgClick(t){if("BUTTON"!==t.target.tagName)return;let e=t.target.getAttribute("sct_index");null==e?(e=a.getParentByIndex(t.target,2).querySelector("button[sct_index]").getAttribute("sct_index"),this.indexDBData.quickMsgList.splice(e,1),this.freshQuickMsgBuild(),a.indexDB_updateIndexDBData()):(this.textareaAdd(this.indexDBData.quickMsgList[e].msg.replace("\\n","\n")),this.closeContainer())}textareaAdd(t){if(!this.componentData.lastTextarea)return;this.componentData.lastTextarea.click();let e=this.componentData.lastTextarea.value;a.setInput(this.componentData.lastTextarea,`${e}${t}`)}closeContainer(){this.componentData.isShow=!1,this.componentData.menuNode.style.display="none"}freshQuickMsgBuild(){let t=this.componentData.menuNode.querySelector('div[sct_id="submenu"][sct_name="quickMsg"]');t.querySelector('[sct_name="quickMsgBase"]').remove(),t.appendChild(this.buildQuickMsgAllNode())}}},114:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class chatroom_mp_display extends n{constructor(){super(),this.name="聊天室自动询价",this.describe="在聊天室中,点击带有物资图标的信息文本处可以自动在交易所查价格",this.enable=!0,this.canDisable=!0,this.tagList=["询价","聊天"]}indexDBData={display_ms:0,display_auto_ms:2e3,focus_q:0,focus_offset:0};componentData={containerNode:void 0,tableNode:void 0,fadeTimer:void 0};commonFuncList=[{match:t=>null!=t&&/messages\/(.+)/.test(location.href)&&0==t.target.parentElement.querySelectorAll("div").length,func:this.mainFunc}];settingUI=()=>{let t=document.createElement("div"),e="<div class=\"col-sm-12 setting-container\" id=setting-container-3><div><div class='header'>聊天室自动询价设置</div><div class=container><div><div><button class=\"script_opt_submit btn\">保存</button></div></div><table><tr style=height:60px><td>功能<td>设置<tr><td title=无论物品数量都只显示指定时长单位毫秒如果设定为0秒就会使用自适应显示时间>强制显示时间<td><input class='form-control' type=number value=display_ms><tr><td title=\"根据物品数量自动设置显示时间 单位毫秒 实际显示时间为：所有物品加载完毕后 数量*这个设置的时间\">自适应显示时间<td><input class='form-control' type=number value=display_auto_ms><tr><td title=在自动询价时会强制显示这个品质的价格>关注的品质<td><input class='form-control' type=number value=focus_q><tr><td title=\"mp-目标折扣% 将此项目设定为0将不强制计算折扣\">目标折扣<td><input class='form-control' type=number value=focus_offset></table></div></div></div>";return e=e.replace("display_ms",this.indexDBData.display_ms.toString()),e=e.replace("display_auto_ms",this.indexDBData.display_auto_ms.toString()),e=e.replace("focus_q",this.indexDBData.focus_q.toString()),e=e.replace("focus_offset",this.indexDBData.focus_offset.toString()),t.innerHTML=e,t.querySelector("button.script_opt_submit").addEventListener("click",(()=>this.settingSubmitHandle())),t};async settingSubmitHandle(){let t=[];document.querySelectorAll("#setting-container-3 input").forEach((e=>t.push(e.value))),4==t.length&&t.every((t=>t>=0))&&t[2]<=12&&t[3]<=100?(this.indexDBData.display_ms=Math.floor(t[0]),this.indexDBData.display_auto_ms=Math.floor(t[1]),this.indexDBData.focus_q=Math.floor(t[2]),this.indexDBData.focus_offset=Math.floor(t[3]),await a.indexDB_updateIndexDBData(),a.alert("已提交保存。")):a.alert("数据内容不合规，请检查所有内容不应当小于0。品质在0-12中，折扣在0-100中。")}async mainFunc(t){a.log(t),this.componentData.containerNode||(this.componentData.containerNode=document.createElement("div"),this.componentData.tableNode=document.createElement("table"),Object.assign(this.componentData.containerNode.style,{position:"absolute",top:"20px",left:"400px",minWidth:"180px",minHeight:"80px",backgroundColor:"rgb(0,0,0,0.8)",borderRadius:"5px",zIndex:"1031",display:"none",color:c.fontColor}),Object.assign(this.componentData.tableNode.style,{width:"100%",height:"100%",textAlign:"center"}),this.componentData.tableNode.innerHTML="<tbody></tbody>",this.componentData.containerNode.appendChild(this.componentData.tableNode),document.body.appendChild(this.componentData.containerNode),this.componentData.containerNode.addEventListener("click",(()=>{Object.assign(this.componentData.containerNode.style,{display:"none"})}))),this.componentData.fadeTimer&&clearTimeout(this.componentData.fadeTimer);let e=this.getChatItemList(t.target.parentElement);if(e=e.filter((t=>98==t||t<90||t>99)),0==e.length)return;let i=this.extractQualityList(t.target.parentElement.innerText);i.includes(0)||i.unshift(0),0!==this.indexDBData.focus_offset&&i.unshift("sp"),Object.assign(this.componentData.containerNode.style,{display:"block",height:28*(e.length+1)+"px",width:70*(i.length+1)+"px",top:`${t.clientY+20}px`,left:(t.clientX+10-80*(i.length+1)<=0?0:t.clientX+10-80*(i.length+1))+"px"}),this.formatHTML(this.componentData.tableNode,e,i);for(let t=0;t<e.length;t++){await a.getMarketPrice(e[t],0,s.basisCPT.realm);let n=this.componentData.tableNode;for(let a=0;a<i.length;a++){let o,c=r.basisCPT.resourcePool[s.basisCPT.realm][e[t]],l=i[a],d=this.indexDBData.focus_q,u=this.indexDBData.focus_offset;o="sp"===l?isNaN(c[d])?"无":(c[d]*(100-u)/100).toFixed(3):c[l]==1/0?"无":c[l],n.innerHTML=n.innerHTML.replace("请求中...",o==1/0?"无":o)}}0==this.indexDBData.display_auto_ms&&0==this.indexDBData.display_ms||(this.componentData.fadeTimer=setTimeout((()=>{Object.assign(this.componentData.containerNode.style,{display:"none"})}),this.indexDBData.display_ms||e.length*this.indexDBData.display_auto_ms),a.log(t.target,e))}getChatItemList(t){let e=[],i=Object.values(t.querySelectorAll("span > span[attr-to]"));for(let t=0;t<i.length;t++){let n=i[t].getAttribute("attr-to");if(!/resource\/\d+/.test(n))continue;let a=Math.floor(n.match(/resource\/(\d+)\//)[1]);e.includes(a)||e.push(a)}return e}extractQualityList(t){return Array.from(t.matchAll(/(?:q|Q)(\d+)/g),(t=>parseInt(t[1]))).filter(((t,e,i)=>t>=0&&t<=12&&i.indexOf(t)===e)).sort(((t,e)=>t-e))}formatHTML(t,e,i){let n=document.createDocumentFragment(),o=document.createElement("tbody");o.classList.add("script_tbody");let s=document.createElement("tr"),r=document.createElement("td");r.classList.add("script_tbody_tr_1"),r.textContent="品名",s.appendChild(r);for(let t=0;t<i.length;t++){let e=i[t],n="sp"===e?`q${this.indexDBData.focus_q} -${this.indexDBData.focus_offset}%`:`q${e}`,a=document.createElement("td");a.textContent=n,s.appendChild(a)}o.appendChild(s);for(let t=0;t<e.length;t++){let n=a.itemIndex2Name(e[t]),s=document.createElement("tr"),r=document.createElement("td");r.classList.add("script_tbody_tr_1"),r.textContent=n,s.appendChild(r);for(let t=0;t<i.length;t++){let t=document.createElement("td");t.textContent="请求中...",s.appendChild(t)}o.appendChild(s)}n.appendChild(o),t.innerHTML="",t.appendChild(n)}}},900:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class clickHarvest extends n{constructor(){super(),this.name="一键收菜",this.describe="组件包括了一键收菜的功能，在地图主页面点击收取按钮可以完成一键收菜",this.enable=!0,this.tagList=["快捷"]}commonFuncList=[{match:t=>Boolean(location.href.match(/landscape\/$/)),func:this.createBtn},{match:t=>!Boolean(location.href.match(/landscape\/$/)),func:this.hideBtn}];indexDBData={buttonText:"一键收菜",nodePosition:0};componentData={btnNode:void 0};cssText=["#Script_oneClickHarvest_Btn {color:var(--fontColor); margin:0 5px; background-color:rgb(51,51,51); width:auto;} button#Script_oneClickHarvest_Btn.fixedDisplay {position:fixed;  left:50%; bottom:80px; transform:translateX(-50%); min-height:40px; min-width:65px; box-shadow: 0 0 20px 1px white; z-index:1040; opacity:0.4;}"];settingUI=this.uisetting;createBtn(t){let e=document.querySelector("#Script_oneClickHarvest_Btn");if(e)e.style.display="block";else{if(null==this.componentData.btnNode){let t=document.createElement("button");t.innerText=this.indexDBData.buttonText,t.id="Script_oneClickHarvest_Btn",t.className="btn",this.componentData.btnNode=t,this.componentData.btnNode.addEventListener("click",this.btnClickHandle)}if(0==this.indexDBData.nodePosition)document.querySelector(".navbar-container").appendChild(this.componentData.btnNode);else if(1==this.indexDBData.nodePosition){let t=document.querySelector(".navbar-container");t.insertBefore(this.componentData.btnNode,t.children[1])}else 2==this.indexDBData.nodePosition&&(this.componentData.btnNode.className="btn fixedDisplay",document.body.appendChild(this.componentData.btnNode))}}btnClickHandle(){if(!Boolean(location.href.match(/landscape\/$/)))return document.querySelector("#Script_oneClickHarvest_Btn").remove();document.querySelectorAll("div > div > div > a").forEach((t=>{t.className.match("headquarter")||3!=t.querySelectorAll("a > img").length||t.click()})),a.msg_send("一键收取","完成收取啦!",1)}clearBtn(){let t=document.querySelector("#Script_oneClickHarvest_Btn");t&&(t.remove(),this.componentData.btnNode=void 0)}hideBtn(){let t=document.querySelector("#Script_oneClickHarvest_Btn");t&&Object.assign(t.style,{display:"none"})}uisetting(){let t=document.createElement("div"),e="<div class=\"col-sm-12 setting-container\" id=\"script_setting_clickHarvest\"><div><div class='header'>一键收菜设置</div><div class='container'><div><div><button class=\"btn script_opt_submit\">保存</button></div></div><table><tr style=height:60px><td>功能<td>设置<tr><td title=在这里设置按钮的文本内容>按钮内容文本<td><input class='form-control' style='text-align:center;' value=####><tr><td title=\"0.右上角 - 在头像右边  \n1.左上角 - 在领域服务器标左边  \n2.悬浮 - 在地图正下方，底栏上方\">按钮位置<td><select class='form-control' value=####><option value=0>右上角<option value=1>左上角<option value=2>悬浮</select></table></div></div></div>";return e=e.replace("####",this.indexDBData.buttonText),e=e.replace("####",this.indexDBData.nodePosition.toString()),t.innerHTML=e,t.querySelector("select").value=this.indexDBData.nodePosition,t.querySelector("button.script_opt_submit").addEventListener("click",(()=>this.settingSubmitHandle())),t}settingSubmitHandle(){let t=[document.querySelector("#script_setting_clickHarvest input").value.toString(),parseInt(document.querySelector("#script_setting_clickHarvest select").value)];a.log("一键收菜设置设置更新",t),this.indexDBData.buttonText=""==t[0]?"一键收取":t[0],this.indexDBData.nodePosition=t[1],a.indexDB_updateIndexDBData(),this.clearBtn(),a.alert("已提交更新")}}},630:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class closeAllNotification extends n{constructor(){super(),this.name="关闭消息弹窗",this.describe="关闭所有消息弹窗,让网页再也没有消息提醒(来自官方的)",this.enable=!1,this.tagList=["样式"]}cssText=["div.container>div.chat-notifications{display:none !important;}"]}},854:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class customBackgroundImage extends n{constructor(){super(),this.name="自定义背景图片",this.describe="在设置界面输入背景图片网址或者在代码中编辑\n请自己注意图片的可访问性",this.enable=!0,this.tagList=["个性化"]}debounceFuncList=[{bounce:1,func:this.mainFunc}];startupFuncList=[this.mainFunc];indexDBData={cssText:""};settingUI=()=>{let t=document.createElement("div");return t.innerHTML='<div><div class="header">自定义背景图片设置</div><div class=container><div><div><button class="btn script_opt_submit">保存</button></div></div><table><tr style=height:60px><td>功能<td>设置<tr style=height:120px><td title=请注意被访问地址的开放性>背景CSS内容<td><textarea style=background-color:rgb(34,34,34);min-width:60px;min-height:120px;max-height:125px;text-align:center;max-width:257px;height:154px;width:313px></textarea></table></div></div>',t.id="setting-container-4",t.className="col-sm-12 setting-container",t.querySelector("textarea").value=this.indexDBData.cssText,t.querySelector("button.script_opt_submit").addEventListener("click",(()=>this.settingSubmitHandle())),t};settingSubmitHandle(){let t=document.querySelector("div#setting-container-4 textarea").value,e=a.hexArgbCheck(t);if(""==t||e)this.indexDBData.cssText=t;else{if(!/^https:\/\/[\w.-]+\.[a-zA-Z]{2,}/.test(t))return a.alert("内容不正确，允许以下类型的内容：\n  #121212\n  rgb(1,1,35)\n  https://image.url");this.indexDBData.cssText=`url(${t})`}a.indexDB_updateIndexDBData(),this.mainFunc(),a.alert("更改已提交")}mainFunc(){let t=document.querySelector("div#root div#page > div");t&&Object.assign(t.style,{background:this.indexDBData.cssText,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"})}}},561:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class customExecutivesIcon extends n{constructor(){super(),this.name="自定义高管头像",this.describe="在公司高管页面/被挖角页面/公司主页面/百科页面/科研页面将指定公司高管的头像替换.",this.enable=!0,this.tagList=["个性化","高管"]}indexDBData={executivesIconList:[{name:"testA",icon:"https://null.de"}],useDefault:!1};componentData={defaultIcon:void 0};commonFuncList=[{match:()=>!0,func:this.mainCheck}];startupFuncList=[this.initDefaultIcon];frontUI=()=>this.mainCheck();settingUI=()=>{let t=document.createElement("div"),e='<div class="header">自定义高管头像设置界面</div><div class="container"><div><div><button class="btn script_opt_submit">保存</button></div></div><div><table><thead><tr><td>功能</td><td>设置</td></tr></thead><tbody><tr><td title="在检测到没有自定义的高管时,是否使用默认遮蔽头像.">使用默认遮蔽</td><td><input class="form-control" type="checkbox" #####></td></tr></tbody></table><table><thead><tr><td>高管名</td><td>头像地址</td><td>删除</td></tr></thead><tbody>';for(let t=0;t<this.indexDBData.executivesIconList.length;t++){let i=this.indexDBData.executivesIconList[t];e+=`<tr><td><input class="form-control" value="${i.name}"></td><td><input class="form-control" value="${i.icon}"></td><td><button class="btn script_customExecutivesIcon_delete">删除</button></td></tr>`}return e+='</tbody></table><button class="btn" style="width: 100%;" id="script_customExecutivesIcon_add">添加</button></div></div>',e=e.replace("#####",this.indexDBData.useDefault?"checked":""),t.innerHTML=e,t.id="script_customExecutivesIcon_setting",t.addEventListener("click",(t=>this.settingClickHandle(t))),t};settingClickHandle(t){return t.target.className.match("script_opt_submit")?this.settingSubmit():"script_customExecutivesIcon_add"==t.target.id?this.addItem(t):t.target.className.match("script_customExecutivesIcon_delete")?this.deleteOne(t):void 0}settingSubmit(){let t=Object.values(document.querySelectorAll("#script_customExecutivesIcon_setting input")).map((t=>"checkbox"==t.type?t.checked:t.value)),e=t[0];t=t.slice(1);for(let e=0;e<t.length;e+=2){if(""==t[e])return a.alert("高管名称不能使用空内容");if(""==t[e+1])return a.alert("遮罩url不能使用空内容");if(!/^https:\/\/[^\s/$.?#].[^\s]*$/.test(t[e+1]))return a.alert("遮罩url必须是https协议的合法url")}this.indexDBData.useDefault=e;let i=[];for(let e=0;e<t.length;e+=2)i.push({name:t[e],icon:t[e+1]});this.indexDBData.executivesIconList=i,a.indexDB_updateIndexDBData(),a.alert("已提交更改")}addItem(t){let e=document.createElement("tr");e.innerHTML='<td><input class="form-control" value=""></td><td><input class="form-control" value=""></td><td><button class="btn script_customExecutivesIcon_delete">删除</button></td>',t.target.previousElementSibling.querySelector("tbody").appendChild(e)}deleteOne(t){a.getParentByIndex(t.target,2).remove()}initDefaultIcon(){let t=document.createElement("div");t.className="script_executivesIcon_Dmask",t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="currentColor" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M24 20a7 7 0 1 0 0-14a7 7 0 0 0 0 14ZM6 40.8V42h36v-1.2c0-4.48 0-6.72-.872-8.432a8 8 0 0 0-3.496-3.496C35.92 28 33.68 28 29.2 28H18.8c-4.48 0-6.72 0-8.432.872a8 8 0 0 0-3.496 3.496C6 34.08 6 36.32 6 40.8Z"/></svg>',Object.assign(t.style,{position:"absolute",inset:"0px"}),this.componentData.defaultIcon=t}async mainCheck(){let t=Object.values(document.querySelectorAll("div>img[src][alt][class]")).filter((t=>/faces\/model-.+\.png$/.test(t.src))).map((t=>t.parentElement)).filter((t=>null==t.querySelector(".script_executivesIcon_Dmask, .script_executivesIcon_Cmask")));t=a.arrayUnique(t);for(let e=0;e<t.length;e++){let i=t[e],n=this.getStaffName(i),a=this.getIcon(n);a&&(i.querySelectorAll("img[src][alt][class]").forEach((t=>t.style.display="none")),i.prepend(a))}}getStaffName(t,e=5){return/[A-Z][a-z]+\s[A-Z][a-z]+(\s[A-Z][a-z]+)?/.test(t.innerText)?t.innerText.match(/[A-Z][a-z]+\s[A-Z][a-z]+(\s[A-Z][a-z]+)?/)[0]:0!=e?this.getStaffName(t.parentElement,--e):"NoName"}getIcon(t){let e=this.indexDBData.executivesIconList.find((e=>e.name==t));if(!e&&this.indexDBData.useDefault)return this.componentData.defaultIcon.cloneNode(!0);if(e||this.indexDBData.useDefault){if(e){let t=document.createElement("div");return t.className="script_executivesIcon_Cmask",t.innerHTML=`<img style="width:100%;" src="${e.icon}" />`,Object.assign(t.style,{position:"absolute",inset:"0px"}),t}return!1}return!1}}},59:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class customQuantityButton extends n{constructor(){super(),this.name="自定义生产数量按钮",this.describe="只想生产24小时？没有问题！只想生产12小时？也没问题！\n只要你想 都能自定义填入！",this.enable=!1,this.tagList=["快捷"]}commonFuncList=[{match:()=>Boolean(location.href.match(/\/b\/\d+\/$/)),func:this.mainFunc}];indexDBData={buttonText:"12hr",otherTextList:[]};componentData={lastURL:"",onload:!1,buttonNode:void 0};cssText=["button[sct_cpt='customQuantityButton'][sct_id='script_custom_button']{margin-right:3px;margin-bottom:3px;text-transform:none !important;}"];settingUI=()=>{let t=document.createElement("div"),e='<div class="header">自定义生产数量按钮</div><div class="container"><div><div><button class="btn script_opt_submit">保存</button></div></div><table><thead><tr><td>功能</td><td colspan="2">设置</td></tr></thead><tbody><tr><td title="按钮的内容会直接填写在格子中">按钮文本</td><td colspan="2"><input class="form-control" value="######"></td></tr>';e=e.replace("######",this.indexDBData.buttonText);for(let t=0;t<this.indexDBData.otherTextList.length;t++){e+=`<tr><td><span>额外按钮</span></td><td><input class="form-control" value="${this.indexDBData.otherTextList[t]}"></td><td><button class="btn form-control" sct_cpt="customQuantityButton" sct_id="deleteOne">删除</button></td></tr>`}return e+='<tr><td colspan=3><button class="btn form-control"sct_cpt=customQuantityButton sct_id=addNewText>添加</button></tbody></table></div>',t.innerHTML=e,t.id="setting-container-8",t.className="col-sm-12 setting-container",t.addEventListener("click",(t=>this.settingClickHandle(t))),t};settingClickHandle(t){return"btn script_opt_submit"==t.target.className?this.settingSubmitHandle():"deleteOne"==t.target.getAttribute("sct_id")?this.settingDeleteOne(t):"addNewText"==t.target.getAttribute("sct_id")?this.settingAddNewText(t):void 0}settingSubmitHandle(){let t=[];if(document.querySelectorAll("#setting-container-8 input").forEach((e=>t.push(e.value))),""==t[0]&&(t[0]="12hr"),t.some((t=>!Boolean(t))))return a.alert("不能为空");this.indexDBData.buttonText=t[0],t.splice(0,1),this.indexDBData.otherTextList=t,a.indexDB_updateIndexDBData(),document.querySelectorAll("button[sct_cpt='customQuantityButton'][sct_id='script_custom_button']").forEach((t=>t.remove())),this.mainFunc(),a.alert("已提交更改。")}settingDeleteOne(t){a.getParentByIndex(t.target,2).remove()}settingAddNewText(t){let e=a.getParentByIndex(t.target,3),i=a.getParentByIndex(t.target,2),n=document.createElement("tr");n.innerHTML='<td><span>额外按钮</span></td><td><input class="form-control"></td><td><button class="btn form-control" sct_cpt="customQuantityButton" sct_id="deleteOne">删除</button></td>',e.insertBefore(n,i)}mainFunc(t,e){try{let t=this.componentData.lastURL==location.href,i=0!=document.querySelectorAll("button[sct_cpt='customQuantityButton'][sct_id='script_custom_button']").length,n=this.componentData.onload;if(t&&i&&!("force"==e)||n)return;this.componentData.onload=!0,this.componentData.buttonNode||this.genButtonNode(),document.querySelectorAll("h3 > svg").forEach((t=>this.addButtonNode(t))),this.componentData.onload=!1,this.componentData.lastURL=location.href}catch{this.componentData.onload=!1,this.componentData.lastURL="",document.querySelectorAll("button[sct_cpt='customQuantityButton'][sct_id='script_custom_button']").forEach((t=>t.remove()))}}genButtonNode(){let t=document.createElement("button");t.className="script_custom_button",Object.assign(t,{type:"button",role:"button"}),t.setAttribute("sct_cpt","customQuantityButton"),t.setAttribute("sct_id","script_custom_button"),this.componentData.buttonNode=t,document.body.addEventListener("click",(t=>this.customBtnClick(t)))}addButtonNode(t){let e=t.parentElement.parentElement.querySelector("div > button").parentElement,i=this.componentData.buttonNode.cloneNode(!0),n=e.querySelector("button").className;if(i.className+=` ${n}`,i.innerText=this.indexDBData.buttonText,e.prepend(i),0!=this.indexDBData.otherTextList.length)for(let t=0;t<this.indexDBData.otherTextList.length;t++)i=this.componentData.buttonNode.cloneNode(!0),i.className+=` ${n}`,i.innerText=this.indexDBData.otherTextList[t],e.prepend(i)}customBtnClick(t){if("BUTTON"!==t.target.tagName)return;if("customQuantityButton"!==t.target.getAttribute("sct_cpt"))return;if("script_custom_button"!==t.target.getAttribute("sct_id"))return;let e=t.target.parentElement.parentElement.querySelector("input"),i=t.target.innerText;/^\d+d\s*\d+(:|：)\d+\s*(am|pm)*/i.test(i)?i=this.customTimeSetOverDayText(i):/^\d+(:|：)\d+\s*(am|pm)*/i.test(i)?i=this.customTimeSetText(i):/^\d+\.\d+hr$/i.test(i)&&(i=this.customTimeDurationText(i)),a.log(i),e.click(),a.setInput(e,i),t.preventDefault()}customTimeSetText(t){try{let e=t;if(/am|pm/i.test(t)){let i=a.convert12To24Hr(t);if(!i)return t;e=i}let i=new Date,[n,o]=e.split(":").map(Number),s=60*n+o-(60*i.getHours()+i.getMinutes());return s<0&&(s+=1440),`${s}m`}catch{return t}}customTimeDurationText(t){try{return 60*Number(t.replace(/hr/i,""))+"m"}catch{return t}}customTimeSetOverDayText(t){try{let e=Math.floor(t.match(/^(\d+d\s*)/i)[0].replace(/\s*/g,"").replace(/d|D/,"")),i=t.replace(/^\d+(d|D)\s*/g,""),n=this.customTimeSetText(i);return n==i?t:`${24*e*60+Number(n.replace("m",""))}m`}catch{return t}}}},342:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class easyText extends n{constructor(){super(),this.name="随手笔记",this.describe="前台随手笔记功能",this.enable=!0,this.tagList=["实用"]}componentData={rootNode:void 0,isDragging:!1,offset:{x:0,y:0},tapCount:0,oldStyleNode:void 0};indexDBData={textContent:"",backgroundCSS:"rgb(0,0,0,0.5)",styleMode:0,positionTop:"10px",positionLeft:"10px",isShow:!1,isHide:!1,nodeWidth:0,nodeHeight:0};startupFuncList=[this.buildContianer];cssText=["#script_easyText_root{z-index:1040;display:none;color:var(--fontColor);position:fixed;top:20px;left:20px;width:30%;height:30%;border:1px solid #ccc;padding:10px;box-sizing:border-box;cursor:move;background-position:center;background-repeat:no-repeat;background-size:cover;box-shadow:0 0 5px 1px black;border-radius:5px;}#script_easyText_root #script_easyText_title{text-align:center;font-weight:bold;margin-bottom:10px;}#script_easyText_root #script_eastText_close{position:absolute;top:10px;right:10px;cursor:pointer;}#script_easyText_root textarea{width:100%;height:calc(100% - 30px);background-color:transparent;border:none;resize:none;}#script_easyText_root #script_eastText_hide{position:absolute;top:10px;right:42px;cursor:pointer;}button#script_easeyText_button{color:var(--fontColor);text-align:center;display:block;position:fixed;left:10px;bottom:10px;width:fit-content;height:fit-content;z-index:2001;border-radius:5px;border:1px solid white;}div#script_easeyText_rootOld{background-repeat:no-repeat;background-position:center;background-size:cover;position:fixed;display:none;width:100%;height:100%;bottom:0;left:0;z-index:1031;padding:10px;}textarea#script_easyText_textArea{color:var(--fontColor);resize:none;height:100%;width:100%;background:rgba(0,0,0,0);border-radius:5px;box-shadow:0 0 7px 1px rgb(255,255,255,0.8);}","#script_easyText_root{z-index:1040;display:none;color:var(--fontColor);position:fixed;top:20px;left:20px;width:70%;height:60%;border:1px solid #ccc;padding:10px;box-sizing:border-box;cursor:move;background-position:center;background-repeat:no-repeat;background-size:cover;box-shadow:0 0 5px 1px black;border-radius:5px;}#script_easyText_root #script_easyText_title{text-align:center;font-weight:bold;margin-bottom:10px;}#script_easyText_root #script_eastText_close{position:absolute;top:10px;right:10px;cursor:pointer;}#script_easyText_root textarea{width:100%;height:calc(100% - 30px);background-color:transparent;border:none;resize:none;}#script_easyText_root #script_eastText_hide{position:absolute;top:10px;left:10px;cursor:pointer;}button#script_easeyText_button{color:var(--fontColor);text-align:center;display:block;position:fixed;left:10px;bottom:10px;width:fit-content;height:fit-content;z-index:2001;border-radius:5px;border:1px solid white;}div#script_easeyText_rootOld{position:fixed;display:none;width:100%;height:40%;bottom:0;left:0;z-index:1031;padding:10px;}textarea#script_easyText_textArea{color:var(--fontColor);resize:none;height:100%;width:100%;background:rgba(0,0,0,0);border-radius:5px;box-shadow:0 0 7px 1px rgb(255,255,255,0.8);}"];frontUI=()=>{Object.assign(this.componentData.rootNode.style,{display:"block"})};settingUI=()=>{let t=document.createElement("div"),e='<div class=header>随手笔记设置</div><div class=container><div><button class="btn script_opt_submit">保存</button></div><table><tr style=height:60px><td>功能<td>设置<tr><td title=请注意被访问地址的开放性>背景CSS内容<td><textarea style=background-color:#222;text-align:center;height:60px;width:100%;resize:none></textarea><tr><td title=旧版本只能修改背景样式,不能修改其它参数.\n新版本可以修改其他参数>随手记样式<td><select class=form-control id=script_easyText_mode><option value=0>新版本<option value=1>旧版本</select><tr><td title=请自行注意宽高与显示器窗口大小的限制>宽度<td><input class=form-control type=number value=#####><tr><td title=请自行注意宽高与显示器窗口大小的限制>高度<td><input class=form-control type=number value=#####></table></div>';return t.id="easyTextSetting",t.className="col-sm-12 setting-container",e=e.replace("#####",this.indexDBData.nodeWidth||0),e=e.replace("#####",this.indexDBData.nodeHeight||0),t.innerHTML=e,t.querySelector("textarea").value=this.indexDBData.backgroundCSS,t.querySelector("select#script_easyText_mode").value=this.indexDBData.styleMode,t.querySelector("button.script_opt_submit").addEventListener("click",(()=>this.settingSubmit())),t};async settingSubmit(){let t=[];document.querySelectorAll("div#easyTextSetting textarea, div#easyTextSetting input, div#easyTextSetting select").forEach((e=>t.push(e.value)));let e=a.hexArgbCheck(t[0]),i=!1;if(""==t[0])this.indexDBData.backgroundCSS="rgb(0,0,0,0.5)";else if(e)this.indexDBData.backgroundCSS=t[0];else{if(!/^https:\/\/[\w.-]+\.[a-zA-Z]{2,}/.test(t[0]))return a.alert("内容不正确，允许以下类型的内容：\n  #121212\n  rgb(1,1,35)\n  https://image.url");this.indexDBData.backgroundCSS=`url(${t[0]})`}if(t[2]<0||t[3]<0)return a.alert("宽高不能这么设置");this.indexDBData.styleMode!=Math.floor(t[1])&&(i=!0),this.indexDBData.styleMode=Math.floor(t[1]),this.indexDBData.nodeWidth=t[2],this.indexDBData.nodeHeight=t[3],await a.indexDB_updateIndexDBData(),this.componentData.rootNode.style.background=this.indexDBData.backgroundCSS,a.alert("更改已提交"),i&&location.reload()}buildContianer(t){return 0==this.indexDBData.styleMode?this.buildNewContainer():1==this.indexDBData.styleMode?this.buildOldContainer():void 0}buildOldContainer(){let t=document.createElement("button"),e=document.createElement("div"),i=document.createElement("textarea");Object.assign(t.style,{backgroundColor:this.indexDBData.backgroundCSS}),t.id="script_easeyText_button",e.id="script_easeyText_rootOld",i.id="script_easyText_textArea",t.innerText="eTEXT",e.appendChild(i),document.body.appendChild(t),document.body.appendChild(e),t.addEventListener("click",(()=>this.oldSwicthBtn())),i.addEventListener("change",(t=>this.oldEditorChange(t))),this.componentData.rootNode=e,this.indexDBData.isShow=!this.indexDBData.isShow,this.oldSwicthBtn()}oldSwicthBtn(){Object.assign(this.componentData.rootNode.style,{display:this.indexDBData.isShow?"none":"block",background:this.indexDBData.backgroundCSS}),this.componentData.rootNode.querySelector("#script_easyText_textArea").value=this.indexDBData.textContent,this.indexDBData.isShow=!this.indexDBData.isShow,a.indexDB_updateIndexDBData()}oldEditorChange(t){this.indexDBData.textContent=t.target.value,a.indexDB_updateIndexDBData()}buildNewContainer(){let t=document.createElement("div");t.id="script_easyText_root",t.innerHTML='<div id="script_easyText_title">随手笔记</div>\n      <div id="script_eastText_hide">缩小</div>\n      <div id="script_eastText_close">关闭</div>\n      <textarea id="script_easyText_editor"></textarea>',t.addEventListener("mousedown",(t=>this.startDragging(t))),t.addEventListener("touchstart",(t=>this.startDragging(t))),t.querySelector("div#script_eastText_close").addEventListener("click",(()=>this.closeRootDisplay())),t.querySelector("div#script_eastText_hide").addEventListener("click",(()=>this.switchHide())),t.querySelector("textarea#script_easyText_editor").addEventListener("input",(t=>this.contentInput(t))),t.querySelector("textarea#script_easyText_editor").addEventListener("change",(t=>this.contentChange(t))),Object.assign(t.style,{background:this.indexDBData.backgroundCSS,top:this.indexDBData.positionTop,left:this.indexDBData.positionLeft,display:this.indexDBData.isShow?"block":"none"}),t.querySelector("textarea#script_easyText_editor").value=this.indexDBData.textContent,t.style.height=0==this.indexDBData.nodeHeight?"":`${this.indexDBData.nodeHeight}px`,t.style.width=0==this.indexDBData.nodeWidth?"":`${this.indexDBData.nodeWidth}px`,this.componentData.rootNode=t,document.body.appendChild(t),this.indexDBData.isHide=!this.indexDBData.isHide,this.switchHide()}startDragging(t){let e=this.componentData.rootNode,i=parseInt(c.zoomRate)/100;if("TEXTAREA"==t.target.tagName)return t.stopPropagation();if(void 0===t.button||0===t.button){t.stopPropagation(),this.componentData.isDragging=!0;let n=e.getBoundingClientRect();"mousedown"===t.type?(this.componentData.offset.x=t.clientX/i-n.left,this.componentData.offset.y=t.clientY/i-n.top,window.addEventListener("mousemove",(t=>this.drag(t))),window.addEventListener("mouseup",(t=>this.stopDragging(t)))):"touchstart"===t.type&&(this.componentData.offset.x=t.touches[0].clientX/i-n.left,this.componentData.offset.y=t.touches[0].clientY/i-n.top,window.addEventListener("touchmove",(t=>this.drag(t))),window.addEventListener("touchend",(t=>this.stopDragging(t))))}}drag(t){let e=this.componentData.rootNode,i=parseInt(c.zoomRate)/100;if(this.componentData.isDragging){t.stopPropagation();e.getBoundingClientRect();let n="mousemove"===t.type?t.clientX:t.touches[0].clientX,a="mousemove"===t.type?t.clientY:t.touches[0].clientY;e.style.left=n/i-this.componentData.offset.x+"px",e.style.top=a/i-this.componentData.offset.y+"px"}}stopDragging(t){t.stopPropagation(),this.componentData.isDragging=!1,window.removeEventListener("mousemove",(t=>this.drag(t))),window.removeEventListener("mouseup",(t=>this.stopDragging(t))),window.removeEventListener("touchmove",(t=>this.drag(t))),window.removeEventListener("touchend",(t=>this.stopDragging(t))),this.contentChange()}closeRootDisplay(){Object.assign(this.componentData.rootNode.style,{display:"none"})}switchHide(){if(this.indexDBData.isHide)this.componentData.rootNode.style.width=0==this.indexDBData.nodeWidth?"":`${this.indexDBData.nodeWidth}px`,this.componentData.rootNode.style.height=0==this.indexDBData.nodeHeight?"":`${this.indexDBData.nodeHeight}px`;else{let t=a.clientHorV?"initial":"300px";Object.assign(this.componentData.rootNode.style,{width:t,height:"40px",overflow:"hidden"})}this.indexDBData.isHide=!this.indexDBData.isHide}contentInput(t){this.indexDBData.textContent=t.target.value,this.componentData.tapCount%20==0&&(this.indexDBData.isShow="block"==this.componentData.rootNode.style.display,this.indexDBData.positionLeft=this.componentData.rootNode.style.left,this.indexDBData.positionTop=this.componentData.rootNode.style.top)}contentChange(t){null==t&&(t={target:{value:document.querySelector("#script_easyText_editor").value}}),this.indexDBData.textContent=t.target.value,this.indexDBData.isShow="block"==this.componentData.rootNode.style.display,this.indexDBData.positionLeft=this.componentData.rootNode.style.left,this.indexDBData.positionTop=this.componentData.rootNode.style.top,a.indexDB_updateIndexDBData()}}},417:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class economicCycleDetect extends n{constructor(){super(),this.name="周期经济状况检测",this.describe="添加前台按钮可以点击之后获取当前最新的经济周期状态,可能会有十几秒的延迟(API的问题);",this.enable=!0,this.tagList=["追踪","经济周期"]}startupFuncList=[this.startDetect,this.init];componentData={timerFlag:void 0,cycleList:["萧条","平缓","景气"]};indexDBData={lastData:[void 0,void 0],autoStart:!1};frontUI=()=>this.checkNewData();settingUI=()=>{let t=document.createElement("div");return t.id="script_economicCycleDetect_setting",t.innerHTML=`<div class=header>周期经济状况检测设置</div><div class=container><div><button class="btn script_opt_submit">保存更改</button></div><table><thead><tr><td>功能<td>设置<tbody><tr><td title=自启动监控在周五晚上二十三点前后会尝试自动获取信息(可能有延迟导致错误,请注意甄别)>自启动监控<td><input class=form-control type=checkbox ${this.indexDBData.autoStart?"checked":""}></table></div>`,t.addEventListener("click",(t=>this.settingClickHandle(t))),t};settingClickHandle(t){if(t.target.className.match("script_opt_submit"))return this.settingSubmit()}settingSubmit(){let t=Object.values(document.querySelectorAll("#script_economicCycleDetect_setting input")).map((t=>"checkbox"==t.type?t.checked:t.value));this.indexDBData.autoStart=t[0],this.startDetect(),a.indexDB_updateIndexDBData(),a.alert("保存并更新")}async init(){let t=await a.getRealm();null==this.indexDBData.lastData[t]&&(this.indexDBData.lastData[t]=r.basisCPT.userInfo[t].temporals.economyState)}startDetect(){this.componentData.timerFlag&&clearInterval(this.componentData.timerFlag),this.indexDBData.autoStart&&(this.componentData.timerFlag=setInterval((()=>this.interCheckFunc()),1e4))}interCheckFunc(){let t=new Date;if(5!=t.getDay())return;let e=new Date(t.getFullYear(),t.getMonth(),t.getDate()+5-t.getDay(),23,0,0,0).getTime()-t.getTime();return e<0&&e>-3e4?this.checkNewData():void 0}async checkNewData(){let t=await a.getNetData(`${a.baseURL.userBase}#${await a.generateUUID()}`);if(!t)return a.msg_send("周期检测","网络请求失败.");let e=t.authCompany.realmId;this.indexDBData.lastData[e]=t.temporals.economyState,r.basisCPT.userInfo[e]=t;let i=`当前服务器:${0==e?"R1":"R2"},经济周期为:${this.componentData.cycleList[this.indexDBData.lastData[e]]}`;a.msg_send("周期检测",i),a.indexDB_updateIndexDBData()}}},146:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c,langData:l}=i(658);new class festivalEffectSwitch extends n{constructor(){super(),this.name="节日效果开关",this.describe="如题",this.enable=!0,this.tagList=["样式"]}indexDBData={christmasSnowsFall:!1,newYearFireWorks:!1};commonFuncList=[{match:()=>this.indexDBData.christmasSnowsFall&&/landscape\/$/.test(location.href),func:this.christmasSnowsFall},{match:()=>this.indexDBData.newYearFireWorks&&/landscape\/$/.test(location.href),func:this.newYearFireWorks}];settingUI=()=>{let t=document.createElement("div"),e='<div class="header">节日效果开关设置</div><div class=container><div><div><button class="btn script_opt_submit">保存</button></div></div><table><thead><tr><td>屏蔽项目<td>屏蔽选项<tbody>';return e+=`<tr><td title="在圣诞节前后 公司的地图界面会有canvas标签绘制地图飘雪">圣诞节 地图飘雪<td><input ${this.indexDBData.christmasSnowsFall?"checked":""} class=form-control type=checkbox>`,e+=`<tr><td title="新年前后 公司地图右下角有烟花按钮">新年 烟花按钮<td><input ${this.indexDBData.newYearFireWorks?"checked":""} class=form-control type=checkbox>`,e+="</table></div>",t.id="scirpt_setting_festivalEffectSwitch",t.innerHTML=e,t.addEventListener("click",(t=>this.settingClickHandle(t))),t};settingClickHandle(t){if(t.target.className.match("script_opt_submit"))return this.settingSubmit()}settingSubmit(){let t=Object.values(document.body.querySelectorAll("div#scirpt_setting_festivalEffectSwitch td>select, div#scirpt_setting_festivalEffectSwitch td>input")).map((t=>"checkbox"==t.type?t.checked:t.value));this.indexDBData.christmasSnowsFall=t[0],this.indexDBData.newYearFireWorks=t[1],a.indexDB_updateIndexDBData(),a.alert("更新并保存")}christmasSnowsFall(){let t=document.querySelector('canvas[data-testid="SnowfallCanvas"]');t&&Object.assign(t.style,{display:"none"})}newYearFireWorks(){a.getParentByIndex(document.querySelector("button>img[alt='Start fireworks']"),1).remove()}}},247:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class globalBlock extends n{constructor(){super(),this.name="全局屏蔽",this.describe="在交易所界面和聊天室界面屏蔽掉指定人的信息",this.enable=!0,this.tagList=["样式","聊天","交易所","过滤"]}commonFuncList=[{match:()=>Boolean(location.href.match(/market\/resource\/\d+\/$/)),func:this.marketBlockFunc}];startupFuncList=[this.genTempList];chatMsgFuncList=[this.chatBlockFunc];indexDBData={blockList:[],maskImgUrl:void 0,blockZone:0,chatBlockType:0};componentData={lastMsgList:[],lastMarketTag:"",lastTimeStamp:0,iconMaskNode:void 0,tempBlockList:[]};cssText=["div#script_globalBlock_main button.script_globalBlock_delete {background-color:rgb(137, 37, 37);}"];settingUI=()=>{let t=document.createElement("div"),e='<div class="header">全局屏蔽设置界面</div><div class="container"><div><div><button class="btn script_opt_submit">保存</button></div></div><div><table><thead><tr><td>功能</td><td>设置</td></tr></thead><tbody><tr><td title="选定在哪些区域启用屏蔽功能">屏蔽范围</td><td><select id="script_blockZone" class="form-control"><option value="0">两者都</option><option value="1">交易所</option><option value="2">聊天室</option></select></td></tr><tr><td title="聊天室遮蔽模式 默认全遮蔽 全遮蔽完全看不到此人发言">聊天室遮蔽模式</td><td><select id="script_chatBlockType" class="form-control"><option value="0">全遮蔽</option><option value="1">仅头像</option></select></td></tr><tr><td>遮罩图片<td><input class="form-control" id=script_imgUrl></tbody></table><table><thead><tr><td>屏蔽的公司名</td><td>删除</td></tr></thead><tbody>';for(let t=0;t<this.indexDBData.blockList.length;t++){e+=`<tr><td><input class="form-control" value='${this.indexDBData.blockList[t]}'></td><td><button class="btn script_globalBlock_delete">删除</button></td></tr>`}return e+='</tbody></table><button class="btn" style="width: 100%;" id="script_globalBlock_add">添加</button></div></div>',t.innerHTML=e,t.id="script_globalBlock_main",t.querySelector("#script_blockZone").value=this.indexDBData.blockZone,t.querySelector("#script_chatBlockType").value=this.indexDBData.chatBlockType,t.querySelector("#script_imgUrl").value=this.indexDBData.maskImgUrl||"",t.addEventListener("click",(t=>this.settingClickHandle(t))),t};settingClickHandle(t){return"script_globalBlock_add"==t.target.id?this.settingAddNode(t):/script_opt_submit/.test(t.target.className)?this.settingSubmit(t):/script_globalBlock_delete/.test(t.target.className)?this.settingDeleteOne(t):void 0}settingSubmit(t){let e=a.getParentByIndex(t.target,3),i=Object.values(e.querySelectorAll("select, input")).map((t=>t.value));if(""!=i[2]&&!/^https:\/\/[^\s/$.?#].[^\s]*$/.test(i[2]))return a.alert("遮罩url必须是https协议的合法url");this.indexDBData.blockZone=Math.floor(i[0]),this.indexDBData.chatBlockType=Math.floor(i[1]),this.indexDBData.maskImgUrl=""==i[2]?void 0:i[2],i=i.slice(3),this.indexDBData.blockList=i,this.genTempList(),a.indexDB_updateIndexDBData(),this.componentData.iconMaskNode=void 0,a.alert("已提交更改.")}settingAddNode(t){let e=t.target.previousElementSibling.querySelector("tbody"),i=document.createElement("tr");i.innerHTML='<td><input class="form-control"></td><td><button class="btn script_globalBlock_delete">删除</button></td>',e.appendChild(i)}settingDeleteOne(t){a.getParentByIndex(t.target,2).remove()}marketBlockFunc(t){if(null!=t&&"keydown"==t.type)return;if(2==this.indexDBData.blockZone)return;let e=Object.values(document.querySelectorAll("tr>td>div>div>span")).map((t=>a.getParentByIndex(t,4))),i=`${e[0].childNodes[2].innerText} - ${e[0].childNodes[3].innerText}`,n=i==this.componentData.lastMarketTag,o=(new Date).getTime();if(o-this.componentData.lastTimeStamp<2e3&&n)return;this.componentData.lastMarketTag=i,this.componentData.lastTimeStamp=o;let s=this.getIconMask().cloneNode(!0);Object.assign(s.style,{width:"30px",height:"30ox"});for(let t=0;t<e.length;t++){let i=e[t],n=i.querySelector("div>div>span").innerText;this.indexDBData.blockList.includes(n)&&(i.querySelector("a>img").style.display="none",i.querySelector("a").prepend(s.cloneNode(!0)),i.querySelector("div>div>span").innerText=" ")}}chatBlockFunc(t){let e=t.childNodes[0].href.match(/\/company\/\d+\/(.+)\/$/)[1].toLowerCase().replace(/ /g,"-");this.componentData.tempBlockList.includes(e)&&(t.querySelector("div#script_globalBlock_mask")||(0==this.indexDBData.chatBlockType?Object.assign(t.style,{display:"none"}):setTimeout((()=>this.chatIconMaskHandle(t)),20)))}genTempList(){this.componentData.tempBlockList=this.indexDBData.blockList.map((t=>t.toLowerCase().replace(/ /g,"-")))}chatIconMaskHandle(t=void 0){if(!t)return;let e=t.querySelector("a>div>img.logo"),i=this.getIconMask().cloneNode(!0);try{i.id="script_globalBlock_mask",Object.assign(i.style,{width:"100%"}),e.style.display="none",a.getParentByIndex(e,1).prepend(i)}catch(t){console.error(t)}}getIconMask(){return this.componentData.iconMaskNode||(this.indexDBData.maskImgUrl?(this.componentData.iconMaskNode=document.createElement("div"),this.componentData.iconMaskNode.innerHTML=`<img style='width:100%' src="${this.indexDBData.maskImgUrl}">`):(this.componentData.iconMaskNode=document.createElement("div"),this.componentData.iconMaskNode.innerHTML='<svg style=\'width:100%\' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\x3c!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/></svg>')),this.componentData.iconMaskNode}}},162:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class mapHideScroll extends n{constructor(){super(),this.name="公司地图界面隐藏滚动条",this.describe="如名",this.enable=!0,this.tagList=["样式"]}commonFuncList=[{match:()=>Boolean(location.href.match(/landscape\/$/)),func:this.mainFunc},{match:()=>!Boolean(location.href.match(/landscape\/$/)),func:this.setBack}];mainFunc(){let t=document.querySelector("div#root div#page");t&&(t.style.overflow="hidden")}setBack(){let t=document.querySelector("div#root div#page");t&&(t.style.overflow="")}}},199:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class marketHighReminder extends n{constructor(){super(),this.name="交易行按钮旁高提醒",this.describe="交易行旁按钮高提醒，提示当前是R1还是R2",this.enable=!0,this.tagList=["样式","交易所"]}commonFuncList=[{match:()=>Boolean(location.href.match(/market\/resource\/(\d+)\//)),func:this.mainFunc}];mainFunc(){let t=document.querySelectorAll(".navbar-container img")[0].src,e=document.querySelector("form input[name='quantity']");Object.assign(e.style,{background:`url('${t}')`,backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"right"})}}},977:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class marketPriceTracker extends n{constructor(){super(),this.name="交易行价格监控提示",this.describe="交易行低价会有提示，不错过交易行的精彩价格。",this.enable=!0,this.tagList=["追踪","交易所"]}indexDBData={max_net_time_gap:12e4,min_net_time_gap:6e4,trackTargetList:[],trackerHandleMode:0};componentData={trackerIntervalList:[],settingTemplateNode:void 0};cssText=["#setting-container-7{overflow-y:auto;}#setting-container-7 button.script_mpTracker_delete{background-color:rgb(137,37,37);}#setting-container-7 button.script_mpTracker_delete:hover{color: var(--fontColor);}#setting-container-7 tr>td:nth-of-type(1){min-width:70px;}#setting-container-7 tr>td:nth-of-type(2){min-width:64px;}#setting-container-7 tr>td:nth-of-type(3){min-width:96px;}#setting-container-7 tr>td:nth-of-type(4){min-width:110px;}","#setting-container-7{overflow-y:auto;}#setting-container-7 button.script_mpTracker_delete{background-color:rgb(137,37,37);}#setting-container-7 button.script_mpTracker_delete:hover{color:var(--fontColor);}#setting-container-7 tr>td:nth-of-type(1){min-width:50px;}#setting-container-7 tr>td:nth-of-type(2){min-width:64px;}#setting-container-7 tr>td:nth-of-type(3){min-width:96px;}#setting-container-7 tr>td:nth-of-type(4){min-width:80px;}"];startupFuncList=[this.mainFunc];settingUI=()=>{let t=document.createElement("div");t.innerHTML='<div class=header>交易所低价提示设置</div><div class=container><div><div><button class="btn script_opt_submit">保存并重启监控</button></div></div><div><table><thead><tr><td>功能<td>设置<tbody><tr><td title="默认值 0;快速判断模式性能更好;\n  快速判断模式仅显示当前符合要求的最低价\n  详细判断模式可以统计出符合要求价格的出售公司和总计销售量">判断模式<td><select class=form-control><option value=0>快速判断模式<option value=1>详细判断模式</select></table><table><thead><tr><td>ID<td>品质<td>服务器<td>价格<td>删除<tbody id=script_itemTargetNode></table></div></div>',t.id="setting-container-7",t.className="col-sm-12 setting-container";let e=t.querySelector("tbody#script_itemTargetNode");this.componentData.settingTemplateNode||(this.componentData.settingTemplateNode=document.createElement("tr"),this.componentData.settingTemplateNode.innerHTML='<td><input class="form-control script_mpTracker_resid"type=number><td><select class="form-control script_mpTracker_quality"><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10<option value=11>11<option value=12>12</select><td><select class="form-control script_mpTracker_realm"><option value=0>R1 M服<option value=1>R2 E服</select><td><input class="form-control script_mpTracker_price"type=number><td><button class="btn script_mpTracker_delete">删除</button>'),t.addEventListener("click",(t=>this.settingRootClickHandle(t))),t.querySelector("td>select").value=this.indexDBData.trackerHandleMode;for(let t=0;t<this.indexDBData.trackTargetList.length;t++){let i=this.indexDBData.trackTargetList[t],n=this.componentData.settingTemplateNode.cloneNode(!0);n.querySelector("input.script_mpTracker_resid").value=i.id,n.querySelector("select.script_mpTracker_quality").value=i.quality,n.querySelector("select.script_mpTracker_realm").value=i.realm,n.querySelector("input.script_mpTracker_price").value=i.target_price,e.appendChild(n)}let i=document.createElement("tr");return i.innerHTML='<td colspan="5"><button class="col-sm-12 form-control" id="script_mpTracker_addT">添加</button></td>',e.appendChild(i),t};settingRootClickHandle(t){if("BUTTON"==t.target.tagName)return t.target.className.match("script_opt_submit")?this.settingSubmitHandle():t.target.className.match("script_mpTracker_delete")?this.settingDeleteButtonHandle(t):"script_mpTracker_addT"==t.target.id?this.settingAddItem(t):void 0}async settingSubmitHandle(){let t=Object.values(document.querySelectorAll("#setting-container-7 tbody>tr>td>input, #setting-container-7 tbody>tr>td>select")).map((t=>t.value)),e=t.splice(0,1),i=[];for(let e=0;e<t.length;e+=4){let n=Math.floor(t[e]),o=Math.floor(t[e+1]),s=Math.floor(t[e+2]),r=parseFloat(t[e+3]);if(n<=0||r<=0)return a.alert("id和价格不能小于等于0");if(null==a.itemIndex2Name(n))return a.alert("有存在无法找到物品名的id,请检查是否有id错误.");i.push({id:n,quality:o,realm:s,target_price:r})}this.indexDBData.trackTargetList=i,this.indexDBData.trackerHandleMode=Math.floor(e[0]),await a.indexDB_updateIndexDBData(),this.mainFunc(void 0,"restart"),a.alert("以保存配置并发起功能重启。")}settingAddItem(t){let e=this.componentData.settingTemplateNode.cloneNode(!0),i=a.getParentByIndex(t.target,3),n=a.getParentByIndex(t.target,2);i.insertBefore(e,n)}settingDeleteButtonHandle(t){a.getParentByIndex(t.target,2).remove()}mainFunc(t,e="start"){if(!this.enable)return;if("clear"==e)return this.componentData.trackerIntervalList.map((t=>clearInterval(t)));if("restart"==e)return this.mainFunc(void 0,"clear"),this.mainFunc(void 0,"start");if("start"!=e)return;let i=[];this.indexDBData.trackTargetList.forEach((t=>{let e=i.findIndex((e=>e.id==t.id&&e.realm==t.realm));if(-1==e){let e=new Array(13);return e[t.quality]=t.target_price,void i.push({id:t.id,realm:t.realm,price:e})}i[e].price[t.quality]=t.target_price})),i.forEach((t=>{let e=Math.random()*(this.indexDBData.max_net_time_gap-this.indexDBData.min_net_time_gap);e+=this.indexDBData.min_net_time_gap,e=Math.floor(e),this.componentData.trackerIntervalList.push(setInterval((()=>this.intervalHandle(t)),e)),c.debug&&a.msg_send("监控物价",`${a.itemIndex2Name(t.id)} 间隔时间${e}ms`)})),a.log("价格追踪已开启"),c.debug&&a.msg_send("交易所低价监控","价格追踪已开启")}modeHandlers=[t=>this.fastModeRequestHandle(t),t=>this.detailModeRequestHandle(t)];intervalHandle=t=>this.modeHandlers[this.indexDBData.trackerHandleMode](t);async fastModeRequestHandle(t){a.log("请求交易所价格",t,a.itemIndex2Name(t.id));let e=await a.getNetData(`${a.baseURL.market}/${t.realm}/${t.id}/#${await a.generateUUID()}`);if(!e)return;let i=a.mpFormat(e);r.basisCPT.resourcePool[t.realm][t.id]=i,a.arrayIsAllZero(i)||t.price.forEach(((e,n)=>{if(!e||i[n]>e)return;let o=`服务器${0==t.realm?"R1":"R2"} ID:${t.id} 物品名:${a.itemIndex2Name(t.id)} `;o+=`Q${n} 目标价格:${e} 当前价格:${i[n].toFixed(3)}`,a.msg_send("交易所低价监控",o)}))}async detailModeRequestHandle(t){a.log("请求交易所价格",t,a.itemIndex2Name(t.id));let e=await a.getNetData(`${a.baseURL.market}/${t.realm}/${t.id}/?${await a.generateUUID()}`);if(!e)return;let i=a.mpFormat(e);if(r.basisCPT.resourcePool[t.realm][t.id]=i,a.arrayIsAllZero(i))return;let n=[],o=t.price.map(((t,e)=>({quality:e,price:t})));for(let t=0;t<e.length;t++){let a=e[t],s=e[t].quality;o.filter((t=>Boolean(s>=t.quality&&a.price<=t.price))).map((t=>{null==n[t.quality]&&(n[t.quality]={price:i[s],amount:0,seller:[]}),n[t.quality].amount+=a.quantity,n[t.quality].seller.push(a.seller.company)}))}for(let e=0;e<n.length;e++){if(null==n[e])continue;let i=0==t.realm?"R1 ":"R2 ";i+=`${a.itemIndex2Name(t.id)} Q${e} `,i+=`目标价: $${a.numberAddCommas(t.price[e])}; 当前价: $${a.numberAddCommas(n[e].price)}; `,i+=`货物量: ${a.numberAddCommas(n[e].amount)}; `;let o=`销售公司: ${n[e].seller.join(", ")}`;a.msg_send("交易行监控",i),a.msg_send("交易行监控",o,1)}}}},919:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class newTabProfile extends n{constructor(){super(),this.name="使用新建标签页打开公司页",this.describe="通过事件委派拦截所有前往a的",this.enable=!1,this.tagList=["实用"]}indexDBData={activeZone_market:!0,activeZone_chat:!0,activeZone_warehouse:!0,activeZone_search:!0};startupFuncList=[this.mainFunc];settingUI=()=>{let t=document.createElement("div"),e='<div class="header">使用新建标签页打开公司页组件设置</div><div class="container"><div><button class="btn script_opt_submit">保存更改</button></div><table><thead><tr><td>应用范围</td><td>开关</td></tr></thead><tbody>';return e+=`<tr><td title="是否在交易所场景中使用新标签页访问别家公司详情">交易所页面</td><td><input class="form-control" type="checkbox" ${this.indexDBData.activeZone_market?"checked":""}></td></tr>`,e+=`<tr><td title="是否在聊天页面中使用新标签页访问别家公司详情">聊天页面</td><td><input class="form-control" type="checkbox" ${this.indexDBData.activeZone_chat?"checked":""}></td></tr>`,e+=`<tr><td title="是否在库存/仓库页面中使用新标签页访问别家公司详情">库存/仓库页面</td><td><input class="form-control" type="checkbox" ${this.indexDBData.activeZone_warehouse?"checked":""}></td></tr>`,e+=`<tr><td title="是否在搜索页面中使用新标签页访问别家公司详情">搜索页面</td><td><input class="form-control" type="checkbox" ${this.indexDBData.activeZone_search?"checked":""}></td></tr>`,e+="</tbody></table></div>",t.id="script_newTabProfile_setting",t.innerHTML=e,t.querySelector("button.script_opt_submit").addEventListener("click",(()=>this.settingSubmit())),t};settingSubmit(){let t=Object.values(document.querySelectorAll("div#script_newTabProfile_setting input[type='checkbox']")).map((t=>t.checked));this.indexDBData.activeZone_market=t[0],this.indexDBData.activeZone_chat=t[1],this.indexDBData.activeZone_warehouse=t[2],this.indexDBData.activeZone_search=t[3],a.indexDB_updateIndexDBData(),a.alert("保存并记录")}mainFunc(t){let e=document.querySelector("div#root");if(!e)return setTimeout((()=>this.mainFunc(void 0)),1e3);e.addEventListener("click",(t=>this.clickHandle(t)))}clickHandle(t){try{if(!t.target)return;if(![Boolean(this.indexDBData.activeZone_market&&/market\/resource\/\d+\/$/.test(location.href)),Boolean(this.indexDBData.activeZone_chat&&/messages\/.+\/$/.test(location.href)),Boolean(this.indexDBData.activeZone_warehouse&&/headquarters\/warehouse\//.test(location.href)),Boolean(this.indexDBData.activeZone_search&&/search\//.test(location.href))].includes(!0))return;let e=this.nodeTagCheck(t.target);if(!e||!e[0])return;window.open(e[1]),t.preventDefault()}catch(t){a.errorLog(t)}}nodeTagCheck(t,e=0){let i=s.basisCPT.realm,n=r.basisCPT.userInfo[i].authCompany.company;if(e>=3)return[!1,""];let a=/\/.+\/company\/\d+\/.+\//;if("A"==t.tagName&&t.getAttribute("href")){if(t.getAttribute("href").match(n))return[!1,""];if(a.test(t.getAttribute("href")))return[!0,t.getAttribute("href")]}return this.nodeTagCheck(t.parentElement,++e)}}},5:(t,e,i)=>{const n=i(832),{tools:a,indexDBData:o}=i(658);new class notesSearch extends n{constructor(){super(),this.name="备注搜索",this.describe="在备注页面可以在所有你曾经写过的,给别家公司的备注中搜索内容",this.enable=!1,this.tagList=["备注","实用"]}componentData={node:void 0};cssText=['div[sct_notessearch][sct_id="container"]{background-color:#00000099;padding:10px;margin-bottom:10px;color:var(--fontColor);}[sct_notessearch]>[sct_id="header"]{text-align:center;margin-bottom:10px;font-size:large;font-weight:700;}[sct_notessearch]>[sct_id="main"]{padding:5px;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:center;align-items:stretch;}[sct_notessearch]>[sct_id="main"]>input{flex:4;color:var(--fontColor);background-color:#333333;margin-right:5px;}[sct_notessearch]>[sct_id="main"]>button{text-align:center;flex:1;line-height:16px;font-size:16px;vertical-align:middle;background-color:#333333;color:var(--fontColor);}[sct_notessearch]>[sct_id="main"]>button:hover{outline-offset:1px;outline:5px auto white;}[sct_notessearch]>[sct_id="main"]>button>span{vertical-align:middle;}'];commonFuncList=[{match:()=>/account\/notes\/$/.test(location.href)&&!document.querySelector("div[sct_notessearch]"),func:this.mountFunc}];mountFunc(){if(!this.componentData.node){let t=document.createElement("div");t.innerHTML='<div sct_id=header>备注搜索</div><div sct_id=main><input class=form-control> <button class="form-control btn"><span><svg height=16 viewBox="0 0 16 16"width=16 xmlns=http://www.w3.org/2000/svg><g fill=none stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=1.5><path d="m11.25 11.25l3 3"></path><circle cx=7.5 cy=7.5 r=4.75></circle></g></svg></span>搜索</button></div>',t.setAttribute("sct_notessearch",""),t.setAttribute("sct_id","container"),t.querySelector("div[sct_id='main']>button").addEventListener("click",(t=>this.mainClick(t))),t.querySelector("div[sct_id='main']>input").addEventListener("keydown",(t=>13===t.keyCode?t.target.nextElementSibling.click():null)),this.componentData.node=t}document.querySelector("div.container>div.row div.col-md-6.col-md-pull-6").prepend(this.componentData.node)}async mainClick(t){let e=await a.getRealm(),i=t.target.closest("button")?.previousElementSibling?.value;if(this.showAll(),""==i||!i)return;let n=o.basisCPT.notes[e].out.filter((t=>!t.note.includes(i))).map((t=>t.about.company));this.getAllNodes().filter((t=>n.includes(t.querySelector("b").innerText.trim()))).map((t=>t.style.display="none"))}showAll(){let t=this.getAllNodes();for(let e=0;e<t.length;e++)t[e].style.display=""}getAllNodes(){return Object.values(document.querySelector("div[sct_notessearch]").nextElementSibling.querySelector(".well-header").nextElementSibling.children)}}},892:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c,langData:l}=i(658);new class oneClickRebuild extends n{constructor(){super(),this.name="更好的一键重建",this.describe="可以自定义矿井/油井/采石场的重建丰度检测,只要不满足就会显示一键重建按钮",this.enable=!0,this.tagList=["实用"]}indexDBData={minAbundance_14:99.9,minAbundance_15:99.9,minAbundance_68:99.9,minAbundance_42:99.9,minAbundance_44:99.9,minAbundance_104:99.9,minAbundance_105:99.9,minAbundance_10:99.9,minAbundance_74:99.9};cssText=["button#script_mineRebuild_btn{color:var(--fontColor);display: block;width: 90%;margin: 10px auto;background-color: rgb(165,42,42);}button#script_mineRebuild_btn:hover{background-color:rgb(103 34 34);color:white;}","button#script_mineRebuild_btn{padding:0;}"];componentData={abundanceList:{},btnNode:void 0,tampTargetName:"",targetBuildList:["M","Q","O"]};netFuncList=[{urlMatch:t=>/buildings\/\d+\/abundance\//.test(t),func:this.netReqGet}];commonFuncList=[{match:()=>/b\/\d+\/$/.test(location.href),func:this.mainFunc}];frontUI=async()=>{if(/b\/\d+\/$/.test(location.href)){let t=parseInt(location.href.match(/b\/(\d+)\/$/)[1]);return this.componentData.targetBuildList.includes(a.getBuildKind(t))?void this.rebuildHandle(void 0):a.alert("请先进入建筑界面,包括:矿井 采石场 油井")}if(/\/landscape\/$/.test(location.href)&&await a.confirm("现在将会使用插件组件配置来查询所有不符合条件的矿井/采石场/油井,你确定吗?\n(请仔细检查配置,仔细检查配置,仔细检查配置)"))return this.oneClickRebuildAll()};settingUI=()=>{let t=document.createElement("div"),e='<div class=header>更好的一键重建</div><div class=container><div><div><button class="btn script_opt_submit">保存</button></div></div><table><thead><tr><td>功能<td>设置<tbody><tr><td>矿井-矿物<td><input class=form-control max=100 min=0 step=0.1 type=number value=######><tr><td>矿井-铝土矿<td><input class=form-control max=100 min=0 step=0.1 type=number value=######><tr><td>矿井-金矿石<td><input class=form-control max=100 min=0 step=0.1 type=number value=######><tr><td>矿井-铁矿石<td><input class=form-control max=100 min=0 step=0.1 type=number value=######><tr><td>采石场-沙子<td><input class=form-control max=100 min=0 step=0.1 type=number value=######><tr><td>采石场-黏土<td><input class=form-control max=100 min=0 step=0.1 type=number value=######><tr><td>采石场-石灰石<td><input class=form-control max=100 min=0 step=0.1 type=number value=######><tr><td>油井-原油<td><input class=form-control max=100 min=0 step=0.1 type=number value=######><tr><td>油井-甲烷<td><input class=form-control max=100 min=0 step=0.1 type=number value=######></table></div>'.replace("######",this.indexDBData.minAbundance_14).replace("######",this.indexDBData.minAbundance_15).replace("######",this.indexDBData.minAbundance_68).replace("######",this.indexDBData.minAbundance_42).replace("######",this.indexDBData.minAbundance_44).replace("######",this.indexDBData.minAbundance_104).replace("######",this.indexDBData.minAbundance_105).replace("######",this.indexDBData.minAbundance_10);return e=e.replace("######",this.indexDBData.minAbundance_74),t.innerHTML=e,t.id="script_mineRebuild_setting",t.querySelector("button.script_opt_submit").addEventListener("click",(()=>this.settingSubmit())),t};settingSubmit(){let t=Object.values(document.querySelectorAll("#script_mineRebuild_setting input")).map((t=>parseFloat(t.value)));if(0!=t.filter((t=>Boolean(t<0||t>=100))).length)return a.alert("不能低于0或者大于等于100");this.indexDBData.minAbundance_14=t[0],this.indexDBData.minAbundance_15=t[1],this.indexDBData.minAbundance_68=t[2],this.indexDBData.minAbundance_42=t[3],this.indexDBData.minAbundance_44=t[4],this.indexDBData.minAbundance_104=t[5],this.indexDBData.minAbundance_105=t[6],this.indexDBData.minAbundance_10=t[7],this.indexDBData.minAbundance_74=t[8],a.indexDB_updateIndexDBData(),a.alert("保存并更新"),document.querySelector("button#script_mineRebuild_btn")&&document.querySelectorAll("button#script_mineRebuild_btn").forEach((t=>t.remove()))}netReqGet(t,e,i){let n=JSON.parse(i);this.componentData.abundanceList[n.buildingId]=n.abundance}abundanceCheck(t){let e=this.componentData.abundanceList[t];for(const t in e)if(Object.hasOwnProperty.call(e,t)){if(null==this.indexDBData[`minAbundance_${t}`])return!1;if(0!=this.indexDBData[`minAbundance_${t}`]&&!(e[t]<this.indexDBData[`minAbundance_${t}`]))return!1}return!0}mainFunc(){let t=parseInt(location.href.match(/b\/(\d+)\/$/)[1]);if(!this.componentData.targetBuildList.includes(a.getBuildKind(t)))return;if(document.querySelector("button#script_mineRebuild_btn"))return;if(null==this.componentData.abundanceList[t])return;if(!this.abundanceCheck(t))return;this.componentData.btnNode||(this.componentData.btnNode=document.createElement("button"),this.componentData.btnNode.id="script_mineRebuild_btn",this.componentData.btnNode.className="btn",this.componentData.btnNode.innerText="重建");let e=Object.values(document.querySelectorAll("button>svg[data-icon='dumpster'][role='img']")),i=this.componentData.btnNode.cloneNode(!0),n=this.componentData.btnNode.cloneNode(!0);i.addEventListener("click",(t=>this.rebuildHandle(t))),n.addEventListener("click",(t=>this.rebuildHandle(t))),a.getParentByIndex(e[0],2).appendChild(i),a.getParentByIndex(e[1],3).appendChild(n)}async rebuildHandle(t,e="one"){if("one"==e&&!await a.confirm("确认要重建吗?"))return;let i=document.querySelector("div>span>b").innerText;try{a.setWindowMask(!0),document.querySelector('button>svg[data-icon="dumpster"]').parentElement.click(),await a.dely(1500),document.querySelector("div.modal-body.modal-upgrade button.btn-primary").click(),await a.dely(1500),Object.values(document.querySelectorAll("div#page>div>div>div>div>a")).filter((t=>t.href.match(/\/landscape\/buildings\/\d+\//)))[0].click(),await a.dely(1500),Object.values(document.querySelectorAll("div.hover-effect>p>b")).filter((t=>t.innerText==i))[0].click(),await a.dely(1500),document.querySelector("button.btn.btn-primary").click(),await a.dely(1500)}catch(t){console.error(t),a.alert("一键重建功能出现错误,请打开开发者工具(F12)找到最近的error信息发送给开发者.")}finally{"one"==e&&(a.setWindowMask(!1),a.alert("一键重建已完成."))}}async oneClickRebuildAll(){try{a.setWindowMask(!0);let t=await a.getRealm(),e=r.basisCPT.building[t];e=e.filter((t=>this.componentData.targetBuildList.includes(t.kind)&&null==t.busy));for(let t=0;t<e.length;t++){let i=e[t].id;if(null==this.componentData.abundanceList[i]){let t=await a.getNetData(`https://www.simcompanies.com/api/v2/companies/buildings/${i}/abundance/`);if(!t)continue;this.componentData.abundanceList[i]=t.abundance}this.abundanceCheck(i)&&(Object.values(document.querySelectorAll("div#page>div>div>div>div>a")).filter((t=>t.href.match(i)))[0].click(),await a.dely(1500),await this.rebuildHandle(void 0,"all"))}}finally{a.setWindowMask(!1),a.alert("一键重建已完成.")}}}},408:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class otherRealmMsg extends n{constructor(){super(),this.name="待处理信息显示",this.describe="用于修复手机上不显示别的服务器的待处理信息量,默认不启动",this.enable=!1,this.tagList=["样式","信息"]}componentData={baseURL:"https://www.simcompanies.com/api/v3/contracts-incoming",baseWS:"wss://www.simcompanies.com/ws",containerNode:void 0};startupFuncList=[this.startupMsgCheck];cssText=["div#script_unreadMsg {display:none;position:relative;left:5px;top:4px;}"];async startupMsgCheck(t,e=0){if(location.href.match(/zh\/$/)||null==s.basisCPT.realm)return setTimeout((()=>{this.startupMsgCheck(void 0,0)}),5e3);if(0==e)return setTimeout((()=>{this.startupMsgCheck(void 0,++e)}),5e3);let i=s.basisCPT.realm;try{let t=document.querySelector(".navbar-container svg.fa-message>path");t||(t=document.querySelector(".navbar-container svg.fa-file-signature>path")),a.getParentByIndex(t,4).style.display="none"}catch(t){if(e<3)return a.errorLog(t),setTimeout((()=>{this.startupMsgCheck(void 0,++e)}),5e3);a.msg_send("待处理信息显示","组件已连续两次无法捕获官方原有的信息提示,尝试强制添加.",1)}let n=document.createElement("div");n.id="script_unreadMsg",n.innerHTML='<div><svg style="width:14px;" aria-hidden=true class="css-0 svg-inline--fa fa-file-signature"data-icon=file-signature data-prefix=fas focusable=false role=img viewBox="0 0 576 512"xmlns=http://www.w3.org/2000/svg><path d="M64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V428.7c-2.7 1.1-5.4 2-8.2 2.7l-60.1 15c-3 .7-6 1.2-9 1.4c-.9 .1-1.8 .2-2.7 .2H240c-6.1 0-11.6-3.4-14.3-8.8l-8.8-17.7c-1.7-3.4-5.1-5.5-8.8-5.5s-7.2 2.1-8.8 5.5l-8.8 17.7c-2.9 5.9-9.2 9.4-15.7 8.8s-12.1-5.1-13.9-11.3L144 381l-9.8 32.8c-6.1 20.3-24.8 34.2-46 34.2H80c-8.8 0-16-7.2-16-16s7.2-16 16-16h8.2c7.1 0 13.3-4.6 15.3-11.4l14.9-49.5c3.4-11.3 13.8-19.1 25.6-19.1s22.2 7.8 25.6 19.1l11.6 38.6c7.4-6.2 16.8-9.7 26.8-9.7c15.9 0 30.4 9 37.5 23.2l4.4 8.8h8.9c-3.1-8.8-3.7-18.4-1.4-27.8l15-60.1c2.8-11.3 8.6-21.5 16.8-29.7L384 203.6V160H256c-17.7 0-32-14.3-32-32V0H64zM256 0V128H384L256 0zM549.8 139.7c-15.6-15.6-40.9-15.6-56.6 0l-29.4 29.4 71 71 29.4-29.4c15.6-15.6 15.6-40.9 0-56.6l-14.4-14.4zM311.9 321c-4.1 4.1-7 9.2-8.4 14.9l-15 60.1c-1.4 5.5 .2 11.2 4.2 15.2s9.7 5.6 15.2 4.2l60.1-15c5.6-1.4 10.8-4.3 14.9-8.4L512.1 262.7l-71-71L311.9 321z"fill=currentColor></path></svg> <span>&nbsp;###CONTRACT###</span></div><div><svg aria-hidden=true class="css-0 svg-inline--fa fa-message"data-icon=message data-prefix=fas focusable=false role=img viewBox="0 0 512 512"xmlns=http://www.w3.org/2000/svg><path d="M64 0C28.7 0 0 28.7 0 64V352c0 35.3 28.7 64 64 64h96v80c0 6.1 3.4 11.6 8.8 14.3s11.9 2.1 16.8-1.5L309.3 416H448c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64H64z"fill=currentColor></path></svg> <span>&nbsp;###MSG###</span></div>';let o,r,c=a.getParentByIndex(document.querySelectorAll("div.navbar-container div>img")[0],3);this.componentData.containerNode=n,c.insertAdjacentElement("afterend",n);let l=await a.getNetData(`${this.componentData.baseURL}/${i}/me/#${await a.generateUUID()}`);if(!l)return a.errorLog(l);0==l.incomingContractsOtherRealms.length?o=0:l.incomingContractsOtherRealms[0].incoming&&(o=l.incomingContractsOtherRealms[0].incoming),n.innerHTML=n.innerHTML.replace("###CONTRACT###",o);let d=new WebSocket(this.componentData.baseWS);d.onopen=()=>{a.log("连接至聊天室频道,等待信息中."),d.send(JSON.stringify({routing:"RESYNC_AFTER_RECONNECT",data:[]}))},d.onmessage=t=>{let e=JSON.parse(t.data);if("GROUP"==e.routing){if(0==e.messages.length)return d.close();for(let t=0;t<e.messages.length;t++){let i=e.messages[t];"UNREAD_MESSAGES"==i.routing&&(0!=i.data.unreadMessagesOtherRealms.length&&(a.log(i),r=i.data.unreadMessagesOtherRealms[0].unread))}return n.innerHTML=n.innerHTML.replace("###MSG###",r||0),this.showContainer(),d.close()}}}showContainer(){this.componentData.containerNode.style.display="inline-block"}}},293:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class profileBigAvatar extends n{constructor(){super(),this.name="资料页头像点击放大",this.describe="在资料页点击头像会方法",this.enable=!0,this.canDisable=!0,this.tagList=["样式"]}commonFuncList=[{match:t=>Boolean(location.href.match(/company\/(0|1)\/.*\//))&&"IMG"==t.target.tagName&&"H1"==t.target.parentElement.tagName,func:this.mainFunc}];mainFunc(t){a.log(t.target.style.width),t.target.style.width&&"90px"!=t.target.style.width?Object.assign(t.target.style,{width:"90px",height:"90px",zIndex:"0"}):Object.assign(t.target.style,{width:"300px",height:"300px",zIndex:"1031"})}}},797:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class profileLocalTimeConvertTo24 extends n{constructor(){super(),this.name="当地时间转换为24小时制",this.describe="公司资料页面中的 当地时间 自动从12小时制转换为24小时制",this.enable=!0,this.canDisable=!0,this.tagList=["样式","实用"]}componentData={lastText:""};commonFuncList=[{match:()=>Boolean(location.href.match(/company\/(0|1)\/.*\//)),func:this.mainFunc}];mainFunc(){let t,e=document.querySelectorAll("div > table > tbody > tr > td");if(0==e.length)return;for(let i=0;i<e.length;i++)if("当地时间"==e[i].innerText){t=e[i+1];break}let i=a.convert12To24Hr(t.innerText)?a.convert12To24Hr(t.innerText):t.innerText;i!=this.componentData.lastText&&(this.componentData.lastText=i,t.innerText=i)}}},283:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class purchaseByMoney extends n{constructor(){super(),this.name="交易所金额限购",this.describe="交易行多出一排信息，输入采购目标（最低品质要求，最高金额限制）\n点击按钮会提示计算结果，点击确定会尝试进行采购\n采购金额误差可能有±1%",this.enable=!1,this.tagList=["实用","交易所"]}commonFuncList=[{match:()=>Boolean(location.href.match(/market\/resource\/(\d+)\//)),func:this.mainFunc}];componentData={containerNode:void 0,inProcess:!1};cssText=["div#script_purchaseByMoney_container{margin:10px;display:flex;justify-content:center;align-items:center;width:auto;height:45px;}div#script_purchaseByMoney_container>input#script_quality_Inp{width:80px;height:34px;}div#script_purchaseByMoney_container>input#script_amount_Inp{margin:10px;width:150px;height:34px;}div#script_purchaseByMoney_container>button#scriptBtn_1{background-color:green;color:var(--fontColor);}"];mainFunc(){let t=document.querySelector("form").parentElement;if(this.componentData.containerNode||0!=t.querySelectorAll("div#script_purchaseByMoney_container").length)this.componentData.containerNode&&0==t.querySelectorAll("div#script_purchaseByMoney_container").length&&t.appendChild(this.componentData.containerNode);else{let e='\n        <input id="script_quality_Inp" placeholder="最低品质" type="number"/>\n        <input id="script_amount_Inp" placeholder="全款金额" type="number"/>\n        <button class="btn" id="scriptBtn_1" style="">使用金额限购</button>',i=document.createElement("div");i.id="script_purchaseByMoney_container",i.innerHTML=e,t.appendChild(i),this.componentData.containerNode=i,document.querySelector("button#scriptBtn_1").addEventListener("click",(()=>{try{if(this.componentData.inProcess)return;this.componentData.inProcess=!0,this.purchaseButtonHandle()}finally{this.componentData.inProcess=!1}}))}}async purchaseButtonHandle(){let t=parseInt(document.querySelector("#script_quality_Inp").value)||0,e=document.querySelector("#script_amount_Inp").value,i=parseInt(location.href.match(/\d+(?=\/$)/)?.[0]),n=0,o=0,r=0,c=s.basisCPT.realm;if(""==t&&(t=0),t<0||t>12)return a.alert("品质输入有误");if(""==e||e<0)return a.alert("金额输入有误");let l=await a.getNetData(`${a.baseURL.market}/${c}/${i}/#${a.generateUUID()}`);if(!l)return a.alert("交易行资源请求失败，请重试或检查网络连接。");for(let i=0;i<l.length;i++){let a=l[i];if(!(a.quality<t)){if(!(e>n+a.price*a.quantity)){o+=(e-n)/a.price,o=parseInt(o),r=a.price;break}n+=a.price*a.quantity,o+=a.quantity}}if(!await a.confirm(`使用金额限定从交易行购买 - \n    最大价格:${r}, \n    最低质量:${t}, \n    物品数量:${o-1}, \n    物品ID:${i}\n是否确定？`))return;let d=!1;await a.dely(500);try{0!=document.querySelectorAll("form ul[role='menu'] li > a").length&&document.querySelectorAll("form ul[role='menu'] li > a")[t].click()}catch{d=!0}await a.dely(500);try{a.setInput(document.querySelector("form input[name='quantity']"),o-1)}catch{d=!0}if(d)return a.alert("执行出错.请尝试打开debug模式,重试后截图控制台信息给开发者.");await a.dely(500),document.querySelector("form button[type=submit]").click()}}},530:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c,langData:l}=i(658);new class queryHistoricalContracts extends n{constructor(){super(),this.name="查询历史合同",this.describe="在仓库物资界面,发送合同给目标公司时,可以点击按钮查询曾经相关往来.了解价格.",this.enable=!0,this.tagList=["实用","统计","样式"]}componentData={buttonNode:void 0,displayFlag:!1,hisContaracts:[],blockCataList:["o","p","b"]};cssText=["#script_hisContracts_mainDiv{color:var(--fontColor);background-color:rgb(0,0,0,0.7);}#script_hisContracts_mainDiv table>thead{text-align:center;}#script_hisContracts_mainDiv table{width:100%;border-collapse:separate;border-spacing:10px;}#script_hisContracts_mainDiv table tr>td:nth-of-type(1)>span{display:block;width:100px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}#script_hisContracts_mainDiv table tr>td:nth-of-type(5){text-align:end;}"];commonFuncList=[{match:()=>Boolean(/headquarters\/warehouse\/.+/.test(location.href)&&0!=document.querySelectorAll("button.link-button[type='button']").length),func:this.mountButtonFunc}];netFuncList=[{urlMatch:t=>/resources-transactions\/(\d+)\//.test(t),func:this.netGetFunc}];netGetFunc(t,e,i){let n=JSON.parse(i);n=n.filter((t=>!this.componentData.blockCataList.includes(t.category)));let a=parseInt(t.match(/resources-transactions\/(\d+)\//)[1]),o=0==parseInt(t.match(/resources-transactions\/\d+\/(\d+)\//)[1]);this.componentData.hisContaracts[a]=o?n:this.componentData.hisContaracts[a].concat(n)}mountButtonFunc(){if(!this.componentData.buttonNode){let t=document.createElement("button");t.id="script_queryHisCont_btn",t.innerText="相关历史订单",t.addEventListener("click",(t=>this.buttonClickHandle(t))),this.componentData.buttonNode=t}if(document.getElementById("script_queryHisCont_btn"))return;let t=document.querySelector("svg[data-icon='filter']"),e=a.getParentByIndex(t,1);a.getParentByIndex(t,2).insertBefore(this.componentData.buttonNode,e),this.componentData.displayFlag=!1}buttonClickHandle(t){if(!document.querySelector("form>div>b")&&!this.componentData.displayFlag)return a.alert("请在合同界面,先选定一个收货方再点击此按钮来查询.(最多查询一周长度)");let e=a.itemName2Index(decodeURI(location.href.match(/headquarters\/warehouse\/(.+)/)[1])),i=document.querySelector("div#script_hisContracts_mainDiv"),n=a.getParentByIndex(t.target,3),o=n.childNodes[1];if(this.componentData.displayFlag||!document.querySelector("form>div>b"))return i.style.display="none",o.style.display="",void(this.componentData.displayFlag=!1);if(null==this.componentData.hisContaracts[e])return a.alert("请先点击原网页的'获取库存记录变动'按钮");i&&i.remove(),i=document.createElement("div"),i.id="script_hisContracts_mainDiv";let s="<table><thead><tr><td>目标</td><td>Q</td><td>量</td><td>单价</td><td>时间</td></tr></thead><tbody>",r=document.querySelector("form>div>b").innerText;for(let t=0;t<this.componentData.hisContaracts[e].length;t++){let i=this.componentData.hisContaracts[e][t];if(i.otherParty.company!=r)continue;let n=i.amount>0?`+${a.numberAddCommas(i.amount)}`:a.numberAddCommas(i.amount),o=Math.abs(i.cost/i.amount).toFixed(3),c=new Date(i.datetime).toLocaleString();s+=`<tr><td><span>${r}</span></td><td>${i.quality}</td><td>${n}</td><td>$${o}</td><td>${c}</td></tr>`}s+="</tbody></table>",i.innerHTML=s,n.appendChild(i),i.style.display="",o.style.display="none",this.componentData.displayFlag=!0}}},11:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class retailDisplayProfit extends n{constructor(){super(),this.name="零售显示总利润、时利润",this.describe="在零售建筑中尝试上架零售物品的时候，会实时计算零售利润和每小时利润",this.enable=!0,this.canDisable=!0,this.tagList=["零售","利润"]}commonFuncList=[{match:()=>Boolean(location.href.match(/\/b\/\d+\//))&&"price"==document.activeElement.name&&"INPUT"==document.activeElement.tagName,func:this.mainFunc}];componentData={fadeTimer:void 0,containerNode:void 0,lastActiveInputNode:void 0};indexDBData={minRate:.8,maxRate:1.2};cssText=["#retail_display_div {color:var(--fontColor);padding:5px;border-radius:5px;background-color:rgba(0, 0, 0, 0.5);position:fixed;top:50%;right:0;transform: translateY(-50%) translateX(-50%);width:270px;z-index:1032;justify-content:center;align-items:center;}#retail_display_div button{background:#1e1818;margin-top:5px;transition:ease-in-out 0.25s;}#retail_display_div button:hover{background-color:white;color:black;}"];settingUI=()=>{let t=document.createElement("div"),e='<div class=header>零售利润显示组件设置</div><div class=container><div><button class="btn script_opt_submit">保存更改</button></div><table><thead><tr><td>功能<td>设置<tbody><tr><td title=遍历价格的初始倍率>初始倍率<td><input class=form-control type=number value=######><tr><td title=遍历价格的最大倍率>最大倍率<td><input class=form-control type=number value=######></table></div>';return e=e.replace("######",this.indexDBData.minRate),e=e.replace("######",this.indexDBData.maxRate),t.id="script_srtting_retailProfit",t.innerHTML=e,t.querySelector("button.script_opt_submit").addEventListener("click",(()=>this.settingSubmitHandle())),t};settingSubmitHandle(){let t=Object.values(document.querySelectorAll("div#script_srtting_retailProfit input")).map((t=>parseFloat(t.value)));if(t.includes(NaN)||-1!=t.findIndex((t=>t<=0)))return a.alert("数据不正确");this.indexDBData.minRate=t[0],this.indexDBData.maxRate=t[1],a.indexDB_updateIndexDBData(),a.alert("已提交更改")}async mainFunc(){let t,e=document.activeElement,i=e.getBoundingClientRect(),n=a.getParentByIndex(e,5).previousElementSibling.querySelector("div > div > h3").parentElement,o=a.getParentByIndex(e,2).previousElementSibling.querySelector("div > p > input[name='quantity']").value,s=e.value;try{t=this.getInfo(n)}catch(t){return}if(""==o||o<=0)return;if(""==s||s<=0)return;if(this.componentData.fadeTimer&&clearTimeout(this.componentData.fadeTimer),this.componentData.lastActiveInputNode=document.activeElement,!this.componentData.containerNode){let t=document.createElement("div");t.id="retail_display_div",Object.assign(t.style,{display:"none"}),this.componentData.containerNode=t,document.body.appendChild(t),t.addEventListener("click",(t=>this.clickEventHandle(t)))}let r=parseFloat((t.profit*o).toFixed(2)),c=parseFloat((r/t.duration_hour).toFixed(2));if(isNaN(r)||isNaN(c))return;let l="";l+="<div>预估数据: </div>",l+=`<div>总利润：${r}</div>`,l+=`<div>时利润：${c}</div>`,l+="<div>",l+="  <button class='btn' id='script_reatil_maxHour'>最大时利</button>",l+="  <button class='btn' id='script_reatil_maxUnit'>最大单利</button>",l+="  <button class='btn' id='script_reatil_targetHour'>指定时利</button>",l+="</div>",this.componentData.containerNode.innerHTML=l,Object.assign(this.componentData.containerNode.style,{display:"block",top:`${i.top+i.height+100}px`,left:`${i.left+i.width}px`}),this.componentData.fadeTimer=setTimeout((()=>{Object.assign(this.componentData.containerNode.style,{display:"none"})}),3e3)}getInfo(t){let e=t.innerText.split("\n"),i=e[0],n=parseFloat(e[3].replaceAll(",","").match(/\$(-)?\d+\.\d+/)[0].replace("$","")),a=e[4].match(/(\d+:\d+)|(\(.+\))/g);return{name:i,profit:n,duration_hour:this.getTimeFormat(a[0],a[1])}}getTimeFormat(t,e){let i=new Date,[n,o]=t.split(":"),s=new Date(i.getFullYear(),i.getMonth(),i.getDate(),n,o,i.getSeconds(),i.getMilliseconds()),r=parseFloat(((s.getTime()-i.getTime())/36e5).toFixed(3)),c=0;return c+=/(\d+)d/.test(e)?parseInt(e.match(/(\d+)d/)[1]):0,c+=/(\d+)w/.test(e)?7*parseInt(e.match(/(\d+)w/)[1]):0,r+=r<0?24*(c+1):24*c,a.log(`销售完成时间:${new Date((new Date).getTime()+60*r*60*1e3).toLocaleString()}`),r}getQuality(t){let e=a.getParentByIndex(t,6),i=0;return i+=e.querySelectorAll("svg[data-icon='star'][role='img']").length,i+=.5*e.querySelectorAll("svg[data-icon='star'][role='img']").length,i}getCost(t,e){let i=0,n=0,a=s.basisCPT.realm,o=r.basisCPT.warehouse[a].filter((e=>!e.blocked&&e.kind.name==t));o=o.sort(((t,e)=>e.quality-t.quality));for(let t=0;t<o.length;t++){let a=Object.values(o[t].cost).reduce(((t,e)=>t+e),0)/o[t].amount;a=a.toFixed(2);let s=e-i;if(0==s)break;s>=o[t].amount?(i+=o[t].amount,n+=o[t].amount*a):s<o[t].amount&&(i+=s,n+=s*a)}return(n/i).toFixed(2)}clickEventHandle(t){return"BUTTON"==t.target.tagName&&"script_reatil_maxHour"==t.target.id?this.setMaxProfitPrice(t):"BUTTON"==t.target.tagName&&"script_reatil_maxUnit"==t.target.id?this.setMaxUnitProfit(t):"BUTTON"==t.target.tagName&&"script_reatil_targetHour"==t.target.id?this.lockHourProfit(t):void 0}async setMaxUnitProfit(){try{this.componentData.lastActiveInputNode.disabled=!0;let t,{targetNode:e,quantity:i,basePrice:n,maxPrice:o,step:s}=this.preAction(),r=0;for(let i=n;i<o;i+=s){await a.dely(1),a.setInput(this.componentData.lastActiveInputNode,i),t=this.getInfo(e);let o=parseFloat(t.profit);o<=r||(r=o,n=i)}a.log("价格",n,"单利润",r),a.setInput(this.componentData.lastActiveInputNode,n)}finally{this.componentData.lastActiveInputNode.disabled=!1}}async lockHourProfit(t){let e=window.prompt("输入期望的小时收益","0.0");if(!isNaN(parseFloat(e)))try{this.componentData.lastActiveInputNode.disabled=!0;let t,{targetNode:i,quantity:n,basePrice:o,maxPrice:s,step:r}=this.preAction(),c=parseFloat(e);for(let e=o;e<s;e+=r){if(await a.dely(1),a.setInput(this.componentData.lastActiveInputNode,e),t=this.getInfo(i),!(parseFloat(t.profit*n/t.duration_hour)<=c)){o=e;break}}a.log("价格",o,"时利润",c),a.setInput(this.componentData.lastActiveInputNode,o)}finally{this.componentData.lastActiveInputNode.disabled=!1}}async setMaxProfitPrice(t){try{this.componentData.lastActiveInputNode.disabled=!0;let t,{targetNode:e,quantity:i,basePrice:n,maxPrice:o,step:s}=this.preAction(),r=0;for(let c=n;c<o;c+=s){await a.dely(1),a.setInput(this.componentData.lastActiveInputNode,c),t=this.getInfo(e);let o=parseFloat(t.profit*i/t.duration_hour);o<=r||(r=o,n=c)}a.log("价格",n,"时利润",r),a.setInput(this.componentData.lastActiveInputNode,n)}finally{this.componentData.lastActiveInputNode.disabled=!1}}preAction(){a.setInput(this.componentData.lastActiveInputNode,0);let t=parseFloat(a.getParentByIndex(this.componentData.lastActiveInputNode,5).previousElementSibling.innerText.split(/\n/).filter((t=>t.match("平均价格")))[0].replace(/平均价格： \$|,/g,"")),e=a.getParentByIndex(this.componentData.lastActiveInputNode,5).previousElementSibling.querySelector("div > div > h3").parentElement,i=a.getParentByIndex(this.componentData.lastActiveInputNode,2).previousElementSibling.querySelector("div > p > input[name='quantity']").value,n=parseFloat(t)*this.indexDBData.minRate;return{targetNode:e,quantity:i,basePrice:n,maxPrice:parseFloat(t)*this.indexDBData.maxRate,step:this.getStep(n)}}getStep(t){return t<=8?.01:t<=500?.1:1}}},381:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class salesOfficeIncomeDisplay extends n{constructor(){super(),this.name="销售办公室收入显示",this.describe="在销售办公室的订单页面,可以查看各个q的分别收入",this.enable=!0,this.tagList=["样式","零售"]}commonFuncList=[{match:t=>{try{return!!/b\/\d+\/$/.test(location.href)&&"B"==a.getBuildKind(Math.floor(location.href.match(/b\/(\d+)\/$/)[1]))}catch{return!1}},func:this.mainFunc}];mainFunc(t,e="start"){if(!(document.querySelectorAll("div>label>input").length!=document.querySelectorAll("input[type='range'][max='12'][min='0']").length)&&!("force"==e))return;this.clearRangeInput();let i=Object.values(document.querySelectorAll("div>label>input")).map((t=>a.getParentByIndex(t,6)));for(let t=0;t<i.length;t++){let e=i[t],n=document.createElement("div"),o=e.childNodes[0].innerText.split(/\n/).filter((t=>t.match(/每个/))).map((t=>[t.match(/每个(.+)$/)[1],parseInt(t.replaceAll(/\$|,/g,""))])),s=parseFloat(e.childNodes[0].innerText.split(/\n/).filter((t=>t.match(/品质奖励/)))[0])/100,r="<input max=12 min=0 type=range value=1><div><div>Quality 品质: 1</div>";n.id="script_incomeDisplay_root";for(let t=0;t<o.length;t++){let e=o[t][1]*s;r+=`<div>${o[t][0]} $${a.numberAddCommas(o[t][1]+e)} (+$${a.numberAddCommas(e)})</div>`}r+="</div>",n.innerHTML=r,e.firstChild.firstChild.childNodes[1].append(n),n.querySelector("input[type='range'][max='12'][min='0']").addEventListener("change",(t=>this.rangeInputChange(t)))}}rangeInputChange(t){let e=Math.floor(t.target.value),i=a.getParentByIndex(t.target,2),n=i.innerText.split(/\n/).filter((t=>t.match(/每个/))).map((t=>[t.match(/每个(.+)$/)[1],parseInt(t.replaceAll(/\$|,/g,""))])),o=parseFloat(i.innerText.split(/\n/).filter((t=>t.match(/品质奖励/)))[0])/100,s=`<div>Quality 品质: ${e}</div>`;n.forEach((t=>{let i=t[1]*(e*o);s+=`<div>${t[0]} $${a.numberAddCommas(t[1]+i)} (+$${a.numberAddCommas(i)})</div>`})),t.target.nextElementSibling.innerHTML=s}clearRangeInput(){Object.values(document.querySelectorAll("input[type='range'][max='12'][min='0']")).forEach((t=>t.parentElement.remove()))}}},991:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class searchDisplayOnline extends n{constructor(){super(),this.name="标签搜索仅显示在线公司",this.describe="在标签搜索公司的界面上方增加一个按钮\n点击即可切换仅显示在线玩家",this.enable=!0,this.canDisable=!0,this.tagList=["实用","过滤"]}commonFuncList=[{match:()=>Boolean(location.href.match(/\/market\/tag-search\/.+\//)),func:this.mainFunc}];componentData={button_node:void 0,showFlag:!1};mainFunc(){let t=document.querySelector("div > h1 > svg").parentElement;if(this.componentData.button_node||0!=t.querySelectorAll("button").length){if(!this.componentData.button_node||0!=t.querySelectorAll("button").length)return;t.appendChild(this.componentData.button_node)}else{let e=document.createElement("button");Object.assign(e.style,{fontSize:"17px",backgroundColor:"none",color:c.fontColor}),e.className="btn",e.innerText="仅显示在线",this.componentData.button_node=e,t.appendChild(this.componentData.button_node),e.addEventListener("click",(()=>this.buttonHandle()))}}buttonHandle(){let t,e=this.componentData.button_node;a.log("当前搜索界面仅显示在线标记为：",this.componentData.showFlag),this.componentData.showFlag?(Object.assign(e.style,{backgroundColor:"rgb(107,107,107)"}),this.componentData.showFlag=!1,t=""):(Object.assign(e.style,{backgroundColor:"green"}),this.componentData.showFlag=!0,t="none");let i=document.querySelectorAll("div > div.row > div.col-sm-6");for(let e=0;e<i.length;e++){let n=i[e],a=n.querySelector("div.pull-right").nextElementSibling.innerText;"n/a"!==a&&"offline"!==a||(n.style.display=t)}}}},926:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class searchShowIntroduction extends n{constructor(){super(),this.name="搜索显示完整简介",this.describe="在搜索界面可以将所有人的公司简介显示完整。",this.enable=!1}cssText=["div>div.row>div.col-sm-6>div[class]{height:max-content !important;}div>div.row>div.col-sm-6>div[class]>div:last-of-type{height:max-content !important;overflow:visible !important;}"]}},276:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class sellProfitDisplay extends n{constructor(){super(),this.name="交易所上架/合同交易时显示利润",this.describe="在仓库发送物品到交易所或者通过合同出售的界面会自动计算收入总量与利润值",this.enable=!0,this.canDisable=!0,this.tagList=["交易所","利润"]}commonFuncList=[{match:()=>Boolean(location.href.match(/warehouse\/(.+)/)&&document.querySelectorAll("form").length>0),func:this.mainFunc}];componentData={lastPrice:0,lastAmount:0};mainFunc(){try{let t,e=document.querySelector("form");e.lastChild.querySelector("span")?t=e.lastChild.querySelector("span"):(t=document.createElement("span"),t.innerText="等待计算利润",e.lastChild.prepend(document.createElement("br")),e.lastChild.prepend(t));let i=e.querySelectorAll("input"),n=e.querySelector("div.row").nextElementSibling.querySelectorAll("span");if(parseInt(i[0].value)==this.componentData.lastAmount&&parseFloat(i[1].value)==this.componentData.lastPrice)return;let o=parseInt(i[0].value),s=this.get_quality(e),r=e.previousElementSibling.querySelector("b").innerText,c=this.get_cost(r,s),l=parseFloat(i[1].value),d=parseInt(n[1].innerText.split("\n")[0].replaceAll(/(\$)|(,)/g,""))||0,u=parseInt(n[0].innerText.replaceAll(/(x)|(,)/g,"")),p=this.get_cost("运输单位",0)||0,h=u*p;if(0==l)return;let m=isNaN(parseInt(o*l))?0:parseInt(o*l),g=isNaN(parseInt(m-(o*c+h+d)))?0:parseInt(m-(o*c+h+d));a.log(`${o*l-(o*c+h+d)} 税费：${d}`),a.log(`数量：${o}\n售价：${l}\n成本：${c}\n运输数量：${u}\n运输单价：${p}\n利润:${g}`),this.componentData.lastAmount=o,this.componentData.lastPrice=l,t.innerText=`收款：$${a.numberAddCommas(m-d)}，利润：$${a.numberAddCommas(g)}`}catch(t){a.errorLog(t)}}get_quality(t){let e=t.previousElementSibling.querySelectorAll("span > svg").length;if(0==e)return 0;let i=parseInt(t.previousElementSibling.querySelectorAll("span > svg")[0].parentElement.innerText);return isNaN(i)?e:i}get_cost(t,e){let i=s.basisCPT.realm;if(null==i)return 0;let n=0;return r.basisCPT.warehouse[i].forEach((i=>{if(i.kind.name!=t||i.quality!=e)return;let a=Object.values(i.cost).reduce(((t,e)=>t+e),0);n=(a/i.amount).toFixed(10)})),parseFloat(n)}}},794:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class singleBigChat extends n{constructor(){super(),this.name="单大聊天窗口",this.describe="让聊天窗页面只有一个大窗口,可以畅爽体验.",this.enable=!1,this.tagList=["样式","聊天"]}cssText=["div#page>div>div.container>div.row>div.col-lg-9.col-md-8.col-sm-7>div.row>div.col-lg-6:nth-of-type(1){width:100% !important;}div#page>div>div.container>div.row>div.col-lg-9.col-md-8.col-sm-7>div.row>div.col-lg-6:nth-of-type(2){display:none !important;}"]}},523:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class unBusyHighLight extends n{constructor(){super(),this.name="空闲建筑高亮",this.describe="如题",this.enable=!1,this.tagList=["样式","建筑"]}componentData={blackList:["n"]};commonFuncList=[{match:()=>Boolean(/landscape\/$/.test(location.href)),func:this.mainFunc}];cssText=[".script_unBusyHighLight_aTag span>span{background-color:#ffff00;color:black;}.script_unBusyHighLight_aTag span>small>span{background-color:#ffff00;color:black;}"];async mainFunc(){let t=await a.getRealm(),e=r.basisCPT.building[t].filter((t=>null==t.busy&&!this.componentData.blackList.includes(t.kind))).map((t=>t.id+"")),i=Object.values(document.querySelectorAll("div#page>div>div>div>div>a")).filter((t=>/\/b\/(\d+)\/$/.test(t.href)&&e.includes(t.href.match(/\/b\/(\d+)\/$/)[1]))).filter((t=>!/script_unBusyHighLight_aTag/.test(t.className)));for(let t=0;t<i.length;t++)i[t].className+=" script_unBusyHighLight_aTag"}}},13:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class warehouseACCmpOffest extends n{constructor(){super(),this.name="仓库出售界面显示mp偏移",this.describe="在仓库出售表格中,填写单价的下面会自动根据当前",this.enable=!0}indexDBData={mp_offest:3,percentSign:!1};componentData={onLoad:!1};commonFuncList=[{match:()=>Boolean(location.href.match(/warehouse\/(.+)/)&&document.querySelectorAll("form").length>0),func:this.mainFunc}];settingUI=()=>{let t=document.createElement("div"),e='<div class="header">仓库出售界面显示mp偏移</div><div class="container"><div><button class="btn script_opt_submit">保存</button></div><table><thead><tr><td>功能</td><td>设置</td></tr></thead><tbody><tr><td title="MarketPrice Offest 偏移量 填写1 就是 mp-1">mp量</td><td><input type=\'number\' class="form-control" value="#####"></td></tr><tr><td title="勾选就是显示百分比符号,仅仅是显示而已,勾选与否都是使用百分比去计算的">是否显示百分号</td><td><input type=\'checkbox\' style=\'height:20px;\' class="form-control" ######></td></tr></tbody></table></div>';return e=e.replace("#####",this.indexDBData.mp_offest),e=e.replace("######",this.indexDBData.percentSign?"checked":""),t.innerHTML=e,t.id="accMPoffsetSetting",t.querySelector("button.script_opt_submit").addEventListener("click",(()=>this.settingSubmit())),t};settingSubmit(){let t=Object.values(document.querySelectorAll("div#accMPoffsetSetting input")).map((t=>"number"==t.type?parseFloat(t.value):"checkbox"==t.type?t.checked:t.value));if(t[0]<0||t[0]>=100)return a.alert("你要不要看看你填的啥?");this.indexDBData.mp_offest=t[0],this.indexDBData.percentSign=t[1],a.indexDB_updateIndexDBData(),a.alert("已提交更改")}async mainFunc(){if(0!=this.indexDBData.mp_offest&&!document.querySelector("span#script_mpoffest_span")&&!this.componentData.onLoad){this.componentData.onLoad=!0;try{let t=document.createElement("span"),e=s.basisCPT.realm;t.id="script_mpoffest_span";let i=decodeURI(location.href.match(/\/([^\/]+)$/)[1]),n=a.itemName2Index(i),o=this.getQuality(document.querySelector("form")),r=await a.getMarketPrice(n,o,e),c=`MP-${this.indexDBData.mp_offest}${this.indexDBData.percentSign?"%":""}：`;c+=`${(r*(100-this.indexDBData.mp_offest)/100).toFixed(3)}`,t.innerText=c,document.querySelector("input[name='price']").parentElement.appendChild(t)}catch(t){a.errorLog(t)}this.componentData.onLoad=!1}}getQuality(t){let e=t.previousElementSibling.querySelectorAll("span > svg").length;if(0==e)return 0;let i=parseInt(t.previousElementSibling.querySelectorAll("span > svg")[0].parentElement.innerText);return isNaN(i)?e:i}}},585:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c,langData:l}=i(658);new class warehouseChangeRecords extends n{constructor(){super(),this.name="仓库变动统计",this.describe="在仓库界面可以打开显示仓库变动统计",this.enable=!1,this.tagList=["统计","仓库"]}dependence={cpt:[],url:[{name:"echarts",url:"https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"}]};indexDBData={r0Data:[],r1Data:[],dataLength:20,norm:"amount",isDark:!0};componentData={realm:void 0,warehouseMountMain:void 0,warehouseIsOn:!1,suspendDisplayMain:void 0};netFuncList=[{urlMatch:t=>/v2\/resources\/$/.test(t),func:this.warehouseInfo}];commonFuncList=[{match:()=>Boolean(/warehouse\/$/.test(location.href)),func:this.mountPanel}];cssText=["div#script_warehouseChange_wMain{transition:ease-in-out 0.5s;width:100%;overflow-x:auto;overflow-y:hidden;padding:10px;color:var(--fontColor);}div#script_warehouseChange_wMain.script_hide{height:60px;}div#script_warehouseChange_wMain.script_show{height:600px;}button#script_warehouseChange_wButton{height:40px;width:60%;display:block;margin:0 auto 10px auto;transition:ease-in-out 0.5s;background-color:#727272;}button#script_warehouseChange_wButton:hover{background-color:#dddddd;color:rgb(78,78,78);box-shadow:0 0 5px 4px black;}div#script_warehouseChange_wMain>div:nth-of-type(2){max-width:500%;min-width:100%;height:430px;background-color:rgb(255,255,255,0.7);}div.col-md-6>div#script_warehouseChange_wMain.script_show,div.col-md-6>div#script_warehouseChange_wMain.script_hide{display:none !important;}div.row>div.col-xs-6.text-center>div#script_warehouseChange_wMain{display:none !important;}"];settingUI=async()=>{let t=document.createElement("div"),e="<div class=header>仓库变动统计设置</div><div class=container><div><button class=\"btn script_opt_submit\">保存更改</button></div><table><thead><tr><td>功能<td>设置<tbody><tr><td title=每一次查询仓库数据如果有变动则记录为一次数据,默认为20>历史数据长度<td><input type=number class=form-control value=#####><tr><td title=纵轴是数量或者价值>显示的指标<td><select class=form-control><option value=amount>数量<option value=cost>金额</select><tr><td title=是否开启暗黑模式>暗黑模式<td><input class='form-control' type=checkbox #####></table></div>";return e=e.replace("#####",this.indexDBData.dataLength),e=e.replace("#####",this.indexDBData.isDark?"checked":""),t.id="script_warehouseChangeRecords_setting",t.innerHTML=e,t.querySelector("select").value=this.indexDBData.norm,t.addEventListener("click",(t=>this.settingClickHandle(t))),t};settingClickHandle(t){if(/script_opt_submit/.test(t.target.className))return this.settingSubmit()}settingSubmit(){let t=Object.values(document.querySelectorAll("#script_warehouseChangeRecords_setting select, #script_warehouseChangeRecords_setting input")).map((t=>"checkbox"==t.type?t.checked:t.value));if(t[0]=Math.floor(t[0]),t[0]<=5)return a.alert("数据量太小了.");let e=!1;this.indexDBData.isDark!=t[2]&&(e=!0),this.indexDBData.dataLength=t[0],this.indexDBData.norm=t[1],this.indexDBData.isDark=t[2],a.indexDB_updateIndexDBData(),a.alert("已保存"),e&&location.reload()}async warehouseInfo(t,e,i){i=JSON.parse(i).map((t=>({name:t.kind.name,amount:t.amount,cost:Math.floor(Object.values(t.cost).reduce(((t,e)=>t+e),0).toFixed(2))})));let n=null==this.componentData.realm?await a.getRealm():this.componentData.realm;this.componentData.realm=n;let o=this.indexDBData[`r${n}Data`],s=(new Date).getTime(),r=i.reduce(((t,e)=>t+e.cost),0);r!=(o.lastItem?.total||0)&&(o.length>=this.indexDBData.dataLength&&o.splice(0,o.length-this.indexDBData.dataLength+1),o.push({timeStamp:s,total:r,data:i}),a.indexDB_updateIndexDBData())}genEchartConf(t,e="cost"){let i={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[]},n=[],a=[],o=[];for(let i=0;i<t.length;i++)if(a.includes(t[i].timeStamp)||a.push(this.formatTimestampToHHmm(t[i].timeStamp)),0!=t[i].data.length)for(let a=0;a<t[i].data.length;a++){let s=t[i].data[a];if(!n.includes(s.name)){n.push(s.name);let t={name:s.name,type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]};o.push(t)}let r=o.findIndex((t=>t.name==s.name));o[r].data[i]=(o[r].data[i]??0)+s[e]}let s=a.length;for(let t=0;t<o.length;t++)for(let e=0;e<s;e++)o[t].data[e]||(o[t].data[e]=0);return i.legend.data=n,i.xAxis[0].data=a,i.series=o,i}formatTimestampToHHmm=(t="")=>new Date(t).toLocaleTimeString([],{hour12:!1});async mountPanel(){if(null==window.echarts)return await a.dely(5e3),this.mountPanel();try{if(null==this.componentData.warehouseMountMain){let t=document.createElement("div");t.id="script_warehouseChange_wMain",t.className="script_hide",t.innerHTML="<div><button class=btn id=script_warehouseChange_wButton>查看仓库历史变动</button></div><div id='script_warehouseChange_wCharts'></div>",this.componentData.warehouseMountMain=t,t.querySelector("button#script_warehouseChange_wButton").addEventListener("click",(()=>this.switchWarehouseMount()))}if(document.querySelector("div#script_warehouseChange_wMain"))return;a.getParentByIndex(document.querySelector("div.col-lg-10.col-md-9 button"),2).appendChild(this.componentData.warehouseMountMain)}catch(t){a.errorLog(t)}}async switchWarehouseMount(){try{if(0==this.componentData.warehouseIsOn){this.componentData.warehouseMountMain.className="script_show";let t=this.indexDBData[`r${this.componentData.realm}Data`],e=this.genEchartConf(t,this.indexDBData.norm),i=document.querySelector("div#script_warehouseChange_wCharts");Object.assign(i.style,{width:"400px",height:"420px"}),window.echarts.init(i,this.indexDBData.isDark?"dark":null).setOption(e)}else this.componentData.warehouseMountMain.className="script_hide";this.componentData.warehouseIsOn=!this.componentData.warehouseIsOn}catch(t){console.error(t)}}}},396:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c,langData:l}=i(658);new class warehouseItemID extends n{constructor(){super(),this.name="仓库界面物资显示物品ID",this.describe="在仓库界面物资文字右边会显示物品的ID",this.tagList=["仓库","物品","ID"],this.enable=!1}componentData={nameList:[],nodeTemp:void 0};cssText=["span[sct_cpt='warehouseItemID'][sct_id='item_id']{display:block;position:absolute;text-align:center;font-size:20px;color:#ffffff01;right:2%;bottom:20%;}"];commonFuncList=[{match:()=>Boolean(location.href.match(/warehouse\/$/)),func:this.mainFunc}];startupFuncList=[this.updateCache];async updateCache(){for(let t=0;t<180;t++){let e=await a.itemIndex2Name(t);e&&(this.componentData.nameList[t]=e)}}mainFunc(){let t=Object.values(document.querySelectorAll(".col-lg-10.col-md-9 > div > div > div > div > div"));if(0!=t.length&&!t[0].querySelector("span[sct_cpt='warehouseItemID'][sct_id='item_id']")){if(!this.componentData.nodeTemp){let t=document.createElement("span");t.setAttribute("sct_cpt","warehouseItemID"),t.setAttribute("sct_id","item_id"),this.componentData.nodeTemp=t}for(let e=0;e<t.length;e++){let i=t[e];i.querySelectorAll("span[sct_cpt='warehouseItemID'][sct_id='item_id']").forEach((t=>t.remove()));let n=i.querySelector("b").innerText,a=this.componentData.nameList.findIndex((t=>t==n)),o=this.componentData.nodeTemp.cloneNode(!0);o.innerText=a,i.appendChild(o)}}}}},799:(t,e,i)=>{const n=i(832),{tools:a,componentList:o,runtimeData:s,indexDBData:r,feature_config:c}=i(658);new class warehousePriceCount extends n{constructor(){super(),this.name="仓库单物品总价值",this.describe="在仓库界面鼠标移动到物品上悬停,会显示单物品合计总价值.",this.enable=!0,this.tagList=["统计"]}commonFuncList=[{match:()=>Boolean(location.href.match(/warehouse\/$/)),func:this.mainFunc}];mainFunc(){try{let t=document.querySelectorAll(".col-lg-10.col-md-9 > div > div > div > div > div"),e=s.basisCPT.realm;if(null==e)return;let i={};for(let t=0;t<r.basisCPT.warehouse[e].length;t++){let n=r.basisCPT.warehouse[e][t],a=0;null==i[n.kind.name]&&(i[n.kind.name]=0),Object.values(n.cost).forEach((t=>a+=t)),i[n.kind.name]+=a}for(let e=0;e<t.length;e++){let n=t[e].querySelector("b").innerText;t[e].setAttribute("title",`成本价值：$${i[n].toFixed(2)}`)}}catch(t){a.errorLog(t)}}}},832:(t,e,i)=>{const{componentList:n}=i(658);t.exports=class BaseComponent{name="";describe="";enable=!1;canDisable=!0;commonFuncList=[];netFuncList=[];debounceFuncList=[];startupFuncList=[];chatMsgFuncList=[];settingUI=void 0;frontUI=void 0;componentData;indexDBData;cssText;dependence={cpt:[],url:[]};tapCount=0;tagList=[];constructor(){n[this.constructor.name]=this}}},658:t=>{let e={},i={},n={},a={debug:!1,version:2,net_gap_ms:1e4,notificationMode:[1,0],fontColor:"#ffffff",zoomRate:"100%",componentSwitchList:{}},o={};class tools{static scriptLoadAcc=!1;static browserKind="";static netFetchPool=[];static eventCount=0;static lastURL="";static clientHorV=0;static dbOpenFlag=!1;static dbObj=void 0;static dbStoreName="main";static uuid=void 0;static msgBodyNode=void 0;static lastMutation=void 0;static lastMutationTime=0;static windowMask=void 0;static msgShowFlag={timer:void 0,flag:!1};static mutationUrlTemp="";static dialogNode=void 0;static dialogMain=void 0;static confirmNode={mainNode:void 0,msgNode:void 0,resolveFunc:null};static noSaveClose=!1;static baseURL={userBase:"https://www.simcompanies.com/api/v2/companies/me/",building:"https://www.simcompanies.com/api/v2/companies/me/buildings/",warehouse:"https://www.simcompanies.com/api/v2/resources/",market:"https://www.simcompanies.com/api/v3/market/all",executives:"https://www.simcompanies.com/api/v2/companies/me/executives/"};static log(){a.debug&&console.log.call(this,...arguments)}static errorLog(){a.debug&&console.error.call(this,...arguments)}static getParentByIndex(t,e){return e?this.getParentByIndex(t.parentElement,--e):t}static async dely(t){return new Promise((e=>setTimeout(e,t)))}static formatFeatureConfigComponentList(){Object.values(e).forEach((t=>a.componentSwitchList[t.constructor.name]=t.enable))}static CSSMount(t="",e=""){let i=document.createElement("style");i.setAttribute("type","text/css"),i.setAttribute("sct_id",t),i.setAttribute("sct_length",e.length),i.textContent=e,document.head.appendChild(i)}static addCSSNode(t,e){if(!e&&!t.getAttribute("sct_id"))return!1;let i=e||t.getAttribute("sct_id");return e&&t.setAttribute("sct_id",e),!document.querySelector(`style[sct_id="${i}"]`)&&(document.head.appendChild(t),!0)}static checkWindowHorV(){this.log("height:",window.innerHeight),this.log("width:",window.innerWidth),this.clientHorV=window.innerHeight>window.innerWidth?1:0}static checkBrowser(){let t=navigator.userAgent;return t.includes("Electron")?this.browserKind="Electron":t.includes("Chrome")?this.browserKind="Chrome":t.includes("Firefox")?this.browserKind="Firefox":t.includes("Safari")&&!t.includes("Chrome")?this.browserKind="Safari":t.includes("Edge")?this.browserKind="Edge":t.includes("Trident")||t.includes("MSIE")?this.browserKind="IE":this.browserKind="Unknown"}static mpFormat(t=[]){let e=[1/0,1/0,1/0,1/0,1/0,1/0,1/0,1/0,1/0,1/0,1/0,1/0,1/0];for(let i=0;i<t.length;i++)e[t[i].quality]==1/0&&(e[t[i].quality]=t[i].price);for(let t=0;t<e.length;t++)e[t]=Math.min(e[t],...e.slice(t+1));return e=e.map((t=>t==1/0?0:t)),e}static zoomRateApply(){if("Firefox"!=this.browserKind)return document.body.style.zoom=a.zoomRate}static hexArgbCheck(t){return""!=t&&null!=t&&(/^#[0-9a-fA-F]{6}$/.test(t)||/^rgba?\((\s*\d+\s*,){2}\s*\d+(\.\d+)?(\s*,\s*\d+(\.\d+)?)?\s*\)$/.test(t))}static setInput(t,e,i=3){let n=t.value;t.value=e;let a=new Event("input",{bubbles:!0});if(a.simulated=!0,t._valueTracker&&t._valueTracker.setValue(n),t.dispatchEvent(a),i>=0)return this.setInput(t,e,--i)}static createWindowMask(){if(Boolean(tools.windowMask))return;let t=document.createElement("style"),e=document.createElement("div");t.setAttribute("type","text/css"),t.textContent="div#script_tools_windowMask{height:100%;width:100%;position:absolute;top:0;left:0;z-index:5000;background-color:rgb(0,0,0,0.5);}div#script_tools_windowMask>div>svg{width:30%;height:30%;display:block;position:absolute;top:35%;left:50%;transform:translateX(-50%) translateY(-50%);}div#script_tools_windowMask>div:nth-of-type(2){color:var(--fontColor);align-items:center;text-align:center;display:block;width:fit-content;height:fit-content;transform:translateX(-50%) translateY(-50%);position:absolute;top:65%;left:50%;}div#script_tools_windowMask>div:nth-of-type(2)>div{padding:20px;font-size:30px;width:fit-content;height:fit-content;border:solid 5px black;border-radius:10px;box-shadow:0 0 10px 10px white;background-color:rgb(0,0,0,0.5);}div#script_tools_windowMask>div:nth-of-type(2)>button{background-color:rgb(0,0,0,0.8);margin-top:20px;width:160px;height:40px;}",e.id="script_tools_windowMask",e.innerHTML='<div><svg viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 2A10 10 0 1 0 22 12A10 10 0 0 0 12 2Zm0 18a8 8 0 1 1 8-8A8 8 0 0 1 12 20Z"fill=currentColor opacity=.5></path><path d="M20 12h2A10 10 0 0 0 12 2V4A8 8 0 0 1 20 12Z"fill=currentColor><animateTransform attributeName=transform dur=1s from="0 12 12"repeatCount=indefinite to="360 12 12"type=rotate></animateTransform></path></svg></div><div><div><span>操作进行中</span></div><button class=btn>取消操作</button></div>',e.querySelector("button").addEventListener("click",(()=>window.confirm("确定终止操作并刷新网页吗?")?location.reload():null)),Object.assign(e.style,{display:"none"}),tools.windowMask=e,document.head.appendChild(t),document.body.appendChild(e)}static setWindowMask(t=!1){"boolean"==typeof t&&(tools.windowMask||tools.createWindowMask(),Object.assign(tools.windowMask.style,{display:t?"block":"none"}))}static async getRealm(){let t=i.basisCPT.realm;for(;null==t;)await tools.dely(500),t=i.basisCPT.realm;return t}static getRandomNumber(t=0,e=1,i=parseFloat){return i(Math.random()*(e-t))+t}static arrayIsAllZero(t){return 0==t.filter((t=>0!=t||0!=t)).length}static itemName2Index(t){for(const e in o){if(!Object.hasOwnProperty.call(o,e))continue;if(!/^be-re-/.test(e))continue;if(o[e]!=t)continue;return Math.floor(e.replace("be-re-",""))}}static itemIndex2Name(t){return o["be-re-"+t]}static async getMarketPrice(t,e,i){let a,o=await tools.getNetData(`${tools.baseURL.market}/${i}/${t}/`);if(o)a=tools.mpFormat(o),n.basisCPT.resourcePool[i][t]=a;else{if(!n.basisCPT.resourcePool[i][t])return 0;a=n.basisCPT.resourcePool[i][t]}if(0==a[e])for(let t=e;t<=12;t++)if(0!=a[t])return a[t];return a[e]}static async netRequest(t,e="GET",i=void 0,n=[]){let o=e+t;tools.log(o);let s=(new Date).getTime(),r=this.netFetchPool.findIndex((t=>t.url==o));if(-1==r)this.netFetchPool.push({url:o,time:s});else{if(!(s-this.netFetchPool[r].time>=a.net_gap_ms))return!1;this.netFetchPool[r].time=s}return"GET"==e?await fetch(t):await fetch(t,{method:e,body:i,headers:n})}static async getNetData(t,e="GET",i=void 0,n=[]){let a=await this.netRequest(t,e,i,n);return!!a&&await a.json()}static async getNetText(t,e="GET",i=void 0){let n=await this.netRequest(t,e,i,header);return!!n&&await n.text()}static arrayCompareByProp(t,e){if(0===t.length||1===t.length)return!0;const i=t[0][e];return t.every((t=>t[e]===i))}static arrayCompareByFunc(t,e){if(0===t.length||1===t.length)return!0;const i=e(t[0]);return t.every((t=>e(t)===i))}static async generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}static regStringCheck(t=""){try{return""!=t&&"string"==typeof t&&(!(!t.startsWith("/")||!/\/[img]*$/.test(t))&&new RegExp(t.replace(/^\//,"").replace(/\/[img]*$/,""),t.match(/\/([img])*$/)[1]))}catch(t){return tools.errorLog(t),!1}}static convertPropertiesToRegex(t){for(let e in t)if(t.hasOwnProperty(e))if("object"==typeof t[e]&&null!==t[e])this.convertPropertiesToRegex(t[e]);else if("string"==typeof t[e]&&this.regStringCheck(t[e]))try{t[e]=this.regStringCheck(t[e])}catch(t){console.error(t)}}static convert12To24Hr(t){try{let[e,i]=t.split(" "),[n,a]=e.split(":");return n=parseInt(n,10)%12+("pm"===i.toLowerCase()?12:0),`${n.toString().padStart(2,"0")}:${a}`}catch{return!1}}static getBuildKind(t=0){if(0==t)return;let e=i.basisCPT.realm;if(0==n.basisCPT.building[e].length)return;let a=n.basisCPT.building[e].find((e=>e.id==t));return null==a?void 0:a.kind}static numberAddCommas(t=0){let e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")}static downloadTextFile(t,e){let i=new Blob([e],{type:"text/plain"}),n=URL.createObjectURL(i),a=document.createElement("a");a.href=n,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}static deepCloneObj(t){if(null===t)return t;if(t===1/0)return"Infinity";if(t instanceof RegExp)return`/${t.source}/${t.flags}`;if("object"!=typeof t)return t;let e=Array.isArray(t)?[]:{};for(let i in t)t.hasOwnProperty(i)&&(e[i]=this.deepCloneObj(t[i]));return e}static async indexDB_openDB(){return new Promise(((t,e)=>{let i=window.indexedDB.open("SimCompsScriptDB1",1);i.onupgradeneeded=t=>{indexedDB.dbObj=t.target.result,indexedDB.dbObj.objectStoreNames.contains(this.dbStoreName)||(indexedDB.storeObj=indexedDB.dbObj.createObjectStore(this.dbStoreName,{keyPath:"id"}))},i.onerror=()=>e("数据库的打开失败"),i.onsuccess=e=>{this.dbObj=e.target.result,this.dbOpenFlag=!0,t("数据库连接完毕")}}))}static async indexDB_addData(t,e){return new Promise(((i,n)=>{if(!this.dbOpenFlag)return n("数据库未打开");if(!t.id&&!e)return n("缺少主键");e&&(t={id:e,...t});let a=this.dbObj.transaction(this.dbStoreName,"readwrite").objectStore(this.dbStoreName).add(t);a.onsuccess=()=>i("数据添加成功"),a.onerror=()=>n("数据添加失败")}))}static async indexDB_deleteData(t){return new Promise(((e,i)=>{this.dbOpenFlag||i("数据库未打开"),t||i("缺少id主键");let n=this.dbObj.transaction(this.dbStoreName,"readwrite").objectStore(this.dbStoreName).delete(t);n.onsuccess=()=>e("数据删除成功"),n.onerror=()=>i("数据删除失败")}))}static async indexDB_updateData(t,e){return new Promise(((i,n)=>{if(!this.dbOpenFlag)return n("数据库未打开");if(!t.id&&!e)return n("缺少主键");e&&(t={id:e,...t});let a=this.dbObj.transaction(this.dbStoreName,"readwrite").objectStore(this.dbStoreName).put(t);a.onsuccess=()=>i("数据添加成功"),a.onerror=()=>n("数据添加失败")}))}static async indexDB_getData(t){return new Promise(((e,i)=>{this.dbOpenFlag||i("数据库未打开"),t||i("缺少id主键");let n=this.dbObj.transaction(this.dbStoreName,"readonly").objectStore(this.dbStoreName).get(t);n.onsuccess=()=>e(Boolean(n.result)?n.result:null),n.onerror=()=>i("数据查询失败")}))}static async indexDB_updateUUID(){let t=await this.indexDB_getData("uuid");if(t)return this.uuid=t.uuid;this.uuid=await this.generateUUID(),await this.indexDB_updateData({id:"uuid",uuid:this.uuid})}static async indexDB_loadFeatureConf(){let t=await this.indexDB_getData("feature_conf");if(!t)return this.indexDB_addData(a,"feature_conf");let i=t.componentSwitchList;delete t.id,delete t.componentSwitchList;for(const e in a)if(Object.hasOwnProperty.call(a,e)&&null!=t[e])if("object"!=typeof a[e])a[e]=t[e];else if(Array.isArray(a[e]))a[e]=a[e].map(((i,n)=>null==t[e][n]?i:t[e][n]));else for(const i in a[e])Object.hasOwnProperty.call(a[e],e)&&null!=t[e]&&null!=t[e][i]&&(a[e][i].enable=Boolean(t[e][i]));for(const t in i)Object.hasOwnProperty.call(i,t)&&e[t]&&(e[t].enable=Boolean(i[t]));tools.log(a),tools.indexDB_updateFeatureConf()}static async indexDB_loadIndexDBData(){let t=await this.indexDB_getData("indexDBData");if(!t)return this.indexDB_addData(n,"indexDBData");delete t.id;for(const i in t)if(Object.hasOwnProperty.call(t,i)&&e[i])for(const n in t[i])Object.hasOwnProperty.call(t[i],n)&&(e[i].indexDBData[n]=t[i][n])}static async indexDB_updateFeatureConf(){return this.formatFeatureConfigComponentList(),await tools.indexDB_updateData(a,"feature_conf")}static async indexDB_updateIndexDBData(){return tools.indexDB_updateTabCount(),await tools.indexDB_updateData(n,"indexDBData")}static async indexDB_updateLoadCount(){let t=await this.indexDB_getData("loadCount");if(!t)return this.indexDB_addData({id:"loadCount",count:1});this.indexDB_updateData({id:"loadCount",count:++t.count})}static async indexDB_deleteAllData(){let t=["tapCount","feature_conf","indexDBData","uuid","loadCount","langData"];this.noSaveClose=!0;for(let e=0;e<t.length;e++)console.log(t[e]),await this.indexDB_deleteData(t[e])}static async indexDB_loadLangData(){let t=await this.indexDB_getData("langData");t&&(delete t.id,o=t)}static async indexDB_updateLangData(t){"langData"!=t.id&&(t.id="langData"),await this.indexDB_updateData(t)}static async indexDB_loadTapCount(){let t=await this.indexDB_getData("tapCount");if(t){delete t.id;for(const i in t)Object.hasOwnProperty.call(t,i)&&Object.hasOwnProperty.call(e,i)&&(e[i].tapCount=t[i]==1/0?1/0:Number(t[i]))}else{let t=this.genComponentTapCount();this.indexDB_updateTabCount(t)}}static async indexDB_updateTabCount(t=void 0){let e=t||this.genComponentTapCount();e.id="tapCount",await this.indexDB_updateData(e)}static async indexDB_genAllData2String(){let t={feature_conf:null,indexDBData:null,tapCount:null};return t.feature_conf=this.deepCloneObj(a),t.indexDBData=this.deepCloneObj(n),t.tapCount=this.deepCloneObj(this.genComponentTapCount()),JSON.stringify(t)}static async indexDB_loadUserConf(t,e,i){a=t,await tools.indexDB_updateFeatureConf(),this.convertPropertiesToRegex(e),n=e,await tools.indexDB_updateIndexDBData(),await tools.indexDB_updateTabCount(i)}static genComponentTapCount(){let t={};for(const i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i].tapCount);return t}static async msg_check(t,e=!1){if(a.notificationMode.includes(0))if(!window.Notification||"denied"==Notification.permission||t&&"denied"===t)e&&window.alert("浏览器通知接口获取失败，可能是以下原因：\n  1.浏览器不支持\n  2.权限未同意");else if("granted"==Notification.permission||"granted"==t)tools.log("Notification对象权限已授权");else if("default"==Notification.permission)return await tools.msg_check(await Notification.requestPermission(),!0);a.notificationMode.includes(1)&&null==this.msgBodyNode&&tools.log("网页内消息插件未检测到容器元素,无法正常执行.")}static msg_send(t,e="",i=void 0){let n=i?a.notificationMode.includes(i)?[i]:[]:a.notificationMode;try{n.includes(0)&&null==e.tagName&&new Notification(t,{body:e})}catch(t){tools.errorLog("渠道0 原生Notification通知报错",t)}try{if(n.includes(1)){let i=document.createElement("tr"),n=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});null==e.tagName?i.innerHTML=`<td>${n}</td><td>${t}\n${e}</td>`:(i.innerHTML=`<td>${n}</td><td>${t}\n</td>`,i.querySelector("td:nth-of-type(2)").appendChild(e)),this.msgBodyNode.appendChild(i),this.msgShowFlag.timer&&clearInterval(this.msgShowFlag.timer),this.msgShowFlag.timer=setInterval((()=>{Object.assign(document.querySelector("div#script_hover_node>div>span").style,{backgroundColor:this.msgShowFlag.flag?"rgb(0,0,0,0)":"#792c2c"}),this.msgShowFlag.flag=!this.msgShowFlag.flag}),1e4)}}catch(t){tools.errorLog("渠道1 网页内通知通道报错",t)}try{n.includes(2)&&null==e.tagName&&AndroidInterface.sendNotification(t,e)}catch(t){tools.errorLog("渠道2 安卓通知通道报错",t)}}static arrayUnique(t,e=void 0){if(0==t.length||void 0!==e&&null==t[0][e])return[];let i=[];for(let n=0;n<t.length;n++){i.some((i=>void 0===e?t[n]===i:t[n][e]===i[e]))||i.push(t[n])}return i}static msg_clear(){let t=Object.values(this.msgBodyNode.childNodes);for(let e=0;e<t.length;e++)t[e].remove()}static buildAlert(){let t=document.createElement("div");t.id="script_dialog_overlay",t.style.display="none",t.innerHTML="<div id=\"script_dialog_main\"><h2>通知</h2><div id='script_dialog_container'></div><button sct_id='dialog_close'>关闭</button></div>",this.dialogMain=t.querySelector("#script_dialog_container"),this.dialogNode=t,document.body.appendChild(t),t.addEventListener("click",(t=>"script_dialog_overlay"==t.target.id||"dialog_close"==t.target.getAttribute("sct_id")?this.alertFade():void 0)),this.CSSMount("main_alert","#script_dialog_overlay{background-color:rgba(0,0,0,0.25);transition:ease-in-out 0.15s;position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:10000;backdrop-filter:blur(10px)}#script_dialog_overlay>#script_dialog_main{color:var(--fontColor);padding:20px;border-radius:5px;box-shadow:0 0 10px 10px rgba(0,0,0,0.3);max-width:400px;min-width:200px;max-height:80%;overflow-y:auto;background-color:rgb(0,0,0,0.9);border:2px white dashed;}#script_dialog_overlay #script_dialog_main h2{margin-top:0;margin-bottom:20px;}#script_dialog_overlay #script_dialog_main p{margin-bottom:20px;}#script_dialog_overlay #script_dialog_main button{padding:10px 20px;border:none;background-color:#4C4C4C;color:var(--fontColor);border-radius:5px;cursor:pointer;transition:ease-in-out 0.25s;}#script_dialog_overlay #script_dialog_main button:hover{box-shadow:0 0 5px 5px white;}")}static alertFade(){this.dialogMain.innerHTML="",Object.assign(this.dialogNode.style,{display:"none"})}static alert(t,e){"string"==typeof t?this.dialogMain.innerHTML=`<p>${t}</p>`:t.tagName&&(this.dialogMain.appendChild(e),this.dialogMain.appendChild(t)),Object.assign(this.dialogNode.style,{display:"flex"})}static buildConfirm(){let t=document.createElement("div");t.id="script_confirm_overlay",t.style.display="none",t.innerHTML='<div id="script_confirm_main"><h2>请确认</h2><p></p><button>取消</button>\n<button>确认</button></div>',this.confirmNode.msgNode=t.querySelector("p"),this.confirmNode.mainNode=t,document.body.appendChild(t),t.addEventListener("click",(t=>{"script_confirm_overlay"==t.target.id&&this.hideConfirm(!1),"BUTTON"==t.target.tagName&&/取消/.test(t.target.innerText)&&this.hideConfirm(!1),"BUTTON"==t.target.tagName&&/确认/.test(t.target.innerText)&&this.hideConfirm(!0)})),this.CSSMount("main_confirm","#script_confirm_overlay{background-color:rgba(0,0,0,0.25);transition:ease-in-out 0.15s;position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:10000;backdrop-filter:blur(10px)}#script_confirm_overlay>#script_confirm_main{color:var(--fontColor);padding:20px;border-radius:5px;box-shadow:0 0 10px 10px rgba(0,0,0,0.3);max-width:400px;min-width:200px;background-color:rgb(0,0,0,0.9);border:2px white dashed;}#script_confirm_overlay #script_confirm_main h2{margin-top:0;margin-bottom:20px;}#script_confirm_overlay #script_confirm_main p{margin-bottom:20px;}#script_confirm_overlay #script_confirm_main button{padding:10px 20px;border:none;background-color:#4C4C4C;color:var(--fontColor);border-radius:5px;cursor:pointer;transition:ease-in-out 0.25s;}#script_confirm_overlay #script_confirm_main button:hover{box-shadow:0 0 5px 5px white;}")}static hideConfirm(t=!1){this.confirmNode.mainNode.style.display="none",this.confirmNode.msgNode.innerHTML="",this.confirmNode.resolveFunc(t)}static confirm(t=""){return this.confirmNode.mainNode.style.display="flex",t.tagName?this.confirmNode.msgNode.appendChild(t):this.confirmNode.msgNode.innerText=t,new Promise(((t,e)=>this.confirmNode.resolveFunc=t))}static async dependenceCheck(){let t=Object.values(e).filter((t=>t.enable||!t.canDisable)),i=[];for(let e=0;e<t.length;e++){let n=t[e],a=n.constructor.name,o=n.dependence.cpt||[],s=n.dependence.url||[];if(0!=o.length||0!=s.length){if(o.some((e=>-1==t.findIndex((t=>t.constructor.name==e)))))return console.log(`${a} ${n.name} 组件的依赖未被开启`);s.filter((t=>!i.includes(t.name))).forEach((t=>{i.push(t.name);let e=document.createElement("script");e.src=t.url,document.head.appendChild(e)}))}}}static eventBus(t){if(this.scriptLoadAcc){t&&this.eventCount++;for(const i in e){if(!Object.hasOwnProperty.call(e,i))continue;let n=e[i];if(n.enable||!n.canDisable){for(let e=0;e<n.commonFuncList.length;e++){let i=n.commonFuncList[e];try{if(!i.match.call(n,t))continue;setTimeout((function(){try{i.func.call(n,t)}catch(t){tools.errorLog(t)}}),1)}catch(t){tools.errorLog(t);continue}}for(let e=0;e<n.debounceFuncList.length;e++){let i=n.debounceFuncList[e];try{if(this.eventCount%i.bounce!=0)continue;setTimeout((function(){try{i.func.call(n,t)}catch(t){tools.errorLog(t)}}),1)}catch(t){tools.errorLog(t);continue}}}}}}static intervalEventBus(){location.href!=this.lastURL&&(this.lastURL=location.href,this.eventBus(void 0))}static netEventBus(t,i,n){tools.log(i,t);for(const a in e){if(!Object.hasOwnProperty.call(e,a)||0==e[a].netFuncList.length)continue;if(!e[a].enable&&e[a].canDisable)continue;let o=e[a],s=o.netFuncList;for(let e=0;e<s.length;e++)if(s[e].urlMatch(t))try{s[e].func.call(o,t,i,n)}catch(t){tools.errorLog(t)}}}static mutationHandle(t){try{let e=!1,i=Array.from(t).filter(this.mutationHandle_chatMsgNodeCheck);if(/messages\/.+\/$/.test(location.href)&&i.length){for(let t=0;t<i.length;t++)this.chatMsgEventHandle(i[t]);e=!0}if(/messages\/$/.test(this.mutationUrlTemp)&&/messages\/.+\/$/.test(location.href)){let i=Array.from(t).filter(this.mutationHandle_chatMsgNodeCheck2),n=Array.from(i[0].addedNodes[0].childNodes[0].childNodes[0].childNodes[1].childNodes[0].childNodes[0].childNodes).map((t=>({addedNodes:[t]})));for(let t=0;t<n.length;t++)this.chatMsgEventHandle(n[t]);e=!0}if(!e){let e=(new Date).getTime();if(e-this.lastMutationTime<=500){if(t[0].target.className.match("chat-notifications"))return;if(t.length>=2&&t[0].target==t[1].target)return;if("TBODY"==this.getParentByIndex(t[0].target,5).tagName)return}this.lastMutationTime=e,this.log("检测到DOM变动,Mutation: ",t),this.lastMutation=t[0],this.eventBus(void 0)}}catch(e){this.log(t),this.errorLog(e),this.eventBus(void 0)}finally{this.mutationUrlTemp=location.href}}static mutationHandle_chatMsgNodeCheck(t){try{let e=t.type&&"childList"===t.type,i=t.addedNodes&&1===t.addedNodes.length,n="DIV"===t.addedNodes[0].tagName,a=t.addedNodes[0].firstElementChild,o=a&&"A"===a.tagName,s=a&&a.hasAttribute("href")&&/\/company\/\d+\/.+\/$/.test(a.getAttribute("href"));return e&&i&&n&&o&&s}catch{return!1}}static mutationHandle_chatMsgNodeCheck2(t){try{let e="DIV"==t.addedNodes[0].tagName,i=/well-header text-uppercase/.test(t.addedNodes[0].childNodes[0].childNodes[0].childNodes[0].className);return e&&i}catch{return!1}}static chatMsgEventHandle(t){try{for(const i in e){if(!Object.hasOwnProperty.call(e,i))continue;let n=e[i];if(!n.enable&&n.canDisable)continue;let a=n.chatMsgFuncList;for(let e=0;e<a.length;e++)try{let i=Object.values(t.addedNodes[0].childNodes[2].childNodes).map((t=>this.formatMsgText(t)));a[e].call(n,t.addedNodes[0],i)}catch(t){tools.errorLog(t)}}}catch(t){console.error(t)}}static formatMsgText(t){try{let e="",i=t.childNodes[0];"I"==i.tagName&&(i=t.childNodes[1]);let n=Object.values(i.children).filter((t=>"SPAN"==t.tagName));for(let t=0;t<n.length;t++){let i=n[t];e+=0==n[t].children.length?i.innerText:this.getSpanText(i)}return e}catch(t){console.error(t)}}static getSpanText(t){let e=Array.from(t.children),i=e.length;return 1==i&&"SPAN"==e[0].tagName&&1==e[0].children.length&&"IMG"==e[0].children[0].tagName?e[0].children[0].alt:1==i&&"IMG"==e[0].tagName&&"emoji"==e[0].className?e[0].alt:1==i&&"A"==e[0].tagName&&/^@/.test(e[0].innerText)?e[0].innerText:1!=i||"A"!=e[0].tagName||/^@/.test(e[0].innerText)?i>1&&tools.arrayCompareByProp(e,"className")?e.map((t=>t.alt)).join(""):"":e[0].href}}t.exports={tools,componentList:e,runtimeData:i,indexDBData:n,feature_config:a,langData:o}}},e={};function i(n){var a=e[n];if(void 0!==a)return a.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{const{tools:t,componentList:e,runtimeData:n,indexDBData:a,feature_config:o}=i(658);i(832),i(467);const s=i(636);s.keys().forEach(s),async function i(){if(!window.SCTLoadFlag&&!document.querySelector("div#script_hover_node")){window.SCTLoadFlag=!0;try{!function(){window.addEventListener("beforeunload",(()=>{t.noSaveClose||t.indexDB_updateIndexDBData()})),document.addEventListener("click",(e=>t.eventBus(e))),document.addEventListener("keydown",(e=>t.eventBus(e))),new MutationObserver((e=>t.mutationHandle(e))).observe(document.querySelector("div#root"),{childList:!0,subtree:!0}),setInterval(t.intervalEventBus.apply(t),100);const e=window.XMLHttpRequest;window.XMLHttpRequest=function(){let i=new e,n=i.open;return i.open=function(e,a,o){let s=i.onload;i.onload=function(){if(200===i.status){try{t.netEventBus(a,e,i.responseText)}catch(e){t.errorLog(e)}s&&s.apply(this,arguments)}},n.apply(this,arguments)},i}}()}catch{return t.dely(5e3),window.SCTLoadFlag=!1,i()}t.checkWindowHorV(),t.checkBrowser();for(const t in e){let i=e[t];n[t]=i.componentData,a[t]=i.indexDBData,o.componentSwitchList[t]=i.enable}await t.indexDB_openDB(),await t.indexDB_updateUUID(),await t.indexDB_updateLoadCount(),await t.indexDB_loadFeatureConf(),await t.indexDB_loadIndexDBData(),await t.indexDB_loadLangData(),await t.indexDB_loadTapCount(),await t.dependenceCheck(),t.buildAlert(),t.buildConfirm(),t.zoomRateApply(),t.msg_check();for(const i in e){if(!Object.hasOwnProperty.call(e,i)||!e[i].enable&&e[i].canDisable)continue;let n=e[i];await n.startupFuncList.forEach((async t=>await t.call(n,this))),n.cssText&&t.CSSMount(n.constructor.name,n.cssText[t.clientHorV]||n.cssText[0])}t.scriptLoadAcc=!0}}()})()})();